<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="keywords" content="GitHub, IT, ICT, 大数据, Linux, Ubuntu, CentOS, 云计算, 机器学习, 深度学习, Kubernetes, Docker, OpenStack">
<meta name="description" content="">
<meta name="theme-color" content="#000">
<title>hello, world</title>
<link rel="shortcut icon" href="/favicon.ico?v=1600250423710">
<link rel="stylesheet" href="/styles/main.css">
<link rel="stylesheet" href="/media/css/mist.css">

<link rel="stylesheet" href="/media/fonts/font-awesome.css">
<link
  href="//fonts.googleapis.com/css?family=Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Rosario:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext"
  rel="stylesheet" type="text/css">

<link href="/media/hljs/styles/androidstudio.css"
  rel="stylesheet">

<script src="/media/hljs/highlight.js"></script>
<script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.0/velocity.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.0/velocity.ui.min.js"></script>

<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>



</head>

<body>
  <div class="head-top-line"></div>
  <div class="header-box">
    
<div class="mist">
  <header class="header bg-color ">
    <div class="blog-header box-shadow-wrapper  " id="header">
      <div class="nav-toggle" id="nav_toggle">
        <div class="toggle-box">
          <div class="line line-top"></div>
          <div class="line line-center"></div>
          <div class="line line-bottom"></div>
        </div>
      </div>
      <div class="site-meta">       
        <div class="site-title">
          
            <a href="/" class="">
              <span class="logo-line-before">
                <i class=""></i>
              </span>
              <span class="main-title">hello, world</span>
              <span class="logo-line-after">
                <i class=""></i>
              </span>
            </a>  
          
        </div>
        
      </div>
      <nav class="site-nav" id="site_nav">
        <ul id="nav_ul">
          
            
            
            <li class="nav-item ">
              
              
                <a href="/" target="_self">
                  <i class="fa fa-home"></i> 首页
                </a>
              
            </li>
          
            
            
            <li class="nav-item ">
              
              
                <a href="/archives/" target="_self">
                  <i class="fa fa-archive"></i> 归档
                </a>
              
            </li>
          
            
            
            <li class="nav-item ">
              
              
                <a href="/tags/" target="_self">
                  <i class="fa fa-tags"></i> 标签
                </a>
              
            </li>
          
            
            
            <li class="nav-item ">
              
              
                <a href="/post/about/" target="_self">
                  <i class="fa fa-user"></i> 关于
                </a>
              
            </li>
          
          
        </ul>
      </nav>
    </div>
  </header>
</div>

<script type="text/javascript"> 
 
  let showNav = true;

  let navToggle = document.querySelector('#nav_toggle'),
  siteNav = document.querySelector('#site_nav');
  
  function navClick() {
    let sideBar = document.querySelector('.sidebar');
    let navUl = document.querySelector('#nav_ul');
    navToggle.classList.toggle('nav-toggle-active');
    siteNav.classList.toggle('nav-menu-active');
    if (siteNav.classList.contains('nav-menu-active')) {
      siteNav.style = "height: " + (navUl.children.length * 42) +"px !important";
    } else {
      siteNav.style = "";
    }
  }

  navToggle.addEventListener('click',navClick);  
</script>
  </div>
  <div class="main-continer">
    
    <div
      class="section-layout bg-color mist">
      <div class="section-layout-wrapper">
        <div id="sidebarMeta" class="sidebar">
    
<div class="sidebar-wrapper box-shadow-wrapper ">
  <div class="sidebar-item">
    <img class="site-author-image right-motion" src="/images/avatar.png"/>
    <p class="site-author-name">Tom</p>
    
    <div class="site-description right-motion">
      
      
      
        <p>第一次有自己的博客</p>
      
      
    </div>
    
  </div>
  <div class="sidebar-item side-item-stat right-motion">
    <div class="sidebar-item-box">
      <a href="/archives/">
        
        <span class="site-item-stat-count">16</span>
        <span class="site-item-stat-name">文章</span>
      </a>
    </div>
    <div class="sidebar-item-box">
      <a href="">
        <span class="site-item-stat-count">92</span>
        <span class="site-item-stat-name">分类</span>
      </a>
    </div>
    <div class="sidebar-item-box">
      <a href="/tags/">
        <span class="site-item-stat-count">92</span>
        <span class="site-item-stat-name">标签</span>
      </a>
    </div>
  </div>
  
  

  


</div>
</div>
<script>
  let sidebarMeta = document.querySelector('#sidebarMeta');
  let scheme = 'mist';
  let sidebarWrapper = document.querySelector('.sidebar-wrapper');
  if (sidebarMeta && (scheme === 'pisces' || scheme === 'gemini')) {
    document.addEventListener('scroll', function(e) {
      if (document.scrollingElement.scrollTop > parseInt(sidebarMeta.style.marginTop) + 10) {
        sidebarWrapper.classList.add('home-sidebar-fixed')
      } else {
        sidebarWrapper.classList.remove('home-sidebar-fixed')
      }
    });
  }
  </script>
        <div class="section-box tag-line box-shadow-wrapper">
          <section class="section tags-section posts-expand bg-color">
            <div class="padding-wrapper">
  <div class="tag-timeline-box">
    <div class="tag-timeline-wrapper">
      <div class="tag-timeline-title">
        <h2>
          关于
          <small>标签</small>
        </h2>
      </div>
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      <a href="https://tomhht.github.io/post/about/">
        <div class="motion-warpper">
          <div class="tag-post-node">
            <h1>
              08-28
              <small>关于</small>
            </h1>
          </div>
        </div>
      </a>
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
    </div>
  </div>
</div>
          </section>
        </div>
      </div>
    </div>
    <div class="footer-box">
  <footer class="footer">
    <div class="copyright">
      Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | © 2019-2020 Theme By <a href="https://github.com/hsxyhao/gridea-theme-next" target="_blank">HsxyHao</a>
    </div>
    <div class="poweredby">
      Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a>
    </div>
  </footer>
  
  
    <div class="drawer-box left" id="drawer_box">
      <span class="muse-line muse-line-first"></span>
      <span class="muse-line muse-line-middle"></span>
      <span class="muse-line muse-line-last"></span>
    </div>
  
  <div class="mist back-to-top" id="back_to_top">
    <i class="fa fa-arrow-up"></i>
    
  </div>
  
  
  
</div>
<script>

  let sideBarOpen = 'sidebar-open';
  let body = document.body;
  let back2Top = document.querySelector('#back_to_top'),
  back2TopText = document.querySelector('#back_to_top_text'),
  drawerBox = document.querySelector('#drawer_box'),
  rightSideBar = document.querySelector('.sidebar'),
  viewport = document.querySelector('body');

  function scrollAnimation(currentY, targetY) {
   
    let needScrollTop = targetY - currentY
    let _currentY = currentY
    setTimeout(() => {
      const dist = Math.ceil(needScrollTop / 10)
      _currentY += dist
      window.scrollTo(_currentY, currentY)
      if (needScrollTop > 10 || needScrollTop < -10) {
        scrollAnimation(_currentY, targetY)
      } else {
        window.scrollTo(_currentY, targetY)
      }
    }, 1)
  }

  back2Top.addEventListener("click", function(e) {
    scrollAnimation(document.scrollingElement.scrollTop, 0);
    e.stopPropagation();
    return false;
  });
  
  window.addEventListener('scroll', function(e) {
    let percent = document.scrollingElement.scrollTop / (document.scrollingElement.scrollHeight - document.scrollingElement.clientHeight) * 100;
    if (percent > 1 && !back2Top.classList.contains('back-top-active')) {
      back2Top.classList.add('back-top-active');
    }
    if (percent == 0) {
      back2Top.classList.remove('back-top-active');
    }
    if (back2TopText) {
      back2TopText.textContent = Math.floor(percent);
    }
  });

  
  let hasCacu = false;
  window.onresize = function() {
    if (window.width > 991) {
      calcuHeight();
    } else {
      hasCacu = false;
    }
  }

  function calcuHeight() {
    // 动态调整站点概览高度
    if (!hasCacu && back2Top.classList.contains('pisces') || back2Top.classList.contains('gemini')) {
      let sideBar = document.querySelector('.sidebar');
      let navUl = document.querySelector('#site_nav');
      sideBar.style = 'margin-top:' + (navUl.offsetHeight + navUl.offsetTop + 15) + 'px;';
      hasCacu = true;
    }
  }
  calcuHeight();
  
  let open = false, MOTION_TIME = 300, RIGHT_MOVE_DIS = '320px';

  if (drawerBox) {
    let rightMotions = document.querySelectorAll('.right-motion');
    let right = drawerBox.classList.contains('right');

    let transitionDir = right ? "transition.slideRightIn" : "transition.slideLeftIn";

    let openProp, closeProp;
    if (right) {
      openProp = {
        paddingRight: RIGHT_MOVE_DIS 
      };
      closeProp = {
        paddingRight: '0px'
      };
    } else {
      openProp = {
        paddingLeft: RIGHT_MOVE_DIS 
      };
      closeProp = {
        paddingLeft: '0px'
      };
    }

    drawerBox.onclick = function() {
      open = !open;
      window.Velocity(rightSideBar, 'stop');
      window.Velocity(viewport, 'stop');
      window.Velocity(rightMotions, 'stop');
      if (open) {
        window.Velocity(rightSideBar, {
          width: RIGHT_MOVE_DIS
        }, {
          duration: MOTION_TIME,
          begin: function() {
            window.Velocity(rightMotions, transitionDir,{ });
          }
        })
        window.Velocity(viewport, openProp,{
          duration: MOTION_TIME
        });
      } else {
        window.Velocity(rightSideBar, {
          width: '0px'
        }, {
          duration: MOTION_TIME,
          begin: function() {
            window.Velocity(rightMotions, {
              opacity: 0
            });
          }
        })
        window.Velocity(viewport, closeProp ,{
          duration: MOTION_TIME
        });
      }
      for (let i = 0; i < drawerBox.children.length; i++) {
        drawerBox.children[i].classList.toggle('muse-line');
      }
      drawerBox.classList.toggle(sideBarOpen);
    }
  }

  // 链接跳转
  let newWindow = 'true'
  if (newWindow === 'true') {
    let links = document.querySelectorAll('.post-body a')
    links.forEach(item => {
      if (!item.classList.contains('btn')) {
        item.setAttribute("target","_blank");
      }
    })
  }
  // 代码高亮
  hljs.initHighlightingOnLoad();

</script>
  </div>
</body>
<input hidden id="copy" />
<script>
  //拿来主义(真香)^_^，Clipboard 实现摘自掘金 https://juejin.im/post/5aefeb6e6fb9a07aa43c20af
  window.Clipboard = (function (window, document, navigator) {
    var textArea,
      copy;

    // 判断是不是ios端
    function isOS() {
      return navigator.userAgent.match(/ipad|iphone/i);
    }
    //创建文本元素
    function createTextArea(text) {
      textArea = document.createElement('textArea');
      textArea.value = text;
      textArea.style.width = 0;
      textArea.style.height = 0;
      textArea.clientHeight = 0;
      textArea.clientWidth = 0;
      document.body.appendChild(textArea);
    }
    //选择内容
    function selectText() {
      var range,
        selection;

      if (isOS()) {
        range = document.createRange();
        range.selectNodeContents(textArea);
        selection = window.getSelection();
        selection.removeAllRanges();
        selection.addRange(range);
        textArea.setSelectionRange(0, 999999);
      } else {
        textArea.select();
      }
    }

    //复制到剪贴板
    function copyToClipboard() {
      try {
        document.execCommand("Copy")
      } catch (err) {
        alert("复制错误！请手动复制！")
      }
      document.body.removeChild(textArea);
    }

    copy = function (text) {
      createTextArea(text);
      selectText();
      copyToClipboard();
    };

    return {
      copy: copy
    };
  })(window, document, navigator);

  function copyCode(e) {
    if (e.srcElement.tagName === 'SPAN' && e.srcElement.classList.contains('copy-code')) {
      let code = e.currentTarget.querySelector('code');
      var text = code.innerText;
      if (e.srcElement.textContent === '复制成功') {
        console.log('复制操作频率过高');
        return;
      }
      e.srcElement.textContent = '复制成功';
      (function (elem) {
        setTimeout(() => {
          if (elem.textContent === '复制成功') {
            elem.textContent = '复制代码'
          }
        }, 1000);
      })(e.srcElement)
      Clipboard.copy(text);
    }
  }

  let pres = document.querySelectorAll('pre');
  pres.forEach(pre => {
    let code = pre.querySelector('code');
    let copyElem = document.createElement('span');
    copyElem.classList.add('copy-code');
    copyElem.textContent = '复制代码';
    pre.appendChild(copyElem);
    pre.onclick = copyCode
  })
</script>
<script src="/media/js/motion.js"></script>

<script src="https://cdn.jsdelivr.net/gh/cferdinandi/smooth-scroll/dist/smooth-scroll.polyfills.min.js"></script>
<script>
  var scroll = new SmoothScroll('a[href*="#"]', {
    speed: 500
  });
</script>

<!-- <div class="search-mask" id="search_mask">
  <div class="search-box">
    <div class="search-title">
      <i class="fa fa-search"></i>
      <div class="input-box">
        <input type="text" placeholder="搜索">
      </div>
      <i class="fa fa-times-circle"></i>
    </div>
    <div class="result">
      
      <div class="item">
        <a class="result-title" href="https://tomhht.github.io/post/gan-diao-win10-wan-gu-bu-hua-de-mou-kuai-su-fang-wen-gu-ding-xiang/"" data-c="
          &lt;p&gt;快速访问里有个Documents死活无法取消固定，点了又说不存在，让删又删不了，lese。&lt;/p&gt;
&lt;!-- more --&gt;
&lt;p&gt;感谢参考链接的作者，该方法效若桴鼓。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;注意事项：该方法会删除快速访问里的所有内容，考虑清楚再动手。（我的本来就只有我的电脑和烦人的那项，所以果断kill）&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ol&gt;
&lt;li&gt;拷贝&lt;code&gt;%APPDATA%\Microsoft\Windows\Recent\AutomaticDestinations&lt;/code&gt;至 运行 或 文件夹地址栏，回车；&lt;/li&gt;
&lt;li&gt;删除其中文件&lt;code&gt;f01b4d95cf55d32a.automaticDestinations-ms&lt;/code&gt;。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;DONE，整个世界都清净了。&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;参考链接：&lt;br&gt;
&lt;a href=&#34;https://blog.csdn.net/yin0hao/article/details/88052343&#34;&gt;Windows 10 快速访问异常:无法取消固定,的解决方法&lt;/a&gt;&lt;/p&gt;
">干掉Win10顽固不化的某快速访问固定项</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://tomhht.github.io/post/an-zhuang-prometheus-operator/"" data-c="
          &lt;p&gt;众所周知的原因搞得安装起来太复杂了，并且helm的prometheus operator的chart项目还迁移过，更有点云里雾里。&lt;/p&gt;
&lt;!-- more --&gt;
&lt;h1 id=&#34;创建专用namespace&#34;&gt;创建专用namespace&lt;/h1&gt;
&lt;p&gt;先创建个namespace来用。&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;kubectl create namespace monitoring
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;单独安装crd&#34;&gt;单独安装CRD&lt;/h1&gt;
&lt;p&gt;CRD就是Custom Resource Definition。&lt;br&gt;
本来应该是&lt;code&gt;helm install kube-prometheus-stack&lt;/code&gt;的时候就能装，but as you know..&lt;br&gt;
通过科学上网，先下载yaml再说：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# 整齐点儿
mkdir -p ~/helm/prometheus-operator
cd ~/helm/prometheus-operator

# 下载yaml
curl -x http://192.168.127.1:58591 -fsSLO https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/master/example/prometheus-operator-crd/monitoring.coreos.com_alertmanagers.yaml
curl -x http://192.168.127.1:58591 -fsSLO https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/master/example/prometheus-operator-crd/monitoring.coreos.com_podmonitors.yaml
curl -x http://192.168.127.1:58591 -fsSLO https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/master/example/prometheus-operator-crd/monitoring.coreos.com_probes.yaml
curl -x http://192.168.127.1:58591 -fsSLO https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/master/example/prometheus-operator-crd/monitoring.coreos.com_prometheuses.yaml
curl -x http://192.168.127.1:58591 -fsSLO https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/master/example/prometheus-operator-crd/monitoring.coreos.com_prometheusrules.yaml
curl -x http://192.168.127.1:58591 -fsSLO https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/master/example/prometheus-operator-crd/monitoring.coreos.com_servicemonitors.yaml
curl -x http://192.168.127.1:58591 -fsSLO https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/master/example/prometheus-operator-crd/monitoring.coreos.com_thanosrulers.yaml

# 安装
kubectl apply -f .
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;安装-kube-prometheus-stack&#34;&gt;安装 kube-prometheus-stack&lt;/h1&gt;
&lt;p&gt;kube-prometheus-stack基于prometheus-operator制作，并集成了依赖&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;stable/kube-state-metrics&lt;/li&gt;
&lt;li&gt;stable/prometheus-node-exporter&lt;/li&gt;
&lt;li&gt;grafana/grafana&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code&gt;# 安装
helm install kube-prometheus-stack prometheus-community/kube-prometheus-stack --set prometheusOperator.createCustomResource=false -n monitoring
# 查看安装情况
kubectl -n monitoring get deployments
NAME                                       READY   UP-TO-DATE   AVAILABLE   AGE
kube-prometheus-stack-grafana              1/1     1            1           4h30m
kube-prometheus-stack-kube-state-metrics   1/1     1            1           4h30m
kube-prometheus-stack-operator             1/1     1            1           4h30m

kubectl -n monitoring get pods -owide
NAME                                                        READY   STATUS    RESTARTS   AGE     IP                NODE           NOMINATED NODE   READINESS GATES
alertmanager-kube-prometheus-stack-alertmanager-0           2/2     Running   2          4h14m   10.244.1.32       mini-ubuntu    &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;
kube-prometheus-stack-grafana-8b85d667c-5w8sn               2/2     Running   4          4h32m   10.244.2.23       mini-centos    &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;
kube-prometheus-stack-kube-state-metrics-5cf575d8f8-6m7jt   1/1     Running   1          4h32m   10.244.1.33       mini-ubuntu    &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;
kube-prometheus-stack-operator-65fbd96bdb-9zhmz             2/2     Running   6          4h32m   10.244.2.21       mini-centos    &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;
kube-prometheus-stack-prometheus-node-exporter-68sxv        1/1     Running   2          4h32m   192.168.127.133   mini-centos    &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;
kube-prometheus-stack-prometheus-node-exporter-864w9        1/1     Running   1          4h32m   192.168.127.132   ubuntuserver   &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;
kube-prometheus-stack-prometheus-node-exporter-nr274        1/1     Running   1          4h32m   192.168.127.134   mini-ubuntu    &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;
prometheus-kube-prometheus-stack-prometheus-0               3/3     Running   6          4h14m   10.244.2.22       mini-centos    &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;遇到问题往后看。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&#34;安装过程的troubleshooting&#34;&gt;安装过程的Troubleshooting&lt;/h1&gt;
&lt;p&gt;安装过程各种报错，当然主要是镜像pull不下来，尤其是&lt;code&gt;quay.io&lt;/code&gt;的镜像。(我的挺奇怪，居然自己pull成功了几个&lt;code&gt;quay.io&lt;/code&gt;)&lt;/p&gt;
&lt;h2 id=&#34;排查问题&#34;&gt;排查问题&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;kubectl -n monitoring describe pods prometheus-kube-prometheus-stack-prometheus-0

Events:
  Type     Reason   Age                    From                  Message
  ----     ------   ----                   ----                  -------
  Normal   Pulling  60m (x4 over 83m)      kubelet, mini-centos  Pulling image &amp;quot;quay.io/coreos/prometheus-config-reloader:v0.38.1&amp;quot;
  Warning  Failed   58m (x4 over 79m)      kubelet, mini-centos  Failed to pull image &amp;quot;quay.io/coreos/prometheus-config-reloader:v0.38.1&amp;quot;: rpc error: code = Unknown desc = context canceled
  Warning  Failed   58m (x4 over 79m)      kubelet, mini-centos  Error: ErrImagePull
  Normal   Pulling  58m (x5 over 100m)     kubelet, mini-centos  Pulling image &amp;quot;quay.io/prometheus/prometheus:v2.18.2&amp;quot;
  Normal   Pulled   47m                    kubelet, mini-centos  Successfully pulled image &amp;quot;quay.io/coreos/prometheus-config-reloader:v0.38.1&amp;quot; in 1m11.597994512s
  Warning  Failed   22m (x11 over 83m)     kubelet, mini-centos  Error: ErrImagePull
  Normal   BackOff  13m (x130 over 56m)    kubelet, mini-centos  Back-off pulling image &amp;quot;quay.io/prometheus/prometheus:v2.18.2&amp;quot;
  Warning  Failed   8m15s (x145 over 56m)  kubelet, mini-centos  Error: ImagePullBackOff
  Warning  Failed   3m13s (x14 over 83m)   kubelet, mini-centos  Failed to pull image &amp;quot;quay.io/prometheus/prometheus:v2.18.2&amp;quot;: rpc error: code = Unknown desc = context canceled
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;解决&#34;&gt;解决&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;google prometheus v2.18.2&lt;/code&gt;居然发现&lt;code&gt;docker hub&lt;/code&gt;里有，于是在&lt;code&gt;mini-centos&lt;/code&gt;主机上：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;docker pull prom/prometheus:v2.18.2
v2.18.2: Pulling from prom/prometheus
0f8c40e1270f: Already exists 
626a2a3fee8c: Already exists 
dde61fbb486b: Already exists 
22b936665674: Downloading [=================================================&amp;gt; ]  20.66MB/20.76MB
b9cb37b79bc0: Download complete 
a14008f52cd5: Download complete 
c89901a55493: Waiting 
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;就定这儿了，遂祭起重启docker大法：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;sudo systemctl restart docker
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;重启完后，接着：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;docker pull prom/prometheus:v2.18.2
v2.18.2: Pulling from prom/prometheus
0f8c40e1270f: Already exists 
626a2a3fee8c: Already exists 
dde61fbb486b: Already exists 
22b936665674: Pull complete 
b9cb37b79bc0: Pull complete 
a14008f52cd5: Pull complete 
c89901a55493: Pull complete 
6caddd047c54: Pull complete 
ddd1779460e5: Pull complete 
f65cc1a7f25d: Pull complete 
4be7bc9429a7: Pull complete 
2d296d78b122: Pull complete 
Digest: sha256:4d3303d1eb424e345cf48969bb7575d4d58472ad783ac41ea07fba92686f7ef5
Status: Downloaded newer image for prom/prometheus:v2.18.2
docker.io/prom/prometheus:v2.18.2
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;再检查：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;kubectl -n monitoring get pods -owide
NAME                                                        READY   STATUS    RESTARTS   AGE     IP                NODE           NOMINATED NODE   READINESS GATES
alertmanager-kube-prometheus-stack-alertmanager-0           2/2     Running   2          4h14m   10.244.1.32       mini-ubuntu    &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;
kube-prometheus-stack-grafana-8b85d667c-5w8sn               2/2     Running   4          4h32m   10.244.2.23       mini-centos    &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;
kube-prometheus-stack-kube-state-metrics-5cf575d8f8-6m7jt   1/1     Running   1          4h32m   10.244.1.33       mini-ubuntu    &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;
kube-prometheus-stack-operator-65fbd96bdb-9zhmz             2/2     Running   6          4h32m   10.244.2.21       mini-centos    &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;
kube-prometheus-stack-prometheus-node-exporter-68sxv        1/1     Running   2          4h32m   192.168.127.133   mini-centos    &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;
kube-prometheus-stack-prometheus-node-exporter-864w9        1/1     Running   1          4h32m   192.168.127.132   ubuntuserver   &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;
kube-prometheus-stack-prometheus-node-exporter-nr274        1/1     Running   1          4h32m   192.168.127.134   mini-ubuntu    &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;
prometheus-kube-prometheus-stack-prometheus-0               3/3     Running   6          4h14m   10.244.2.22       mini-centos    &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;全都ready了。&lt;br&gt;
如有其他pull问题，应该可以如法炮制。&lt;/p&gt;
&lt;h1 id=&#34;暴露服务&#34;&gt;暴露服务&lt;/h1&gt;
&lt;h2 id=&#34;查看服务&#34;&gt;查看服务&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;kubectl -n monitoring get svc
NAME                                             TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)                      AGE
alertmanager-operated                            ClusterIP   None             &amp;lt;none&amp;gt;        9093/TCP,9094/TCP,9094/UDP   4h16m
kube-prometheus-stack-alertmanager               ClusterIP   10.101.245.140   &amp;lt;none&amp;gt;        9093/TCP                     4h34m
kube-prometheus-stack-grafana                    ClusterIP   10.106.193.98    &amp;lt;none&amp;gt;        80/TCP                       4h34m
kube-prometheus-stack-kube-state-metrics         ClusterIP   10.108.208.70    &amp;lt;none&amp;gt;        8080/TCP                     4h34m
kube-prometheus-stack-operator                   ClusterIP   10.110.217.187   &amp;lt;none&amp;gt;        8080/TCP,443/TCP             4h34m
kube-prometheus-stack-prometheus                 ClusterIP   10.104.189.224   &amp;lt;none&amp;gt;        9090/TCP                     4h34m
kube-prometheus-stack-prometheus-node-exporter   ClusterIP   10.102.189.12    &amp;lt;none&amp;gt;        9100/TCP                     4h34m
prometheus-operated                              ClusterIP   None             &amp;lt;none&amp;gt;        9090/TCP                     4h16m
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;改nodeport&#34;&gt;改NodePort&lt;/h2&gt;
&lt;p&gt;把下面服务的type改成NodePort：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;kubectl -n monitoring edit svc kube-prometheus-stack-prometheus
kubectl -n monitoring edit svc kube-prometheus-stack-alertmanager
kubectl -n monitoring edit svc kube-prometheus-stack-grafana

kubectl -n monitoring get svc
NAME                                             TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)                      AGE
alertmanager-operated                            ClusterIP   None             &amp;lt;none&amp;gt;        9093/TCP,9094/TCP,9094/UDP   4h51m
kube-prometheus-stack-alertmanager               NodePort    10.101.245.140   &amp;lt;none&amp;gt;        9093:31386/TCP               5h9m
kube-prometheus-stack-grafana                    NodePort    10.106.193.98    &amp;lt;none&amp;gt;        80:30835/TCP                 5h9m
kube-prometheus-stack-kube-state-metrics         ClusterIP   10.108.208.70    &amp;lt;none&amp;gt;        8080/TCP                     5h9m
kube-prometheus-stack-operator                   ClusterIP   10.110.217.187   &amp;lt;none&amp;gt;        8080/TCP,443/TCP             5h9m
kube-prometheus-stack-prometheus                 NodePort    10.104.189.224   &amp;lt;none&amp;gt;        9090:30098/TCP               5h9m
kube-prometheus-stack-prometheus-node-exporter   ClusterIP   10.102.189.12    &amp;lt;none&amp;gt;        9100/TCP                     5h9m
prometheus-operated                              ClusterIP   None             &amp;lt;none&amp;gt;        9090/TCP                     4h51m
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;访问prometheus&#34;&gt;访问prometheus&lt;/h1&gt;
&lt;p&gt;打开http://192.168.127.132:30098/targets，一部分up一部分down，点Unhealthy&lt;br&gt;
&lt;img src=&#34;https://tomhht.github.io/post-images/1600245194725.png&#34; alt=&#34;unhealthy&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;解决down的部分&#34;&gt;解决down的部分&lt;/h2&gt;
&lt;h3 id=&#34;etcd的down&#34;&gt;etcd的down&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;搞了1.5天，搜到的各种资料都无法适用，结合各家之言，再无数次尝试才勉强有结果。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;pre&gt;&lt;code&gt;sudo vim /etc/kubernetes/manifests/etcd.yaml
# 找到
- --listen-client-urls=https://127.0.0.1:2379,https://192.168.127.132:2379
# 修改为
- --listen-client-urls=https://0.0.0.0:2379,http://0.0.0.0:2379
# 重启全部container（实际上是停止命令，k8s会自动全部启动）
docker stop $(docker ps -q)
&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;挺奇葩的一点是，down变为up后，我又改回原配置，再重启全部container，依然保持up状态，存疑ing。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;kube-scheduler的down&#34;&gt;kube-scheduler的down&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;sudo vim /etc/kubernetes/manifests/kube-scheduler.yaml
//改为- --bind-address=0.0.0.0
//删行- --port=0
//稍等几秒即可
&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;这个要特别感谢度娘帮我搜到的&lt;a href=&#34;https://llovewxm1314.blog.csdn.net/article/details/108458197&#34;&gt;解决kubernetes:v1.18.6-1.19.0 get cs127.0.0.1 connection refused错误&lt;/a&gt;。一个port你说你默认等于0干啥，你自己都unhealthy你说prometheus哪儿能监控得到。感谢原作者，n个小时后终于破案。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;kube-controller-manager的down&#34;&gt;kube-controller-manager的down&lt;/h3&gt;
&lt;p&gt;修改套路同kube-scheduler。&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;sudo vim /etc/kubernetes/manifests/kube-controller-manager.yaml
//改为- --bind-address=0.0.0.0
//删行- --port=0
//稍等几秒即可
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;node-exporter的down&#34;&gt;node-exporter的down&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;kubectl -n monitoring edit ds kube-prometheus-stack-prometheus-node-exporter
//删掉 hostNetwork: true 一行
//稍等几秒即可
//还没尝试helm给参数的方式，有机会试试override the hostNetwork setting using a values file with -f option
&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;特别感谢google来的&lt;a href=&#34;https://vividcode.io/fix-context-deadline-exceeded-error-in-prometheus-operator/&#34;&gt;Fix Context Deadline Exceeded Error in Prometheus Operator&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;kube-proxy的down尚未搞定&#34;&gt;kube-proxy的down（尚未搞定）&lt;/h3&gt;
&lt;p&gt;暂时跳过，快崩溃了（人），下面的方法用了根本不行，google bing baidu齐上阵，前前后后得搞了1天。好心的哪位，请帮忙留言提供解决办法。&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# 可能用得到的指令
kubectl -n kube-system edit cm kube-proxy  //改metricsBindAddress: 为 0.0.0.0:10249
kubectl delete pod -l k8s-app=kube-proxy -n kube-system
// 按上面的操作，完全没效果，晕
sudo netstat -ntlp | grep kube
sudo ss -ntlp | grep kube
&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;这是第一个开始搞的，结果其他都搞定了，它还岿然不动。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&#34;grafana篇章&#34;&gt;Grafana篇章&lt;/h1&gt;
&lt;p&gt;kube-prometheus-stack里已经自带Grafana，因此无需安装。&lt;/p&gt;
&lt;h2 id=&#34;访问grafana&#34;&gt;访问grafana&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;kubectl -n monitoring get svc //找到grafana的端口，然后浏览器访问http://IP:PORT
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;用户名/密码是？&lt;/strong&gt;&lt;br&gt;
一堆说&lt;code&gt;admin/admin&lt;/code&gt;的，然而这个环境不适用。&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;用户名：admin
密码：prom-operator
&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;特别感谢&lt;a href=&#34;https://devstack.in/2020/05/25/deploy-prometheus-operator-with-helm3-and-private-registry/&#34;&gt;Deploy Prometheus Operator with Helm3 and Private Registry&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;漂亮&lt;/strong&gt;&lt;br&gt;
&lt;img src=&#34;https://tomhht.github.io/post-images/1600249518889.png&#34; alt=&#34;UI&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
&lt;strong&gt;随便选一个&lt;/strong&gt;&lt;br&gt;
&lt;img src=&#34;https://tomhht.github.io/post-images/1600249787073.png&#34; alt=&#34;gorgeous&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;参考链接：&lt;br&gt;
&lt;a href=&#34;https://github.com/prometheus-community/helm-charts/tree/main/charts/kube-prometheus-stack&#34;&gt;https://github.com/prometheus-community/helm-charts/tree/main/charts/kube-prometheus-stack&lt;/a&gt;&lt;br&gt;
&lt;a href=&#34;https://github.com/prometheus-operator/prometheus-operator&#34;&gt;https://github.com/prometheus-operator/prometheus-operator&lt;/a&gt;&lt;br&gt;
&lt;a href=&#34;https://github.com/prometheus-operator/kube-prometheus&#34;&gt;https://github.com/prometheus-operator/kube-prometheus&lt;/a&gt;&lt;br&gt;
&lt;a href=&#34;https://www.bookstack.cn/read/kubernetes-learning-0.2.0/docs-58.Prometheus%20Operator.md&#34;&gt;https://www.bookstack.cn/read/kubernetes-learning-0.2.0/docs-58.Prometheus%20Operator.md&lt;/a&gt;&lt;br&gt;
&lt;a href=&#34;https://www.qikqiak.com/post/prometheus-operator-monitor-etcd/&#34;&gt;https://www.qikqiak.com/post/prometheus-operator-monitor-etcd/&lt;/a&gt;&lt;br&gt;
&lt;a href=&#34;https://blog.fleeto.us/post/node-downtime/&#34;&gt;https://blog.fleeto.us/post/node-downtime/&lt;/a&gt;&lt;br&gt;
&lt;a href=&#34;https://llovewxm1314.blog.csdn.net/article/details/108458197&#34;&gt;解决kubernetes:v1.18.6-1.19.0 get cs127.0.0.1 connection refused错误&lt;/a&gt;&lt;br&gt;
&lt;a href=&#34;https://vividcode.io/fix-context-deadline-exceeded-error-in-prometheus-operator/&#34;&gt;Fix Context Deadline Exceeded Error in Prometheus Operator&lt;/a&gt;&lt;br&gt;
&lt;a href=&#34;https://devstack.in/2020/05/25/deploy-prometheus-operator-with-helm3-and-private-registry/&#34;&gt;Deploy Prometheus Operator with Helm3 and Private Registry&lt;/a&gt;&lt;br&gt;
稍后阅读：&lt;br&gt;
&lt;a href=&#34;https://www.qikqiak.com/post/k8s-hpa-usage/&#34;&gt;Kubernetes HPA 使用详解&lt;/a&gt;&lt;br&gt;
&lt;a href=&#34;https://blog.51cto.com/14143894/2438026&#34;&gt;Kubernetes运维之使用Prometheus全方位监控K8S&lt;/a&gt;&lt;/p&gt;
">helm安装kube-prometheus-stack</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://tomhht.github.io/post/zui-xiao-hua-an-zhuang-centos-hou-de-she-zhi/"" data-c="
          &lt;p&gt;最小化安装centos 8后的设置。&lt;/p&gt;
&lt;!-- more --&gt;
&lt;h1 id=&#34;更换国内源&#34;&gt;更换国内源&lt;/h1&gt;
&lt;p&gt;参考&lt;a href=&#34;/post/pei-zhi-ubuntu-he-centos-qing-hua-yuan&#34;&gt;配置清华源&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;安装epel&#34;&gt;安装epel&lt;/h1&gt;
&lt;pre&gt;&lt;code&gt;sudo yum install epel-release
# 更换清华源
sudo sed -e &#39;s!^metalink=!#metalink=!g&#39; \
    -e &#39;s!^#baseurl=!baseurl=!g&#39; \
    -e &#39;s!//download\.fedoraproject\.org/pub!//mirrors.tuna.tsinghua.edu.cn!g&#39; \
    -e &#39;s!http://mirrors\.tuna!https://mirrors.tuna!g&#39; \
    -i /etc/yum.repos.d/epel.repo /etc/yum.repos.d/epel-testing.repo
sudo yum makecache
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;更新软件&#34;&gt;更新软件&lt;/h1&gt;
&lt;pre&gt;&lt;code&gt;yum check-update
sudo yum upgrade
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;设置时区和ntp&#34;&gt;设置时区和NTP&lt;/h1&gt;
&lt;pre&gt;&lt;code&gt;timedatectl set-timezone Asia/Shanghai
sudo yum install chrony
sudo systemctl enable --now chronyd
timedatectl status
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;自动补全&#34;&gt;自动补全&lt;/h1&gt;
&lt;pre&gt;&lt;code&gt;sudo yum install bash-completion
source ~/.bashrc
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;安装wget&#34;&gt;安装wget&lt;/h1&gt;
&lt;pre&gt;&lt;code&gt;sudo yum -y install wget
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;其他有用的记录&#34;&gt;其他有用的记录&lt;/h1&gt;
&lt;pre&gt;&lt;code&gt;# 找程序所属的包
yum whatprovides netstat
&lt;/code&gt;&lt;/pre&gt;
&lt;hr&gt;
&lt;p&gt;参考链接：&lt;br&gt;
&lt;a href=&#34;https://www.cnblogs.com/fengdejiyixx/p/11592417.html&#34;&gt;Centos和Ubuntu系统最小化安装基础命令&lt;/a&gt;&lt;br&gt;
&lt;a href=&#34;https://linuxconfig.org/ubuntu-20-04-server-installation&#34;&gt;Ubuntu 20.04 Server Installation&lt;/a&gt;&lt;/p&gt;
">最小化安装centos和ubuntu之后的配置</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://tomhht.github.io/post/shi-yong-virsh-shan-chu-kvm-xu-ni-ji/"" data-c="
          &lt;p&gt;发现libvirt/images下有个qcow2文件挺大，于是想用virsh安全删掉。&lt;/p&gt;
&lt;!-- more --&gt;
&lt;h1 id=&#34;列出虚拟机&#34;&gt;列出虚拟机&lt;/h1&gt;
&lt;p&gt;开始没用sudo，结果啥都没有，明明记得之前搞过俩呢。&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;sudo virsh list --all
 Id    Name                           State
----------------------------------------------------
 -     vm1                            shut off
 -     vm2                            shut off
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;检查虚拟机配置&#34;&gt;检查虚拟机配置&lt;/h1&gt;
&lt;pre&gt;&lt;code&gt;sudo virsh dumpxml vm1 | grep &#39;source file&#39;
    &amp;lt;source file=&#39;/var/lib/libvirt/images/cirros-0.5.1-x86_64-disk.img&#39;/&amp;gt;
    &amp;lt;source file=&#39;/var/lib/libvirt/images/vm1.qcow2&#39;/&amp;gt; #要删这个
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;编辑配置&#34;&gt;编辑配置&lt;/h1&gt;
&lt;p&gt;确保该虚拟机未运行。删除配置中挂载&lt;code&gt;vm1.qcow2&lt;/code&gt;的段落。&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;sudo virsh edit vm1
# 删除这段
    &amp;lt;disk type=&#39;file&#39; device=&#39;disk&#39;&amp;gt;
      &amp;lt;driver name=&#39;qemu&#39; type=&#39;qcow2&#39;/&amp;gt;
      &amp;lt;source file=&#39;/var/lib/libvirt/images/vm1.qcow2&#39;/&amp;gt;
      &amp;lt;target dev=&#39;hda&#39; bus=&#39;ide&#39;/&amp;gt;
      &amp;lt;address type=&#39;drive&#39; controller=&#39;0&#39; bus=&#39;0&#39; target=&#39;0&#39; unit=&#39;1&#39;/&amp;gt;
    &amp;lt;/disk&amp;gt; 
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;删除文件&#34;&gt;删除文件&lt;/h1&gt;
&lt;pre&gt;&lt;code&gt;sudo rm /var/lib/libvirt/images/vm1.qcow2
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;搞定。&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;参考链接：&lt;br&gt;
&lt;a href=&#34;https://huataihuang.gitbooks.io/cloud-atlas/content/virtual/kvm/startup/in_action/delete_a_running_vm_on_kvm.html&#34;&gt;使用virsh删除运行的KVM VM · Cloud Atlas&lt;/a&gt;&lt;br&gt;
&lt;a href=&#34;https://www.jianshu.com/p/5111134452a8&#34;&gt;KVM磁盘扩容和添加&lt;/a&gt;&lt;/p&gt;
">使用virsh删除kvm虚拟机</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://tomhht.github.io/post/zai-ubuntu-shang-yong-snap-an-zhuang-helm/"" data-c="
          &lt;p&gt;命令挺简单，就是速度很感人。&lt;/p&gt;
&lt;!-- more --&gt;
&lt;h1 id=&#34;安装&#34;&gt;安装&lt;/h1&gt;
&lt;pre&gt;&lt;code&gt;sudo snap install helm --classic
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;安装过慢的解决办法还没尝试，参考链接先记录下来了，先谢谢原作者。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;据官方说明，Helm 3已经不需要Tiller了，所以其他参考资料上安装Tiller的步骤直接跳过。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&#34;配置&#34;&gt;配置&lt;/h1&gt;
&lt;h2 id=&#34;自动补全&#34;&gt;自动补全&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;echo &#39;source &amp;lt;(helm completion bash)&#39; &amp;gt;&amp;gt;~/.bashrc
source ~/.bashrc #使配置立刻生效
&lt;/code&gt;&lt;/pre&gt;
&lt;hr&gt;
&lt;p&gt;参考链接：&lt;br&gt;
&lt;a href=&#34;https://helm.sh/&#34;&gt;Helm官方&lt;/a&gt;&lt;br&gt;
&lt;a href=&#34;https://kuricat.com/gist/snap-install-too-slow-zmbjy&#34;&gt;snap install 过慢 的解决方法 @Kurisu&lt;/a&gt;&lt;/p&gt;
">在Ubuntu上用snap安装Helm</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://tomhht.github.io/post/pei-zhi-nfs/"" data-c="
          &lt;p&gt;学习nfs的配置，并测试k8s部署mysql挂载nfs的方式。&lt;/p&gt;
&lt;!-- more --&gt;
&lt;h1 id=&#34;配置nfs&#34;&gt;配置nfs&lt;/h1&gt;
&lt;h2 id=&#34;ubuntu&#34;&gt;Ubuntu&lt;/h2&gt;
&lt;p&gt;先将参考链接放这儿。&lt;a href=&#34;https://www.digitalocean.com/community/tutorials/how-to-set-up-an-nfs-mount-on-ubuntu-20-04&#34;&gt;How To Set Up an NFS Mount on Ubuntu 20.04&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;centos&#34;&gt;CentOS&lt;/h2&gt;
&lt;p&gt;&lt;a href=&#34;https://qizhanming.com/blog/2018/08/08/how-to-install-nfs-on-centos-7&#34;&gt;CentOS 7 下 yum 安装和配置 NFS&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;k8s测试遇到的问题&#34;&gt;k8s测试遇到的问题&lt;/h1&gt;
&lt;h2 id=&#34;镜像pull不下来&#34;&gt;镜像pull不下来&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;问题描述&lt;/strong&gt;&lt;br&gt;
测试mysql挂载nfs失败了n次，一开始是镜像pull不下来。&lt;br&gt;
&lt;strong&gt;解决&lt;/strong&gt;&lt;br&gt;
后来添加阿里云加速器后重启node上的docker &lt;code&gt;sudo systemctl restart docker.service&lt;/code&gt;解决了pull的问题。&lt;/p&gt;
&lt;h2 id=&#34;pod遇到backoff的错误&#34;&gt;pod遇到backoff的错误&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;问题描述&lt;/strong&gt;&lt;br&gt;
pull下来了还是运行失败，pod总是显示backoff &lt;code&gt;Back-off restarting failed container&lt;/code&gt;的错误，通过&lt;code&gt;kubectl logs &amp;lt;mysql pod的名字&amp;gt;&lt;/code&gt;发现&lt;code&gt;chown: changing ownership of &#39;/var/lib/mysql/&#39;: Operation not permitted&lt;/code&gt;错误。&lt;br&gt;
&lt;strong&gt;解决&lt;/strong&gt;&lt;br&gt;
nfs配置文件&lt;code&gt;/etc/exports&lt;/code&gt;里，加上了&lt;code&gt;no_root_squash&lt;/code&gt;的选项。&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;参考链接：&lt;br&gt;
&lt;a href=&#34;https://www.digitalocean.com/community/tutorials/how-to-set-up-an-nfs-mount-on-ubuntu-20-04&#34;&gt;How To Set Up an NFS Mount on Ubuntu 20.04&lt;/a&gt;&lt;br&gt;
&lt;a href=&#34;https://qizhanming.com/blog/2018/08/08/how-to-install-nfs-on-centos-7&#34;&gt;CentOS 7 下 yum 安装和配置 NFS&lt;/a&gt;&lt;/p&gt;
">k8s测试mysql挂载nfs遇到的问题</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://tomhht.github.io/post/kubernetes-busybox-nslookup-ti-shi-wu-fa-jie-xi-de-wen-ti/"" data-c="
          &lt;p&gt;使用默认版本的busybox会出现nslookup提示无法解析的问题。使用1.28.3版本即可解决。&lt;/p&gt;
&lt;!-- more --&gt;
&lt;p&gt;症状：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;kubectl run busybox --rm -it --image=busybox /bin/sh
/ # nslookup httpd-svc
Server:		10.96.0.10
Address:	10.96.0.10:53

** server can&#39;t find httpd-svc.default.svc.cluster.local: NXDOMAIN

*** Can&#39;t find httpd-svc.svc.cluster.local: No answer
*** Can&#39;t find httpd-svc.cluster.local: No answer
*** Can&#39;t find httpd-svc.default.svc.cluster.local: No answer
*** Can&#39;t find httpd-svc.svc.cluster.local: No answer
*** Can&#39;t find httpd-svc.cluster.local: No answer
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;解决：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;kubectl run busybox --rm -it --image=busybox:1.28.3 /bin/sh
If you don&#39;t see a command prompt, try pressing enter.
/ # nslookup httpd-svc
Server:    10.96.0.10
Address 1: 10.96.0.10 kube-dns.kube-system.svc.cluster.local

Name:      httpd-svc
Address 1: 10.108.142.200 httpd-svc.default.svc.cluster.local
&lt;/code&gt;&lt;/pre&gt;
&lt;hr&gt;
&lt;p&gt;参考链接：&lt;br&gt;
&lt;a href=&#34;https://www.cnblogs.com/vincenshen/p/9751193.html&#34;&gt;https://www.cnblogs.com/vincenshen/p/9751193.html&lt;/a&gt;&lt;/p&gt;
">Kubernetes busybox nslookup提示无法解析的问题</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://tomhht.github.io/post/di-yi-ci-zheng-shi-kai-che/"" data-c="
          &lt;p&gt;拿了本大半年了，昨天第一次正式开车。&lt;/p&gt;
&lt;!-- more --&gt;
&lt;p&gt;太刺激了。画龙、剐蹭、油合离门，应有尽有。科三考了3次才过，考过后抽奖中了一个陪练机会，跟着教练开了趟易县（同练的还有其他学员）。这就是之前全部的开车经历了。&lt;br /&gt;&lt;br&gt;
昨天因为要接侄子，学校在一个鸟不拉屎的地方，约不到车，所以硬着头皮把家里的车开出来了。首先找地方掉头，光顾着看后面，结果车头蹭人家墙上了，引得人家出来检查。&lt;br /&gt;&lt;br&gt;
好不容易掉好头，跟别的车交汇，一闪躲，噌，又是一声，之前左边，这次右边。&lt;br /&gt;&lt;br&gt;
继续前行，后来想想，居然当时心态没崩。&lt;br /&gt;&lt;br&gt;
画龙前行，志玲姐姐忽然来一句右转立刻左转，我这路口到底怎么走啊，遂决定直接左转，进了左转车道等红灯，发现右转后走10米果然有左转路，WTF。左转车道硬着头皮左转完了，终于找到一个路口直接掉头，走上了康庄大道。&lt;br /&gt;&lt;br&gt;
转完了突然道路宽阔了起来，路上也没几辆车，于是let&#39;s go，4档的干活，这感觉就是乌龟爬到了兔子身上。&lt;br /&gt;&lt;br&gt;
到校后，等了几个钟头，中途又开着出去练练手，接上娃后返程的路途也算有惊无险，终于平安的运送回家。庆幸的是这一路没有倒车入库、侧方停车之类的技术活。万幸。&lt;/p&gt;
">第一次正式开车</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://tomhht.github.io/post/k8s-ji-qun-kua-jie-dian-pods-wu-fa-ping-tong/"" data-c="
          &lt;p&gt;除了k8s要求的端口要开，worker node上面的&lt;code&gt;8472/udp（vxlan backend）&lt;/code&gt;也得开。（尽管参考链接里明确的是worker node要开，但master似乎也得开，否则master里面的coredns无法为worker node服务）&lt;/p&gt;
&lt;!-- more --&gt;
&lt;p&gt;用&lt;code&gt;nmcli&lt;/code&gt;查看，发现flannel 用到的是&lt;code&gt;vxlan backend&lt;/code&gt;，因此需要打开&lt;code&gt;8472/udp&lt;/code&gt;。&lt;br  /&gt;&lt;br&gt;
打开后，发现Ubuntu的node可以被ping通，同时如果上面跑着&lt;code&gt;httpd&lt;/code&gt;，其他node也可以&lt;code&gt;curl&lt;/code&gt;到内容；而CentOS只能被ping通，&lt;code&gt;curl 10.244.2.19&lt;/code&gt;的时候会显示&lt;code&gt;curl: (7) Failed to connect to 10.244.2.19 port 80: No route to host&lt;/code&gt;。&lt;br /&gt;&lt;br&gt;
查了n多资料，几乎都是关闭防火墙，关闭后确实能解决，但我想这不是生产环境中的做法。最终在这位仁兄Louis He的博文&lt;a href=&#34;https://www.cnblogs.com/Dev0ps/p/11401530.html&#34;&gt;Kubernetes集群开启Firewall&lt;/a&gt;中找到答案&lt;code&gt;add-masquerade&lt;/code&gt;。同时也谢谢让我找到8472端口的仁兄&lt;a href=&#34;https://www.codenong.com/39293441/&#34;&gt;关于网络：Kubernetes集群所需的端口&lt;/a&gt;。&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# Ubuntu
sudo ufw allow 8472/udp #搞定

# CentOS
sudo firewall-cmd --zone=public --add-port=8472/udp --permanent
sudo firewall-cmd --reload #这步搞完只能被ping通，curl时是No route to host，头疼死了
sudo firewall-cmd --add-masquerade --permanent
sudo firewall-cmd --reload #这才把curl也打通了，我太难了
&lt;/code&gt;&lt;/pre&gt;
&lt;hr&gt;
&lt;p&gt;参考链接：&lt;br&gt;
&lt;a href=&#34;https://www.codenong.com/39293441/&#34;&gt;https://www.codenong.com/39293441/&lt;/a&gt;&lt;br&gt;
&lt;a href=&#34;https://www.cnblogs.com/Dev0ps/p/11401530.html&#34;&gt;https://www.cnblogs.com/Dev0ps/p/11401530.html&lt;/a&gt;&lt;/p&gt;
">k8s集群跨节点pods无法ping通以及无法curl</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://tomhht.github.io/post/sheng-lian-shan-sui-bi/"" data-c="
          &lt;p&gt;上周六去了趟圣莲山，陪人散心，尽管好像只是把他当作车夫。&lt;/p&gt;
&lt;!-- more --&gt;
&lt;p&gt;建议买观光车的票，否则从入口到正经爬山点有7里地，走个往返就该打道回府了。&lt;br /&gt;&lt;br&gt;
之前只是听人说过，这次别人想散心，于是推荐此地，想散心的当了全程司机。坐在车上往山里去是越来越凉快，途中也见到了十分陡峭的山，果然房山就是山多。&lt;br /&gt;&lt;br&gt;
散心人腿受伤了，因此到了景区后尽量搞不需要用腿的项目，比如观光车、缆车（内心OS：既然腿不好，来山上干啥）。&lt;br /&gt;&lt;br&gt;
其实本人是第一次坐缆车，稍微往下看看，确实有点腿软。同时想起意大利的一首民歌，就叫缆车，讲的是18几几年的事儿，有个老板搞山区旅游项目，于是搞了人力缆车，并且专门找作曲家写了个曲子，就是缆车，实际上原文的发音是fu ni ku li fu ni ku la，模拟缆车的声音，这个歌曲更准确说应该类似于咱们的劳动号子，大家边唱边使劲拉绳子。曲子非常欢快，进行曲的那种感觉，很多歌剧演员都唱过，比如著名的帕瓦罗蒂。但我第一次听是在芒果台的声入人心，一遍就喜欢上了。我妈觉得有些段落像是鬼子进村。&lt;br /&gt;&lt;br&gt;
缆车上山后，直奔观光车司机推荐的必去景点，一个叫圣莲宝塔，一个叫莲子峰。圣莲宝塔就是后人翻建的一个建筑，每层都绘制了佛教的故事。其实更喜欢纯的古建筑，或者以古修古的那种，可惜这个宝塔之前彻底倒塌了。塔旁边的山上还有题字，开始还以为是书法家才会题字，可这个字怎么看都觉得挺小学生的（没有侮辱小学生的意思），一直也联想不到是哪位大家的风格。正暗自感叹见识太少，忽听得旁人百度的结果，题字人正是宝塔翻建的出资人之一，心里的大石头终于落地，看来自己审美没出大问题。旁人也怀同样感觉，大家都释然了。当然出资人的功德肯定是大大的。&lt;br /&gt;&lt;br&gt;
实际上两个景点带来的感觉没有太震撼，但是游玩这种事情，过程才是核心。中间还路过一个景点叫八仙洞，就是在山上凿穿了个洞，看洞壁的坑坑洼洼，猜测应该是前人一凿一斧的心血，洞内凉气十足，且洞顶还有渗水滴下，我们感叹应该穿棉袄进来。后来散心人在洞外忽悠后来者，说洞里租军大衣。一个几岁的小男孩说什么也不进去，跟爸妈说里面可怕，我在想估计他们一家就要就此打住了，结果孩子爸妈想了个办法，把孩子抱上让孩子趴肩头挡住眼睛，直接就进去了。这都行，孩子就是孩子。&lt;br /&gt;&lt;br&gt;
之后我们找了个僻静处吃午饭，说实话背了一路，烧饼、香肠还有水，累死我了。我爸买的这香肠也有个性，外面塑料皮剥开，里面居然还有一层塑料膜，我还没叫出来，散心人已经一口啃下并吞下了一角塑料膜。这肠有个性，这人更有个性。&lt;/p&gt;
">圣莲山随笔</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://tomhht.github.io/post/k8s-cao-zuo-bi-ji/"" data-c="
          &lt;p&gt;实操遇到问题好多，记录下。&lt;/p&gt;
&lt;!-- more --&gt;
&lt;h1 id=&#34;image拉取失败replicas被弃用&#34;&gt;image拉取失败，replicas被弃用&lt;/h1&gt;
&lt;h2 id=&#34;问题&#34;&gt;问题&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;# 执行run，显示replicas has been deprecated，因此不生效，只部署了1个实例 
kubectl run httpd-app --image=httpd --replicas=2
# 检查pods运行情况，READY列显示未就绪
kubectl get pods -n wide
# 检查运行细节，一直显示pulling
kubectl describe pods httpd-app
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;解决&#34;&gt;解决&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;删除之前的部署：&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code&gt;kubectl delete pods httpd-app
&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;创建部署文件：&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code&gt;cd ~/k8s
nano nginx.yaml
&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;粘贴下面内容进nginx.yaml：&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code&gt;# API 版本号
apiVersion: apps/v1
# 类型，如：Pod/ReplicationController/Deployment/Service/Ingress
kind: Deployment
metadata:
  # Kind 的名称
  name: nginx-app
spec:
  selector:
    matchLabels:
      # 容器标签的名字，发布 Service 时，selector 需要和这里对应
      app: nginx
  # 部署的实例数量
  replicas: 2
  template:
    metadata:
      labels:
        app: nginx
    spec:
      # 配置容器，数组类型，说明可以配置多个容器
      containers:
      # 容器名称
      - name: nginx
        # 容器镜像
        image: nginx:1.17
        # 只有镜像不存在时，才会进行镜像拉取
        imagePullPolicy: IfNotPresent
        ports:
        # Pod 端口
        - containerPort: 80
&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&#34;4&#34;&gt;
&lt;li&gt;创建：&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code&gt;kubectl apply -f nginx.yaml
&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&#34;5&#34;&gt;
&lt;li&gt;检查：&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code&gt;kubectl get deployments
kubectl describe deployment nginx-app
kubectl get replicaset
kubectl describe rs nginx-app-5d85b5fb59
kubectl get pods -o wide
kubectl describe pods nginx-app-5d85b5fb59-2ct5p
&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&#34;6&#34;&gt;
&lt;li&gt;暴露服务：&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code&gt;kubectl expose deployment nginx-app --port=80 --type=LoadBalancer
&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&#34;7&#34;&gt;
&lt;li&gt;查看服务状态(查看对外的端口)&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code&gt;kubectl get services
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;nginx-app&lt;/code&gt;一直处于pending状态，应该是type设置为&lt;code&gt;LoadBalancer&lt;/code&gt;，但没有云服务商和本地服务提供该功能。&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;参考链接：&lt;br&gt;
&lt;a href=&#34;https://blog.csdn.net/qq_43279371/article/details/107768713&#34;&gt;https://blog.csdn.net/qq_43279371/article/details/107768713&lt;/a&gt;&lt;br&gt;
&lt;a href=&#34;https://blog.csdn.net/kenkao/article/details/86764788&#34;&gt;https://blog.csdn.net/kenkao/article/details/86764788&lt;/a&gt;&lt;/p&gt;
">k8s操作笔记</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://tomhht.github.io/post/pei-zhi-ubuntu-he-centos-qing-hua-yuan/"" data-c="
          &lt;p&gt;加快Ubuntu和CentOS软件下载速度。&lt;/p&gt;
&lt;!-- more --&gt;
&lt;h1 id=&#34;ubuntu&#34;&gt;Ubuntu&lt;/h1&gt;
&lt;p&gt;备份源配置文件：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;sudo cp /etc/apt/sources.list /etc/apt/sources.list.bak
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;使用vim或gedit编辑source.list，用下面内容替换原有内容：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# 默认注释了源码镜像以提高 apt update 速度，如有需要可自行取消注释
deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal main restricted universe multiverse
# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal main restricted universe multiverse
deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-updates main restricted universe multiverse
# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-updates main restricted universe multiverse
deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-backports main restricted universe multiverse
# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-backports main restricted universe multiverse
deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-security main restricted universe multiverse
# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-security main restricted universe multiverse

# 预发布软件源，不建议启用
# deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-proposed main restricted universe multiverse
# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-proposed main restricted universe multiverse
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;更新软件包缓存，使配置文件生效：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;sudo apt-get update
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;centos&#34;&gt;CentOS&lt;/h1&gt;
&lt;pre&gt;&lt;code&gt;path=&#39;/etc/yum.repos.d/&#39;
repos=(CentOS-AppStream.repo CentOS-Base.repo CentOS-centosplus.repo CentOS-Extras.repo CentOS-PowerTools.repo)
for repo in ${repos[@]}; do
sudo cp $path$repo $path$repo&#39;.bak&#39; #备份源配置文件
sudo sed -i &amp;quot;s/^mirrorlist/#&amp;amp;/; s/^#baseurl/baseurl/; s/http:\/\/mirror.centos.org\/\$contentdir/https:\/\/mirrors.tuna.tsinghua.edu.cn\/centos/&amp;quot; $path$repo #修改配置文件
done
# 更新软件包缓存，使配置文件生效
sudo yum makecache
&lt;/code&gt;&lt;/pre&gt;
&lt;hr&gt;
&lt;p&gt;参考链接：&lt;br&gt;
&lt;a href=&#34;https://mirrors.tuna.tsinghua.edu.cn/help/ubuntu/&#34;&gt;https://mirrors.tuna.tsinghua.edu.cn/help/ubuntu/&lt;/a&gt;&lt;br&gt;
&lt;a href=&#34;https://blog.csdn.net/xiangxianghehe/article/details/105688062&#34;&gt;https://blog.csdn.net/xiangxianghehe/article/details/105688062&lt;/a&gt;&lt;br&gt;
&lt;a href=&#34;https://mirror.tuna.tsinghua.edu.cn/help/centos/&#34;&gt;https://mirror.tuna.tsinghua.edu.cn/help/centos/&lt;/a&gt;&lt;/p&gt;
">配置Ubuntu和CentOS清华源</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://tomhht.github.io/post/zai-centos-he-ubuntu-shang-an-zhuang-he-pei-zhi-docker/"" data-c="
          &lt;p&gt;整理docker安装心得。&lt;/p&gt;
&lt;!-- more --&gt;
&lt;h1 id=&#34;centos&#34;&gt;CentOS&lt;/h1&gt;
&lt;pre&gt;&lt;code&gt;# 移除旧版
sudo yum remove docker \
                  docker-client \
                  docker-client-latest \
                  docker-common \
                  docker-latest \
                  docker-latest-logrotate \
                  docker-logrotate \
                  docker-engine
# 设置阿里云仓库repository
sudo yum install -y yum-utils
sudo yum-config-manager \
    --add-repo \
   http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
# 安装containerd.io
sudo yum install -y https://mirrors.aliyun.com/docker-ce/linux/centos/7/x86_64/stable/Packages/containerd.io-1.2.6-3.3.el7.x86_64.rpm
# 安装docker
sudo yum install docker-ce docker-ce-cli
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;ubuntu&#34;&gt;Ubuntu&lt;/h1&gt;
&lt;pre&gt;&lt;code&gt;# 移除旧版
sudo apt-get remove docker docker-engine docker.io containerd runc
# 安装依赖软件
sudo apt-get update
sudo apt-get install \
    apt-transport-https \
    ca-certificates \
    curl \
    gnupg-agent \
    software-properties-common
# 添加中科大DockerGPG KEY
curl -fsSL https://mirrors.ustc.edu.cn/docker-ce/linux/ubuntu/gpg | sudo apt-key add -
# 添加中科大仓库
sudo add-apt-repository &amp;quot;deb [arch=amd64] https://mirrors.ustc.edu.cn/docker-ce/linux/ubuntu \
$(lsb_release -cs) stable&amp;quot;
# 安装docker
sudo apt update
sudo apt install docker-ce docker-ce-cli containerd.io
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;以上操作完毕后，继续操作下面通用部分。&lt;/p&gt;
&lt;h1 id=&#34;通用&#34;&gt;通用&lt;/h1&gt;
&lt;pre&gt;&lt;code&gt;# 启动docker
sudo systemctl start docker
# 加入开机启动
sudo systemctl enable docker
# 允许当前用户使用docker
sudo usermod -aG docker ${USER}
su - $USER //立刻生效
# 配置国内加速器（可显著增加docker pull镜像的成功率和速度）
sudo tee /etc/docker/daemon.json &amp;lt;&amp;lt;-&#39;EOF&#39;
{
  &amp;quot;registry-mirrors&amp;quot;: [
    &amp;quot;https://97g5u05j.mirror.aliyuncs.com&amp;quot;,
    &amp;quot;https://dockerhub.azk8s.cn&amp;quot;,
    &amp;quot;https://hub-mirror.c.163.com&amp;quot;,
    &amp;quot;https://docker.mirrors.ustc.edu.cn&amp;quot;
  ],
  &amp;quot;exec-opts&amp;quot;: [&amp;quot;native.cgroupdriver=systemd&amp;quot;],
  &amp;quot;log-driver&amp;quot;: &amp;quot;json-file&amp;quot;,
  &amp;quot;log-opts&amp;quot;: {
    &amp;quot;max-size&amp;quot;: &amp;quot;100m&amp;quot;
  },
  &amp;quot;storage-driver&amp;quot;: &amp;quot;overlay2&amp;quot;
}
EOF
sudo systemctl daemon-reload
sudo systemctl restart docker
&lt;/code&gt;&lt;/pre&gt;
&lt;hr&gt;
&lt;p&gt;参考链接：&lt;br&gt;
&lt;a href=&#34;https://docs.docker.com/engine/install/&#34;&gt;https://docs.docker.com/engine/install/&lt;/a&gt;&lt;br&gt;
&lt;a href=&#34;https://developer.aliyun.com/article/763983&#34;&gt;https://developer.aliyun.com/article/763983&lt;/a&gt;&lt;br&gt;
&lt;a href=&#34;https://www.jianshu.com/p/5a911f20d93e&#34;&gt;https://www.jianshu.com/p/5a911f20d93e&lt;/a&gt;&lt;br&gt;
&lt;a href=&#34;https://blog.csdn.net/Alexhcf/article/details/106726860&#34;&gt;https://blog.csdn.net/Alexhcf/article/details/106726860&lt;/a&gt;&lt;br&gt;
&lt;a href=&#34;https://www.cnblogs.com/xuyaowen/p/usermod_session.html&#34;&gt;Linux 修改用户组后，如何关闭所有 X session 下使得组生效？&lt;/a&gt;&lt;/p&gt;
">在CentOS和Ubuntu上安装和配置docker</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://tomhht.github.io/post/ubuntu-he-centos-duan-kou-she-zhi/"" data-c="
          &lt;p&gt;记录下端口设置，用到啥记录啥。&lt;/p&gt;
&lt;!-- more --&gt;
&lt;h1 id=&#34;centos&#34;&gt;CentOS&lt;/h1&gt;
&lt;p&gt;核心指令&lt;code&gt;firewall-cmd&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&#34;查看已开放端口&#34;&gt;查看已开放端口&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;sudo firewall-cmd --list-ports
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;开启端口&#34;&gt;开启端口&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;sudo firewall-cmd --zone=public --add-port=10250/tcp --permanent
sudo firewall-cmd --zone=public --add-port=30000-32767/tcp --permanent
//--zone: 作用域 
//--add-port=2181/tcp: 要开启的端口号，格式为：端口号/通讯协议 
//--permanent: 使端口永久开放，如不添加，则表示临时有效，开机重启后便会失效
//30000-32767，端口区间
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;关闭端口&#34;&gt;关闭端口&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;sudo firewall-cmd --zone=public --remove-port=6443/tcp --permanent
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;reload以便-permanent配置生效&#34;&gt;reload以便--permanent配置生效&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;sudo firewall-cmd --reload
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;ubuntu&#34;&gt;Ubuntu&lt;/h1&gt;
&lt;p&gt;核心指令&lt;code&gt;ufw&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&#34;启用ufw&#34;&gt;启用ufw&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;sudo ufw enable
sudo ufw allow ssh
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;查看已开放端口-2&#34;&gt;查看已开放端口&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;sudo ufw status
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;开启端口-2&#34;&gt;开启端口&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;sudo ufw allow 10250/tcp
sudo ufw allow 30000:32767/tcp
//30000:32767是端口区间
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;关闭端口-2&#34;&gt;关闭端口&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;sudo ufw delete allow 10250/tcp
&lt;/code&gt;&lt;/pre&gt;
&lt;hr&gt;
&lt;p&gt;参考链接：&lt;br&gt;
&lt;a href=&#34;https://www.cnblogs.com/Sungeek/p/8257681.html&#34;&gt;https://www.cnblogs.com/Sungeek/p/8257681.html&lt;/a&gt;&lt;br&gt;
&lt;a href=&#34;https://blog.csdn.net/Sun_Hui_/article/details/103178840&#34;&gt;https://blog.csdn.net/Sun_Hui_/article/details/103178840&lt;/a&gt;&lt;br&gt;
&lt;a href=&#34;https://www.itcoder.tech/posts/how-to-setup-a-firewall-with-ufw-on-ubuntu-20-04/&#34;&gt;https://www.itcoder.tech/posts/how-to-setup-a-firewall-with-ufw-on-ubuntu-20-04/&lt;/a&gt;&lt;/p&gt;
">Ubuntu和CentOS端口设置</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://tomhht.github.io/post/ubuntu-he-centos-xiu-gai-grub/"" data-c="
          &lt;p&gt;grub的修改位置和生效方法。&lt;/p&gt;
&lt;!-- more --&gt;
&lt;h1 id=&#34;修改位置&#34;&gt;修改位置&lt;/h1&gt;
&lt;pre&gt;&lt;code&gt;sudo vim /etc/default/grub
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;生效方法&#34;&gt;生效方法&lt;/h1&gt;
&lt;pre&gt;&lt;code&gt;sudo grub2-mkconfig –o /etc/grub2.cfg  #CentOS
sudo update-grub2  #Ubuntu
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;troubleshooting&#34;&gt;Troubleshooting&lt;/h1&gt;
&lt;h2 id=&#34;描述&#34;&gt;描述&lt;/h2&gt;
&lt;p&gt;CentOS按上面操作修改&lt;code&gt;GRUB_TIMEOUT=0&lt;/code&gt;后，无论怎样都不生效，无法跳过boot menu倒计时5秒的魔咒。尝试过&lt;code&gt;GRUB_TIMEOUT_STYLE=&amp;quot;hidden&amp;quot; GRUB_HIDDEN_TIMEOUT_QUIET=true GRUB_ENABLE_BLSCFG=false&lt;/code&gt;等各种选项，均无效。&lt;code&gt;sudo ls -l /boot/grub2/&lt;/code&gt;查看&lt;code&gt;grub.cfg&lt;/code&gt;，修改时间纹丝未动，合着玩儿呢。&lt;br /&gt;&lt;/p&gt;
&lt;h2 id=&#34;解决&#34;&gt;解决&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;sudo vim /etc/grub2.cfg&lt;/code&gt;发现：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt; 63 if [ x$feature_timeout_style = xy ] ; then
 64   set timeout_style=menu
 65   set timeout=5
 66 # Fallback normal timeout code in case the timeout_style feature is
 67 # unavailable.
 68 else
 69   set timeout=5
 70 fi
 71 ### END /etc/grub.d/00_header ###
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;感觉问题出在&lt;code&gt;/etc/grub.d/00_header&lt;/code&gt;，研究header半天，没懂😅 &lt;br /&gt;&lt;br&gt;
而&lt;code&gt;/etc/grub2.cfg&lt;/code&gt;开篇就写着&lt;code&gt;# DO NOT EDIT THIS FILE&lt;/code&gt;，可实在没辙了，试着改了上面65行的timeout，直接改成0：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;65   set timeout=0
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;保存退出重启，成功了。这都是什么鬼。🙃&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;参考链接：&lt;br&gt;
&lt;a href=&#34;https://blog.csdn.net/whatday/article/details/106123164&#34;&gt;https://blog.csdn.net/whatday/article/details/106123164&lt;/a&gt;&lt;br&gt;
&lt;a href=&#34;https://www.techbrown.com/change-default-grub2-entries-timeout-centos-7/&#34;&gt;https://www.techbrown.com/change-default-grub2-entries-timeout-centos-7/&lt;/a&gt;&lt;/p&gt;
">Ubuntu和CentOS修改grub</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://tomhht.github.io/post/about/"" data-c="
          &lt;p&gt;第一次拥有自己的博客，感觉兴奋，折腾了半天，主要是为了自己能有一个记录和吐槽的地方。曾经也在其他网站做过blogger，结果要么关张要么消失要么墙墙，一言难尽。&lt;/p&gt;
">关于</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://tomhht.github.io/post/zai-ubuntu-2004-shang-shi-yong-kubeadm-bu-shu-kubernetes-ji-qun/"" data-c="
          &lt;p&gt;本文主要是踩坑后想记录下避坑方法，内容涉及Kubernetes, Kubeadm, Kubectl, Kubelet, Ubuntu, CentOS, Flannel, Docker, 阿里云。&lt;/p&gt;
&lt;!-- more --&gt;
&lt;h1 id=&#34;写作背景&#34;&gt;写作背景&lt;/h1&gt;
&lt;p&gt;初学Kubernetes，虽然网上资源很多，但没一个能彻底搞定，于是杂烩一下。&lt;/p&gt;
&lt;h1 id=&#34;安装前的准备工作&#34;&gt;安装前的准备工作&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;control node（控制节点）、worker node（工作节点） 都要做这些准备工作。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;检查各主机配置&#34;&gt;检查各主机配置&lt;/h2&gt;
&lt;h3 id=&#34;检查cpu和内存&#34;&gt;检查cpu和内存&lt;/h3&gt;
&lt;p&gt;无论是虚拟机还是物理机，都要求&lt;strong&gt;cpu内核≥2，内存≥2G&lt;/strong&gt;。&lt;/p&gt;
&lt;h3 id=&#34;检查主机名hostname&#34;&gt;检查主机名hostname&lt;/h3&gt;
&lt;p&gt;hostname要求&lt;strong&gt;不能是 localhost，且不包含下划线、小数点、大写字母&lt;/strong&gt;。&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# 检查hostname
hostname 
# 修改 hostname
hostnamectl set-hostname 名字
# 查看修改结果
hostnamectl status
# 设置 hostname 解析
echo &amp;quot;127.0.0.1   $(hostname)&amp;quot; &amp;gt;&amp;gt; /etc/hosts
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;设置固定ip&#34;&gt;设置固定IP&lt;/h3&gt;
&lt;p&gt;建议使用nmcli配置，因为跨平台（Ubuntu和CentOS）。&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;nmcli
//如果提示没有安装，先按下面步骤安装
# 安装nmcli
sudo yum install NetworkManager #CentOS
sudo apt-get install network-manager #Ubuntu
# 检查nmcli是否接管了网络管理
nmcli g
//正常是显示绿色的信息。如果STATE列显示disconnected，则Ubuntu要修改/etc/netplan/里的yaml文件，在version下面添加一行renderer: NetworkManager，保存退出后执行sudo systemctl daemon-reload 和 sudo systemctl restart NetworkManager
# 查看当前默认网卡和ip信息
ip route show
ip a
//ip route show 命令中，可以知道机器的网关DNS和默认网卡，如 default via 192.168.127.2 dev ens33，via后面的内容 192.168.127.2 就是网关和DNS，dev后面的内容 ens33 就是默认网卡
//ip a 命令中，可显示默认网卡的 IP 地址，Kubernetes 将使用此 IP 地址与集群内的其他节点通信，如192.168.127.131
//所有节点上 Kubernetes 所使用的 IP 地址必须可以互通（无需 NAT 映射、无安全组或防火墙隔离）
# 设置固定IP，网卡、ip地址、网关、DNS可参考上面的信息
sudo nmcli c mod ens33 \
ipv4.addresses 192.168.127.131/24 \
ipv4.method manual \
ipv4.gateway 192.168.127.2 \
ipv4.dns 192.168.127.2
# 让配置立刻生效
sudo nmcli c up ens33
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;设置iptables&#34;&gt;设置iptables&lt;/h2&gt;
&lt;p&gt;执行下面代码：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;sudo modprobe br_netfilter
cat &amp;lt;&amp;lt;EOF | sudo tee /etc/sysctl.d/k8s.conf
net.bridge.bridge-nf-call-ip6tables = 1
net.bridge.bridge-nf-call-iptables = 1
EOF
sudo sysctl --system
# 如果想检查配置，可执行
sysctl -n net.bridge.bridge-nf-call-iptables
sysctl -n net.bridge.bridge-nf-call-ip6tables
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;打开端口&#34;&gt;打开端口&lt;/h2&gt;
&lt;h3 id=&#34;ubuntu的准备工作&#34;&gt;Ubuntu的准备工作&lt;/h3&gt;
&lt;p&gt;先打开Ubuntu自带的防火墙ufw。执行下面代码：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;sudo ufw enable
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;执行后提示可能断开连接，直接y继续，别担心，ssh连接不会断。&lt;br&gt;
如果使用ssh连接，还需要执行下面代码，以便打开ssh连接：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;sudo ufw allow ssh
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;打开相应端口&#34;&gt;打开相应端口&lt;/h3&gt;
&lt;p&gt;依据所使用的系统（Ubuntu / CentOS），执行相应代码。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;控制节点 Control-plane nodes&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code&gt;# Ubuntu
sudo ufw allow 6443/tcp
sudo ufw allow 2379:2380/tcp
sudo ufw allow 10250:10252/tcp
sudo ufw allow 8472/udp #for flannel。如果不开，则coredns无法为worker nodes服务
//上面代码中的冒号代表端口区间。

# CentOS
sudo firewall-cmd --zone=public --add-port=6443/tcp --permanent
sudo firewall-cmd --zone=public --add-port=2379-2380/tcp --permanent
sudo firewall-cmd --zone=public --add-port=10250-10252/tcp --permanent
sudo firewall-cmd --zone=public --add-port=8472/udp --permanent #for flannel。如果不开，则coredns无法为worker nodes服务
sudo firewall-cmd --add-masquerade --permanent #for flannel NAT
sudo firewall-cmd --reload
sudo firewall-cmd --list-ports //查看设置效果
&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;工作节点 Worker nodes&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code&gt;# Ubuntu
sudo ufw allow 10250/tcp
sudo ufw allow 30000:32767/tcp
sudo ufw allow 8472/udp #for flannel

# CentOS
sudo firewall-cmd --zone=public --add-port=10250/tcp --permanent
sudo firewall-cmd --zone=public --add-port=30000-32767/tcp --permanent
sudo firewall-cmd --zone=public --add-port=8472/udp --permanent #for flannel
sudo firewall-cmd --add-masquerade --permanent #for flannel NAT
sudo firewall-cmd --reload
sudo firewall-cmd --list-ports //查看设置效果
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;禁用swap&#34;&gt;禁用swap&lt;/h2&gt;
&lt;p&gt;由于swap性能低下，Kubeadm默认要求禁止使用swap。执行如下代码：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;sudo swapoff -a  #临时禁用swap
sudo sed -i &#39;s/.*swap.*/#&amp;amp;/&#39; /etc/fstab  #永久禁用swap
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;可通过&lt;code&gt;free -m&lt;/code&gt;来检查禁用效果。&lt;/p&gt;
&lt;h2 id=&#34;安装docker&#34;&gt;安装docker&lt;/h2&gt;
&lt;p&gt;详见&lt;a href=&#34;/post/zai-centos-he-ubuntu-shang-an-zhuang-he-pei-zhi-docker&#34;&gt;docker安装和配置&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;创建k8s文件夹&#34;&gt;创建k8s文件夹&lt;/h2&gt;
&lt;p&gt;可用来存放相关文件。执行下面代码：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;mkdir ~/k8s
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;安装kubeadm-kubelet和kubectl&#34;&gt;安装kubeadm, kubelet和kubectl&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;control node（控制节点）、worker node（工作节点） 上都安装。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;Ubuntu&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;sudo apt-get update &amp;amp;&amp;amp; sudo apt-get install -y apt-transport-https curl
curl -s https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg | sudo apt-key add -
cat &amp;lt;&amp;lt;EOF | sudo tee /etc/apt/sources.list.d/kubernetes.list
deb https://mirrors.aliyun.com/kubernetes/apt kubernetes-xenial main
EOF
sudo apt-get update
sudo apt-get install -y kubelet kubeadm kubectl
sudo apt-mark hold kubelet kubeadm kubectl
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;CentOS&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;cat &amp;lt;&amp;lt;EOF | sudo tee /etc/yum.repos.d/kubernetes.repo
[kubernetes]
name=Kubernetes
baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/
enabled=1
gpgcheck=0
repo_gpgcheck=0
gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg
exclude=kubelet kubeadm kubectl
EOF

# Set SELinux in permissive mode (effectively disabling it)
sudo setenforce 0
sudo sed -i &#39;s/^SELINUX=enforcing$/SELINUX=permissive/&#39; /etc/selinux/config

sudo yum install -y kubelet kubeadm kubectl --disableexcludes=kubernetes

sudo systemctl enable --now kubelet
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;在control-node控制节点上用kubeadm创建集群&#34;&gt;在control node控制节点上用kubeadm创建集群&lt;/h1&gt;
&lt;h2 id=&#34;初始化集群&#34;&gt;初始化集群&lt;/h2&gt;
&lt;!-- - 方法一（推荐，能成功就很幸运）--&gt;
&lt;pre&gt;&lt;code&gt;sudo kubeadm init --apiserver-advertise-address=你的本机IP \
--pod-network-cidr=10.244.0.0/16 \
--kubernetes-version=v1.19.0 \
--image-repository=registry.cn-hangzhou.aliyuncs.com/google_containers
...
...
kubeadm join 192.168.127.132:6443 --token 4pwz11.1m0u1k3ak3ibgx08 \
    --discovery-token-ca-cert-hash sha256:671404c4f80afe5d06d8eefcd5acc6049c4d84f1ebf1091b09bc180ea44e79b7   
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;将输出内容中的&lt;code&gt;kubeadm join ...&lt;/code&gt;记录下来，这是其他节点加入主节点的信息。&lt;/p&gt;
&lt;!-- 如果安装失败，再试几次，还不行就尝试方法二。
如果安装成功，则输出类似下面内容，将内容中的`kubeadm join ...`单独保存出来，这是其他节点加入主节点的信息。跳过方法二。
如果安装顺利，&lt;a href=&#34;#%E8%B5%8B%E4%BA%88%E5%BD%93%E5%89%8D%E7%94%A8%E6%88%B7%E4%BD%BF%E7%94%A8kubectl%E7%9A%84%E6%9D%83%E9%99%90&#34;&gt;点这里跳过方法二&lt;/a&gt;。
## 初始化集群 - 方法二（只在方法一失败的情况下使用）
由于种种原因，国内无法从k8s.gcr.io下载到kubeadm部署所需的文件，以下方法将通过阿里云获取。
### 准备工作
#### 查看所需镜像
```
kubeadm config images list
#下面是执行的结果
k8s.gcr.io/kube-apiserver:v1.18.8
k8s.gcr.io/kube-controller-manager:v1.18.8
k8s.gcr.io/kube-scheduler:v1.18.8
k8s.gcr.io/kube-proxy:v1.18.8
k8s.gcr.io/pause:3.2
k8s.gcr.io/etcd:3.4.3-0
k8s.gcr.io/coredns:1.6.7
```
#### 在阿里云控制台找到所需镜像
1. [https://cr.console.aliyun.com/](https://cr.console.aliyun.com/)  左侧点”镜像搜索“
2. 分别搜索”kube-apiserver“等所有名称，点开搜索到的镜像，一定找到正确的版本号（如v1.18.8）（日期越新的越容易找到），复制页面中的”公网地址“
#### pull镜像、打标签、移除无用镜像
1. pull镜像
```
KUBE_VERSION=v1.18.8
PAUSE_VERSION=3.2
ETCD_VERSION=3.4.3-0
CORE_DNS_VERSION=1.6.7
docker pull registry.cn-hangzhou.aliyuncs.com/wyc_google_containers/kube-apiserver:$KUBE_VERSION
docker pull registry.cn-hangzhou.aliyuncs.com/wyc_google_containers/kube-controller-manager:$KUBE_VERSION
docker pull registry.cn-hangzhou.aliyuncs.com/wyc_google_containers/kube-scheduler:$KUBE_VERSION
docker pull registry.cn-hangzhou.aliyuncs.com/wyc_google_containers/kube-proxy:$KUBE_VERSION
docker pull registry.cn-hangzhou.aliyuncs.com/google_containers/pause:$PAUSE_VERSION
docker pull registry.cn-hangzhou.aliyuncs.com/google_containers/coredns:$CORE_DNS_VERSION
docker pull registry.cn-hangzhou.aliyuncs.com/google_containers/etcd:$ETCD_VERSION
```
2. 给pull下来的镜像打标签
因为kubeadm部署时会找k8s.gcr.io标签的镜像，因此需要将上一步pull的镜像打上k8s.gcr.io标签。
```
docker tag registry.cn-hangzhou.aliyuncs.com/wyc_google_containers/kube-apiserver:$KUBE_VERSION  k8s.gcr.io/kube-proxy:$KUBE_VERSION
docker tag registry.cn-hangzhou.aliyuncs.com/wyc_google_containers/kube-apiserver:$KUBE_VERSION k8s.gcr.io/kube-controller-manager:$KUBE_VERSION
docker tag registry.cn-hangzhou.aliyuncs.com/wyc_google_containers/kube-apiserver:$KUBE_VERSION k8s.gcr.io/kube-apiserver:$KUBE_VERSION
docker tag registry.cn-hangzhou.aliyuncs.com/wyc_google_containers/kube-apiserver:$KUBE_VERSION k8s.gcr.io/kube-scheduler:$KUBE_VERSION
docker tag registry.cn-hangzhou.aliyuncs.com/google_containers/pause:$PAUSE_VERSION k8s.gcr.io/pause:$PAUSE_VERSION
docker tag registry.cn-hangzhou.aliyuncs.com/google_containers/coredns:$CORE_DNS_VERSION k8s.gcr.io/coredns:$CORE_DNS_VERSION
docker tag registry.cn-hangzhou.aliyuncs.com/google_containers/etcd:$ETCD_VERSION k8s.gcr.io/etcd:$ETCD_VERSION
```
3. 移除从阿里云pull下来的镜像
```
docker rmi registry.cn-hangzhou.aliyuncs.com/wyc_google_containers/kube-apiserver:$KUBE_VERSION
docker rmi registry.cn-hangzhou.aliyuncs.com/wyc_google_containers/kube-controller-manager:$KUBE_VERSION
docker rmi registry.cn-hangzhou.aliyuncs.com/wyc_google_containers/kube-scheduler:$KUBE_VERSION
docker rmi registry.cn-hangzhou.aliyuncs.com/wyc_google_containers/kube-proxy:$KUBE_VERSION
docker rmi registry.cn-hangzhou.aliyuncs.com/google_containers/pause:$PAUSE_VERSION
docker rmi registry.cn-hangzhou.aliyuncs.com/google_containers/coredns:$CORE_DNS_VERSION
docker rmi registry.cn-hangzhou.aliyuncs.com/google_containers/etcd:$ETCD_VERSION
``` 
### 部署
```
sudo kubeadm init --apiserver-advertise-address=你的本机IP --pod-network-cidr=10.244.0.0/16  --kubernetes-version=v1.19.0
#执行后的输出
...
...
kubeadm join 192.168.127.132:6443 --token 4pwz11.1m0u1k3ak3ibgx08 \
    --discovery-token-ca-cert-hash sha256:671404c4f80afe5d06d8eefcd5acc6049c4d84f1ebf1091b09bc180ea44e79b7
```--&gt;
&lt;h2 id=&#34;赋予当前用户使用kubectl的权限&#34;&gt;赋予当前用户使用kubectl的权限&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;mkdir -p $HOME/.kube
sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
sudo chown $(id -u):$(id -g) $HOME/.kube/config
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;安装网络组件flannel&#34;&gt;安装网络组件flannel&lt;/h2&gt;
&lt;h3 id=&#34;准备工作&#34;&gt;准备工作&lt;/h3&gt;
&lt;p&gt;由于种种原因，无法直接pull到网络组件flannel的docker镜像，因此需单独下载。&lt;br&gt;
https://github.com/coreos/flannel/releases/download/v0.12.0/flanneld-v0.12.0-amd64.docker&lt;br&gt;
下载后放进&lt;code&gt;~/k8s&lt;/code&gt;，执行命令：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;cd ~/k8s
docker load &amp;lt; flanneld-v0.12.0-amd64.docker
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;开始安装&#34;&gt;开始安装&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;wget https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml
kubectl apply -f kube-flannel.yml
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;检查部署情况&#34;&gt;检查部署情况&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;kubectl get nodes
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://tomhht.github.io/post-images/1598781753839.png&#34; alt=&#34;节点运行情况&#34; loading=&#34;lazy&#34;&gt;     &lt;br /&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;kubectl get pods -A
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://tomhht.github.io/post-images/1598781791291.png&#34; alt=&#34;Pods运行情况&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
通过&lt;code&gt;docker container ls&lt;/code&gt;也可以看到pods里的容器运行情况。&lt;/p&gt;
&lt;h2 id=&#34;打开kubectl和kubeadm的自动补全功能&#34;&gt;打开kubectl和kubeadm的自动补全功能&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;echo &#39;source &amp;lt;(kubectl completion bash)&#39; &amp;gt;&amp;gt;~/.bashrc
echo &#39;source &amp;lt;(kubeadm completion bash)&#39; &amp;gt;&amp;gt;~/.bashrc
source ~/.bashrc #使配置立刻生效
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;以上为control node控制节点的部署全流程。&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;worker-node工作节点加入集群&#34;&gt;worker node工作节点加入集群&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;确认在worker node主机上已安装了kubeadm, kubelet和kubectl。&lt;br&gt;
如未安装，参考&lt;a href=&#34;#安装kubeadm-kubelet和kubectl&#34;&gt;安装kubeadm, kubelet和kubectl&lt;/a&gt;。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;安装网络组件flannel-2&#34;&gt;安装网络组件flannel&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;在&lt;strong&gt;control node&lt;/strong&gt;上导出flannel的docker镜像，并复制到worker node：&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;提醒：~/k8s目录在各node上都提前建好&lt;/p&gt;
&lt;/blockquote&gt;
&lt;pre&gt;&lt;code&gt;docker save quay.io/coreos/flannel:v0.12.0 &amp;gt; ~/k8s/flannel-v0.12.0.tar
scp ~k8s/flannel-v0.12.0.tar tom@192.168.127.133:~/k8s
&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;在&lt;strong&gt;worker node&lt;/strong&gt;上导入flannel的docker镜像：&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code&gt;docker load &amp;lt; k8s/flannel-v0.12.0.tar
&lt;/code&gt;&lt;/pre&gt;
&lt;!-- ## 载入control  node上pull好的镜像
1. 在control node上，备份出全套docker镜像（含kubeadm所需镜像+网络组件flannel镜像）：
```
cd ~/k8s
docker save k8s.gcr.io/kube-proxy:v1.18.8 \
k8s.gcr.io/kube-apiserver:v1.18.8 \
k8s.gcr.io/kube-controller-manager:v1.18.8 \
k8s.gcr.io/kube-scheduler:v1.18.8 \
k8s.gcr.io/pause:3.2 \
k8s.gcr.io/coredns:1.6.7 \
k8s.gcr.io/etcd:3.4.3-0 \
quay.io/coreos/flannel:v0.12.0-amd64 &gt; k8s-imagesV1.18.8-flannelV0.12.0.tar
```
&gt; 之前踩坑，偷懒用IMAGE ID做的备份，结果载入以后name和tag全都是none，还得打name和tag上去，无比繁琐- _ -||
2. scp上面的备份文件到各个worker node的`~/k8s`文件夹里
3. 在worker node上载入备份文件：
```
cd ~/k8s
docker load &lt; k8s-imagesV1.18.8-flannelV0.12.0.tar
```
&gt; worker node实际需要的只有3个镜像，分别是`kube-proxy, pause, flannel`--&gt;
&lt;h2 id=&#34;加入集群&#34;&gt;加入集群&lt;/h2&gt;
&lt;p&gt;在worker node上，执行之前记录的&lt;code&gt;kubeadm join...&lt;/code&gt;代码，类似于：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;sudo kubeadm join 192.168.127.132:6443 --token rddtz5.mz2v4ee96177eay5     --discovery-token-ca-cert-hash sha256:671404c4f80afe5d06d8eefcd5acc6049c4d84f1ebf1091b09bc180ea44e79b7
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;如果join指令没记录下来，或者集群创建已经超过24小时了，那么需要重新生成join指令。在&lt;strong&gt;control node&lt;/strong&gt;上执行：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;kubeadm token create --print-join-command
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;复制输出的内容并在&lt;strong&gt;worker node&lt;/strong&gt;上执行即可加入。&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;检查部署结果&#34;&gt;检查部署结果&lt;/h1&gt;
&lt;p&gt;在control node上执行：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;kubectl get nodes -o wide
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://tomhht.github.io/post-images/1599032788153.png&#34; alt=&#34;集群节点信息&#34; loading=&#34;lazy&#34;&gt; &lt;br /&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;kubectl get pods -A -o wide
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://tomhht.github.io/post-images/1599032818248.png&#34; alt=&#34;集群pods信息&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
如果STATUS不是Running，则排查故障点：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;kubectl describe pods -n kube-system kube-proxy-t2zbw
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;troubleshooting&#34;&gt;Troubleshooting&lt;/h1&gt;
&lt;h2 id=&#34;pull-image失败&#34;&gt;pull image失败&lt;/h2&gt;
&lt;p&gt;如果&lt;code&gt;kubectl get pods -n kube-system -o wide&lt;/code&gt;发现某个pods还没ready，而docker也已经配置了国内加速器，那么试着重启docker一下。&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;sudo systemctl restart docker.service
&lt;/code&gt;&lt;/pre&gt;
&lt;hr&gt;
&lt;p&gt;参考链接：&lt;br&gt;
&lt;a href=&#34;https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/&#34;&gt;https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/&lt;/a&gt;&lt;br&gt;
&lt;a href=&#34;https://www.cnblogs.com/hellxz/p/use-kubeadm-init-kubernetes-cluster.html&#34;&gt;https://www.cnblogs.com/hellxz/p/use-kubeadm-init-kubernetes-cluster.html&lt;/a&gt;&lt;br&gt;
&lt;a href=&#34;https://www.kuboard.cn/install/install-k8s.html&#34;&gt;https://www.kuboard.cn/install/install-k8s.html&lt;/a&gt;&lt;br&gt;
&lt;a href=&#34;https://blog.csdn.net/LeonardoYasuo/article/details/101483438&#34;&gt;https://blog.csdn.net/LeonardoYasuo/article/details/101483438&lt;/a&gt;&lt;br&gt;
&lt;a href=&#34;https://www.cnblogs.com/yinzhengjie/p/12258215.html&#34;&gt;https://www.cnblogs.com/yinzhengjie/p/12258215.html&lt;/a&gt;&lt;br&gt;
&lt;a href=&#34;https://developer.aliyun.com/article/763983&#34;&gt;https://developer.aliyun.com/article/763983&lt;/a&gt;&lt;/p&gt;
">在Ubuntu 20.04和CentOS 8上使用kubeadm部署Kubernetes集群</a>
      </div>
      
    </div>
  </div>
</div>
<script>
  // var escape = "[{&#34;content&#34;:&#34;&lt;p&gt;快速访问里有个Documents死活无法取消固定，点了又说不存在，让删又删不了，lese。&lt;/p&gt;\n&lt;!-- more --&gt;\n&lt;p&gt;感谢参考链接的作者，该方法效若桴鼓。&lt;/p&gt;\n&lt;blockquote&gt;\n&lt;p&gt;注意事项：该方法会删除快速访问里的所有内容，考虑清楚再动手。（我的本来就只有我的电脑和烦人的那项，所以果断kill）&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;ol&gt;\n&lt;li&gt;拷贝&lt;code&gt;%APPDATA%\\Microsoft\\Windows\\Recent\\AutomaticDestinations&lt;/code&gt;至 运行 或 文件夹地址栏，回车；&lt;/li&gt;\n&lt;li&gt;删除其中文件&lt;code&gt;f01b4d95cf55d32a.automaticDestinations-ms&lt;/code&gt;。&lt;/li&gt;\n&lt;/ol&gt;\n&lt;p&gt;DONE，整个世界都清净了。&lt;/p&gt;\n&lt;hr&gt;\n&lt;p&gt;参考链接：&lt;br&gt;\n&lt;a href=\&#34;https://blog.csdn.net/yin0hao/article/details/88052343\&#34;&gt;Windows 10 快速访问异常:无法取消固定,的解决方法&lt;/a&gt;&lt;/p&gt;\n&#34;,&#34;fileName&#34;:&#34;gan-diao-win10-wan-gu-bu-hua-de-mou-kuai-su-fang-wen-gu-ding-xiang&#34;,&#34;abstract&#34;:&#34;&lt;p&gt;快速访问里有个Documents死活无法取消固定，点了又说不存在，让删又删不了，lese。&lt;/p&gt;\n&#34;,&#34;title&#34;:&#34;干掉Win10顽固不化的某快速访问固定项&#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;快速访问&#34;,&#34;slug&#34;:&#34;cjFtpCiKT&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/cjFtpCiKT/&#34;},{&#34;name&#34;:&#34;固定项&#34;,&#34;slug&#34;:&#34;rgLn904nQg&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/rgLn904nQg/&#34;},{&#34;name&#34;:&#34;删除&#34;,&#34;slug&#34;:&#34;SCrO3KRB6z&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/SCrO3KRB6z/&#34;},{&#34;name&#34;:&#34;win10&#34;,&#34;slug&#34;:&#34;1i227Aq-k&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/1i227Aq-k/&#34;}],&#34;date&#34;:&#34;2020-09-15 08:59:03&#34;,&#34;dateFormat&#34;:&#34;2020-09-15&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://tomhht.github.io/post/gan-diao-win10-wan-gu-bu-hua-de-mou-kuai-su-fang-wen-gu-ding-xiang/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;1 min read&#34;,&#34;time&#34;:33000,&#34;words&#34;:155,&#34;minutes&#34;:1},&#34;description&#34;:&#34;快速访问里有个Documents死活无法取消固定，点了又说不存在，让删又删不了，lese。\n\n感谢参考链接的作者，该方法效若桴鼓。\n\n注意事项：该方法会删除快速访问里的所有内容，考虑清楚再动手。（我的本来就只有我的电脑和烦人的那项，所以果断...&#34;,&#34;toc&#34;:&#34;&#34;},{&#34;content&#34;:&#34;&lt;p&gt;众所周知的原因搞得安装起来太复杂了，并且helm的prometheus operator的chart项目还迁移过，更有点云里雾里。&lt;/p&gt;\n&lt;!-- more --&gt;\n&lt;h1 id=\&#34;创建专用namespace\&#34;&gt;创建专用namespace&lt;/h1&gt;\n&lt;p&gt;先创建个namespace来用。&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;kubectl create namespace monitoring\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h1 id=\&#34;单独安装crd\&#34;&gt;单独安装CRD&lt;/h1&gt;\n&lt;p&gt;CRD就是Custom Resource Definition。&lt;br&gt;\n本来应该是&lt;code&gt;helm install kube-prometheus-stack&lt;/code&gt;的时候就能装，but as you know..&lt;br&gt;\n通过科学上网，先下载yaml再说：&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;# 整齐点儿\nmkdir -p ~/helm/prometheus-operator\ncd ~/helm/prometheus-operator\n\n# 下载yaml\ncurl -x http://192.168.127.1:58591 -fsSLO https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/master/example/prometheus-operator-crd/monitoring.coreos.com_alertmanagers.yaml\ncurl -x http://192.168.127.1:58591 -fsSLO https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/master/example/prometheus-operator-crd/monitoring.coreos.com_podmonitors.yaml\ncurl -x http://192.168.127.1:58591 -fsSLO https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/master/example/prometheus-operator-crd/monitoring.coreos.com_probes.yaml\ncurl -x http://192.168.127.1:58591 -fsSLO https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/master/example/prometheus-operator-crd/monitoring.coreos.com_prometheuses.yaml\ncurl -x http://192.168.127.1:58591 -fsSLO https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/master/example/prometheus-operator-crd/monitoring.coreos.com_prometheusrules.yaml\ncurl -x http://192.168.127.1:58591 -fsSLO https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/master/example/prometheus-operator-crd/monitoring.coreos.com_servicemonitors.yaml\ncurl -x http://192.168.127.1:58591 -fsSLO https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/master/example/prometheus-operator-crd/monitoring.coreos.com_thanosrulers.yaml\n\n# 安装\nkubectl apply -f .\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h1 id=\&#34;安装-kube-prometheus-stack\&#34;&gt;安装 kube-prometheus-stack&lt;/h1&gt;\n&lt;p&gt;kube-prometheus-stack基于prometheus-operator制作，并集成了依赖&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;stable/kube-state-metrics&lt;/li&gt;\n&lt;li&gt;stable/prometheus-node-exporter&lt;/li&gt;\n&lt;li&gt;grafana/grafana&lt;/li&gt;\n&lt;/ul&gt;\n&lt;pre&gt;&lt;code&gt;# 安装\nhelm install kube-prometheus-stack prometheus-community/kube-prometheus-stack --set prometheusOperator.createCustomResource=false -n monitoring\n# 查看安装情况\nkubectl -n monitoring get deployments\nNAME                                       READY   UP-TO-DATE   AVAILABLE   AGE\nkube-prometheus-stack-grafana              1/1     1            1           4h30m\nkube-prometheus-stack-kube-state-metrics   1/1     1            1           4h30m\nkube-prometheus-stack-operator             1/1     1            1           4h30m\n\nkubectl -n monitoring get pods -owide\nNAME                                                        READY   STATUS    RESTARTS   AGE     IP                NODE           NOMINATED NODE   READINESS GATES\nalertmanager-kube-prometheus-stack-alertmanager-0           2/2     Running   2          4h14m   10.244.1.32       mini-ubuntu    &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;\nkube-prometheus-stack-grafana-8b85d667c-5w8sn               2/2     Running   4          4h32m   10.244.2.23       mini-centos    &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;\nkube-prometheus-stack-kube-state-metrics-5cf575d8f8-6m7jt   1/1     Running   1          4h32m   10.244.1.33       mini-ubuntu    &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;\nkube-prometheus-stack-operator-65fbd96bdb-9zhmz             2/2     Running   6          4h32m   10.244.2.21       mini-centos    &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;\nkube-prometheus-stack-prometheus-node-exporter-68sxv        1/1     Running   2          4h32m   192.168.127.133   mini-centos    &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;\nkube-prometheus-stack-prometheus-node-exporter-864w9        1/1     Running   1          4h32m   192.168.127.132   ubuntuserver   &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;\nkube-prometheus-stack-prometheus-node-exporter-nr274        1/1     Running   1          4h32m   192.168.127.134   mini-ubuntu    &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;\nprometheus-kube-prometheus-stack-prometheus-0               3/3     Running   6          4h14m   10.244.2.22       mini-centos    &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;blockquote&gt;\n&lt;p&gt;遇到问题往后看。&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h1 id=\&#34;安装过程的troubleshooting\&#34;&gt;安装过程的Troubleshooting&lt;/h1&gt;\n&lt;p&gt;安装过程各种报错，当然主要是镜像pull不下来，尤其是&lt;code&gt;quay.io&lt;/code&gt;的镜像。(我的挺奇怪，居然自己pull成功了几个&lt;code&gt;quay.io&lt;/code&gt;)&lt;/p&gt;\n&lt;h2 id=\&#34;排查问题\&#34;&gt;排查问题&lt;/h2&gt;\n&lt;pre&gt;&lt;code&gt;kubectl -n monitoring describe pods prometheus-kube-prometheus-stack-prometheus-0\n\nEvents:\n  Type     Reason   Age                    From                  Message\n  ----     ------   ----                   ----                  -------\n  Normal   Pulling  60m (x4 over 83m)      kubelet, mini-centos  Pulling image &amp;quot;quay.io/coreos/prometheus-config-reloader:v0.38.1&amp;quot;\n  Warning  Failed   58m (x4 over 79m)      kubelet, mini-centos  Failed to pull image &amp;quot;quay.io/coreos/prometheus-config-reloader:v0.38.1&amp;quot;: rpc error: code = Unknown desc = context canceled\n  Warning  Failed   58m (x4 over 79m)      kubelet, mini-centos  Error: ErrImagePull\n  Normal   Pulling  58m (x5 over 100m)     kubelet, mini-centos  Pulling image &amp;quot;quay.io/prometheus/prometheus:v2.18.2&amp;quot;\n  Normal   Pulled   47m                    kubelet, mini-centos  Successfully pulled image &amp;quot;quay.io/coreos/prometheus-config-reloader:v0.38.1&amp;quot; in 1m11.597994512s\n  Warning  Failed   22m (x11 over 83m)     kubelet, mini-centos  Error: ErrImagePull\n  Normal   BackOff  13m (x130 over 56m)    kubelet, mini-centos  Back-off pulling image &amp;quot;quay.io/prometheus/prometheus:v2.18.2&amp;quot;\n  Warning  Failed   8m15s (x145 over 56m)  kubelet, mini-centos  Error: ImagePullBackOff\n  Warning  Failed   3m13s (x14 over 83m)   kubelet, mini-centos  Failed to pull image &amp;quot;quay.io/prometheus/prometheus:v2.18.2&amp;quot;: rpc error: code = Unknown desc = context canceled\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;解决\&#34;&gt;解决&lt;/h2&gt;\n&lt;p&gt;&lt;code&gt;google prometheus v2.18.2&lt;/code&gt;居然发现&lt;code&gt;docker hub&lt;/code&gt;里有，于是在&lt;code&gt;mini-centos&lt;/code&gt;主机上：&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;docker pull prom/prometheus:v2.18.2\nv2.18.2: Pulling from prom/prometheus\n0f8c40e1270f: Already exists \n626a2a3fee8c: Already exists \ndde61fbb486b: Already exists \n22b936665674: Downloading [=================================================&amp;gt; ]  20.66MB/20.76MB\nb9cb37b79bc0: Download complete \na14008f52cd5: Download complete \nc89901a55493: Waiting \n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;就定这儿了，遂祭起重启docker大法：&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;sudo systemctl restart docker\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;重启完后，接着：&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;docker pull prom/prometheus:v2.18.2\nv2.18.2: Pulling from prom/prometheus\n0f8c40e1270f: Already exists \n626a2a3fee8c: Already exists \ndde61fbb486b: Already exists \n22b936665674: Pull complete \nb9cb37b79bc0: Pull complete \na14008f52cd5: Pull complete \nc89901a55493: Pull complete \n6caddd047c54: Pull complete \nddd1779460e5: Pull complete \nf65cc1a7f25d: Pull complete \n4be7bc9429a7: Pull complete \n2d296d78b122: Pull complete \nDigest: sha256:4d3303d1eb424e345cf48969bb7575d4d58472ad783ac41ea07fba92686f7ef5\nStatus: Downloaded newer image for prom/prometheus:v2.18.2\ndocker.io/prom/prometheus:v2.18.2\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;再检查：&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;kubectl -n monitoring get pods -owide\nNAME                                                        READY   STATUS    RESTARTS   AGE     IP                NODE           NOMINATED NODE   READINESS GATES\nalertmanager-kube-prometheus-stack-alertmanager-0           2/2     Running   2          4h14m   10.244.1.32       mini-ubuntu    &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;\nkube-prometheus-stack-grafana-8b85d667c-5w8sn               2/2     Running   4          4h32m   10.244.2.23       mini-centos    &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;\nkube-prometheus-stack-kube-state-metrics-5cf575d8f8-6m7jt   1/1     Running   1          4h32m   10.244.1.33       mini-ubuntu    &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;\nkube-prometheus-stack-operator-65fbd96bdb-9zhmz             2/2     Running   6          4h32m   10.244.2.21       mini-centos    &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;\nkube-prometheus-stack-prometheus-node-exporter-68sxv        1/1     Running   2          4h32m   192.168.127.133   mini-centos    &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;\nkube-prometheus-stack-prometheus-node-exporter-864w9        1/1     Running   1          4h32m   192.168.127.132   ubuntuserver   &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;\nkube-prometheus-stack-prometheus-node-exporter-nr274        1/1     Running   1          4h32m   192.168.127.134   mini-ubuntu    &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;\nprometheus-kube-prometheus-stack-prometheus-0               3/3     Running   6          4h14m   10.244.2.22       mini-centos    &amp;lt;none&amp;gt;           &amp;lt;none&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;全都ready了。&lt;br&gt;\n如有其他pull问题，应该可以如法炮制。&lt;/p&gt;\n&lt;h1 id=\&#34;暴露服务\&#34;&gt;暴露服务&lt;/h1&gt;\n&lt;h2 id=\&#34;查看服务\&#34;&gt;查看服务&lt;/h2&gt;\n&lt;pre&gt;&lt;code&gt;kubectl -n monitoring get svc\nNAME                                             TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)                      AGE\nalertmanager-operated                            ClusterIP   None             &amp;lt;none&amp;gt;        9093/TCP,9094/TCP,9094/UDP   4h16m\nkube-prometheus-stack-alertmanager               ClusterIP   10.101.245.140   &amp;lt;none&amp;gt;        9093/TCP                     4h34m\nkube-prometheus-stack-grafana                    ClusterIP   10.106.193.98    &amp;lt;none&amp;gt;        80/TCP                       4h34m\nkube-prometheus-stack-kube-state-metrics         ClusterIP   10.108.208.70    &amp;lt;none&amp;gt;        8080/TCP                     4h34m\nkube-prometheus-stack-operator                   ClusterIP   10.110.217.187   &amp;lt;none&amp;gt;        8080/TCP,443/TCP             4h34m\nkube-prometheus-stack-prometheus                 ClusterIP   10.104.189.224   &amp;lt;none&amp;gt;        9090/TCP                     4h34m\nkube-prometheus-stack-prometheus-node-exporter   ClusterIP   10.102.189.12    &amp;lt;none&amp;gt;        9100/TCP                     4h34m\nprometheus-operated                              ClusterIP   None             &amp;lt;none&amp;gt;        9090/TCP                     4h16m\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;改nodeport\&#34;&gt;改NodePort&lt;/h2&gt;\n&lt;p&gt;把下面服务的type改成NodePort：&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;kubectl -n monitoring edit svc kube-prometheus-stack-prometheus\nkubectl -n monitoring edit svc kube-prometheus-stack-alertmanager\nkubectl -n monitoring edit svc kube-prometheus-stack-grafana\n\nkubectl -n monitoring get svc\nNAME                                             TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)                      AGE\nalertmanager-operated                            ClusterIP   None             &amp;lt;none&amp;gt;        9093/TCP,9094/TCP,9094/UDP   4h51m\nkube-prometheus-stack-alertmanager               NodePort    10.101.245.140   &amp;lt;none&amp;gt;        9093:31386/TCP               5h9m\nkube-prometheus-stack-grafana                    NodePort    10.106.193.98    &amp;lt;none&amp;gt;        80:30835/TCP                 5h9m\nkube-prometheus-stack-kube-state-metrics         ClusterIP   10.108.208.70    &amp;lt;none&amp;gt;        8080/TCP                     5h9m\nkube-prometheus-stack-operator                   ClusterIP   10.110.217.187   &amp;lt;none&amp;gt;        8080/TCP,443/TCP             5h9m\nkube-prometheus-stack-prometheus                 NodePort    10.104.189.224   &amp;lt;none&amp;gt;        9090:30098/TCP               5h9m\nkube-prometheus-stack-prometheus-node-exporter   ClusterIP   10.102.189.12    &amp;lt;none&amp;gt;        9100/TCP                     5h9m\nprometheus-operated                              ClusterIP   None             &amp;lt;none&amp;gt;        9090/TCP                     4h51m\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h1 id=\&#34;访问prometheus\&#34;&gt;访问prometheus&lt;/h1&gt;\n&lt;p&gt;打开http://192.168.127.132:30098/targets，一部分up一部分down，点Unhealthy&lt;br&gt;\n&lt;img src=\&#34;https://tomhht.github.io/post-images/1600245194725.png\&#34; alt=\&#34;unhealthy\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/p&gt;\n&lt;h2 id=\&#34;解决down的部分\&#34;&gt;解决down的部分&lt;/h2&gt;\n&lt;h3 id=\&#34;etcd的down\&#34;&gt;etcd的down&lt;/h3&gt;\n&lt;blockquote&gt;\n&lt;p&gt;搞了1.5天，搜到的各种资料都无法适用，结合各家之言，再无数次尝试才勉强有结果。&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;pre&gt;&lt;code&gt;sudo vim /etc/kubernetes/manifests/etcd.yaml\n# 找到\n- --listen-client-urls=https://127.0.0.1:2379,https://192.168.127.132:2379\n# 修改为\n- --listen-client-urls=https://0.0.0.0:2379,http://0.0.0.0:2379\n# 重启全部container（实际上是停止命令，k8s会自动全部启动）\ndocker stop $(docker ps -q)\n&lt;/code&gt;&lt;/pre&gt;\n&lt;blockquote&gt;\n&lt;p&gt;挺奇葩的一点是，down变为up后，我又改回原配置，再重启全部container，依然保持up状态，存疑ing。&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h3 id=\&#34;kube-scheduler的down\&#34;&gt;kube-scheduler的down&lt;/h3&gt;\n&lt;pre&gt;&lt;code&gt;sudo vim /etc/kubernetes/manifests/kube-scheduler.yaml\n//改为- --bind-address=0.0.0.0\n//删行- --port=0\n//稍等几秒即可\n&lt;/code&gt;&lt;/pre&gt;\n&lt;blockquote&gt;\n&lt;p&gt;这个要特别感谢度娘帮我搜到的&lt;a href=\&#34;https://llovewxm1314.blog.csdn.net/article/details/108458197\&#34;&gt;解决kubernetes:v1.18.6-1.19.0 get cs127.0.0.1 connection refused错误&lt;/a&gt;。一个port你说你默认等于0干啥，你自己都unhealthy你说prometheus哪儿能监控得到。感谢原作者，n个小时后终于破案。&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h3 id=\&#34;kube-controller-manager的down\&#34;&gt;kube-controller-manager的down&lt;/h3&gt;\n&lt;p&gt;修改套路同kube-scheduler。&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;sudo vim /etc/kubernetes/manifests/kube-controller-manager.yaml\n//改为- --bind-address=0.0.0.0\n//删行- --port=0\n//稍等几秒即可\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;node-exporter的down\&#34;&gt;node-exporter的down&lt;/h3&gt;\n&lt;pre&gt;&lt;code&gt;kubectl -n monitoring edit ds kube-prometheus-stack-prometheus-node-exporter\n//删掉 hostNetwork: true 一行\n//稍等几秒即可\n//还没尝试helm给参数的方式，有机会试试override the hostNetwork setting using a values file with -f option\n&lt;/code&gt;&lt;/pre&gt;\n&lt;blockquote&gt;\n&lt;p&gt;特别感谢google来的&lt;a href=\&#34;https://vividcode.io/fix-context-deadline-exceeded-error-in-prometheus-operator/\&#34;&gt;Fix Context Deadline Exceeded Error in Prometheus Operator&lt;/a&gt;&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h3 id=\&#34;kube-proxy的down尚未搞定\&#34;&gt;kube-proxy的down（尚未搞定）&lt;/h3&gt;\n&lt;p&gt;暂时跳过，快崩溃了（人），下面的方法用了根本不行，google bing baidu齐上阵，前前后后得搞了1天。好心的哪位，请帮忙留言提供解决办法。&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;# 可能用得到的指令\nkubectl -n kube-system edit cm kube-proxy  //改metricsBindAddress: 为 0.0.0.0:10249\nkubectl delete pod -l k8s-app=kube-proxy -n kube-system\n// 按上面的操作，完全没效果，晕\nsudo netstat -ntlp | grep kube\nsudo ss -ntlp | grep kube\n&lt;/code&gt;&lt;/pre&gt;\n&lt;blockquote&gt;\n&lt;p&gt;这是第一个开始搞的，结果其他都搞定了，它还岿然不动。&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h1 id=\&#34;grafana篇章\&#34;&gt;Grafana篇章&lt;/h1&gt;\n&lt;p&gt;kube-prometheus-stack里已经自带Grafana，因此无需安装。&lt;/p&gt;\n&lt;h2 id=\&#34;访问grafana\&#34;&gt;访问grafana&lt;/h2&gt;\n&lt;pre&gt;&lt;code&gt;kubectl -n monitoring get svc //找到grafana的端口，然后浏览器访问http://IP:PORT\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;strong&gt;用户名/密码是？&lt;/strong&gt;&lt;br&gt;\n一堆说&lt;code&gt;admin/admin&lt;/code&gt;的，然而这个环境不适用。&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;用户名：admin\n密码：prom-operator\n&lt;/code&gt;&lt;/pre&gt;\n&lt;blockquote&gt;\n&lt;p&gt;特别感谢&lt;a href=\&#34;https://devstack.in/2020/05/25/deploy-prometheus-operator-with-helm3-and-private-registry/\&#34;&gt;Deploy Prometheus Operator with Helm3 and Private Registry&lt;/a&gt;&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;p&gt;&lt;strong&gt;漂亮&lt;/strong&gt;&lt;br&gt;\n&lt;img src=\&#34;https://tomhht.github.io/post-images/1600249518889.png\&#34; alt=\&#34;UI\&#34; loading=\&#34;lazy\&#34;&gt;&lt;br&gt;\n&lt;strong&gt;随便选一个&lt;/strong&gt;&lt;br&gt;\n&lt;img src=\&#34;https://tomhht.github.io/post-images/1600249787073.png\&#34; alt=\&#34;gorgeous\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/p&gt;\n&lt;hr&gt;\n&lt;p&gt;参考链接：&lt;br&gt;\n&lt;a href=\&#34;https://github.com/prometheus-community/helm-charts/tree/main/charts/kube-prometheus-stack\&#34;&gt;https://github.com/prometheus-community/helm-charts/tree/main/charts/kube-prometheus-stack&lt;/a&gt;&lt;br&gt;\n&lt;a href=\&#34;https://github.com/prometheus-operator/prometheus-operator\&#34;&gt;https://github.com/prometheus-operator/prometheus-operator&lt;/a&gt;&lt;br&gt;\n&lt;a href=\&#34;https://github.com/prometheus-operator/kube-prometheus\&#34;&gt;https://github.com/prometheus-operator/kube-prometheus&lt;/a&gt;&lt;br&gt;\n&lt;a href=\&#34;https://www.bookstack.cn/read/kubernetes-learning-0.2.0/docs-58.Prometheus%20Operator.md\&#34;&gt;https://www.bookstack.cn/read/kubernetes-learning-0.2.0/docs-58.Prometheus%20Operator.md&lt;/a&gt;&lt;br&gt;\n&lt;a href=\&#34;https://www.qikqiak.com/post/prometheus-operator-monitor-etcd/\&#34;&gt;https://www.qikqiak.com/post/prometheus-operator-monitor-etcd/&lt;/a&gt;&lt;br&gt;\n&lt;a href=\&#34;https://blog.fleeto.us/post/node-downtime/\&#34;&gt;https://blog.fleeto.us/post/node-downtime/&lt;/a&gt;&lt;br&gt;\n&lt;a href=\&#34;https://llovewxm1314.blog.csdn.net/article/details/108458197\&#34;&gt;解决kubernetes:v1.18.6-1.19.0 get cs127.0.0.1 connection refused错误&lt;/a&gt;&lt;br&gt;\n&lt;a href=\&#34;https://vividcode.io/fix-context-deadline-exceeded-error-in-prometheus-operator/\&#34;&gt;Fix Context Deadline Exceeded Error in Prometheus Operator&lt;/a&gt;&lt;br&gt;\n&lt;a href=\&#34;https://devstack.in/2020/05/25/deploy-prometheus-operator-with-helm3-and-private-registry/\&#34;&gt;Deploy Prometheus Operator with Helm3 and Private Registry&lt;/a&gt;&lt;br&gt;\n稍后阅读：&lt;br&gt;\n&lt;a href=\&#34;https://www.qikqiak.com/post/k8s-hpa-usage/\&#34;&gt;Kubernetes HPA 使用详解&lt;/a&gt;&lt;br&gt;\n&lt;a href=\&#34;https://blog.51cto.com/14143894/2438026\&#34;&gt;Kubernetes运维之使用Prometheus全方位监控K8S&lt;/a&gt;&lt;/p&gt;\n&#34;,&#34;fileName&#34;:&#34;an-zhuang-prometheus-operator&#34;,&#34;abstract&#34;:&#34;&lt;p&gt;众所周知的原因搞得安装起来太复杂了，并且helm的prometheus operator的chart项目还迁移过，更有点云里雾里。&lt;/p&gt;\n&#34;,&#34;title&#34;:&#34;helm安装kube-prometheus-stack&#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;helm&#34;,&#34;slug&#34;:&#34;wZ5maZQyf&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/wZ5maZQyf/&#34;},{&#34;name&#34;:&#34;prometheus&#34;,&#34;slug&#34;:&#34;PM-ekRSbhz&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/PM-ekRSbhz/&#34;},{&#34;name&#34;:&#34;prometheus operator&#34;,&#34;slug&#34;:&#34;9k4vb02qe6&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/9k4vb02qe6/&#34;},{&#34;name&#34;:&#34;kubernetes&#34;,&#34;slug&#34;:&#34;9iWQqlqnT&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/9iWQqlqnT/&#34;},{&#34;name&#34;:&#34;k8s&#34;,&#34;slug&#34;:&#34;waCBSEanF&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/waCBSEanF/&#34;}],&#34;date&#34;:&#34;2020-09-13 17:45:34&#34;,&#34;dateFormat&#34;:&#34;2020-09-13&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://tomhht.github.io/post/an-zhuang-prometheus-operator/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;13 min read&#34;,&#34;time&#34;:740000,&#34;words&#34;:2266,&#34;minutes&#34;:13},&#34;description&#34;:&#34;众所周知的原因搞得安装起来太复杂了，并且helm的prometheus operator的chart项目还迁移过，更有点云里雾里。\n\n创建专用namespace\n先创建个namespace来用。\nkubectl create namespa...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%88%9B%E5%BB%BA%E4%B8%93%E7%94%A8namespace\&#34;&gt;创建专用namespace&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%8D%95%E7%8B%AC%E5%AE%89%E8%A3%85crd\&#34;&gt;单独安装CRD&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%AE%89%E8%A3%85-kube-prometheus-stack\&#34;&gt;安装 kube-prometheus-stack&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%AE%89%E8%A3%85%E8%BF%87%E7%A8%8B%E7%9A%84troubleshooting\&#34;&gt;安装过程的Troubleshooting&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%8E%92%E6%9F%A5%E9%97%AE%E9%A2%98\&#34;&gt;排查问题&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E8%A7%A3%E5%86%B3\&#34;&gt;解决&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%9A%B4%E9%9C%B2%E6%9C%8D%E5%8A%A1\&#34;&gt;暴露服务&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%9F%A5%E7%9C%8B%E6%9C%8D%E5%8A%A1\&#34;&gt;查看服务&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%94%B9nodeport\&#34;&gt;改NodePort&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E8%AE%BF%E9%97%AEprometheus\&#34;&gt;访问prometheus&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E8%A7%A3%E5%86%B3down%E7%9A%84%E9%83%A8%E5%88%86\&#34;&gt;解决down的部分&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#etcd%E7%9A%84down\&#34;&gt;etcd的down&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#kube-scheduler%E7%9A%84down\&#34;&gt;kube-scheduler的down&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#kube-controller-manager%E7%9A%84down\&#34;&gt;kube-controller-manager的down&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#node-exporter%E7%9A%84down\&#34;&gt;node-exporter的down&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#kube-proxy%E7%9A%84down%E5%B0%9A%E6%9C%AA%E6%90%9E%E5%AE%9A\&#34;&gt;kube-proxy的down（尚未搞定）&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#grafana%E7%AF%87%E7%AB%A0\&#34;&gt;Grafana篇章&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E8%AE%BF%E9%97%AEgrafana\&#34;&gt;访问grafana&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;p&gt;最小化安装centos 8后的设置。&lt;/p&gt;\n&lt;!-- more --&gt;\n&lt;h1 id=\&#34;更换国内源\&#34;&gt;更换国内源&lt;/h1&gt;\n&lt;p&gt;参考&lt;a href=\&#34;/post/pei-zhi-ubuntu-he-centos-qing-hua-yuan\&#34;&gt;配置清华源&lt;/a&gt;&lt;/p&gt;\n&lt;h1 id=\&#34;安装epel\&#34;&gt;安装epel&lt;/h1&gt;\n&lt;pre&gt;&lt;code&gt;sudo yum install epel-release\n# 更换清华源\nsudo sed -e &#39;s!^metalink=!#metalink=!g&#39; \\\n    -e &#39;s!^#baseurl=!baseurl=!g&#39; \\\n    -e &#39;s!//download\\.fedoraproject\\.org/pub!//mirrors.tuna.tsinghua.edu.cn!g&#39; \\\n    -e &#39;s!http://mirrors\\.tuna!https://mirrors.tuna!g&#39; \\\n    -i /etc/yum.repos.d/epel.repo /etc/yum.repos.d/epel-testing.repo\nsudo yum makecache\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h1 id=\&#34;更新软件\&#34;&gt;更新软件&lt;/h1&gt;\n&lt;pre&gt;&lt;code&gt;yum check-update\nsudo yum upgrade\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h1 id=\&#34;设置时区和ntp\&#34;&gt;设置时区和NTP&lt;/h1&gt;\n&lt;pre&gt;&lt;code&gt;timedatectl set-timezone Asia/Shanghai\nsudo yum install chrony\nsudo systemctl enable --now chronyd\ntimedatectl status\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h1 id=\&#34;自动补全\&#34;&gt;自动补全&lt;/h1&gt;\n&lt;pre&gt;&lt;code&gt;sudo yum install bash-completion\nsource ~/.bashrc\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h1 id=\&#34;安装wget\&#34;&gt;安装wget&lt;/h1&gt;\n&lt;pre&gt;&lt;code&gt;sudo yum -y install wget\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h1 id=\&#34;其他有用的记录\&#34;&gt;其他有用的记录&lt;/h1&gt;\n&lt;pre&gt;&lt;code&gt;# 找程序所属的包\nyum whatprovides netstat\n&lt;/code&gt;&lt;/pre&gt;\n&lt;hr&gt;\n&lt;p&gt;参考链接：&lt;br&gt;\n&lt;a href=\&#34;https://www.cnblogs.com/fengdejiyixx/p/11592417.html\&#34;&gt;Centos和Ubuntu系统最小化安装基础命令&lt;/a&gt;&lt;br&gt;\n&lt;a href=\&#34;https://linuxconfig.org/ubuntu-20-04-server-installation\&#34;&gt;Ubuntu 20.04 Server Installation&lt;/a&gt;&lt;/p&gt;\n&#34;,&#34;fileName&#34;:&#34;zui-xiao-hua-an-zhuang-centos-hou-de-she-zhi&#34;,&#34;abstract&#34;:&#34;&lt;p&gt;最小化安装centos 8后的设置。&lt;/p&gt;\n&#34;,&#34;title&#34;:&#34;最小化安装centos和ubuntu之后的配置&#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;ubuntu&#34;,&#34;slug&#34;:&#34;kQqN5ubkh&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/kQqN5ubkh/&#34;},{&#34;name&#34;:&#34;yum&#34;,&#34;slug&#34;:&#34;61caeLjRp&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/61caeLjRp/&#34;},{&#34;name&#34;:&#34;dnf&#34;,&#34;slug&#34;:&#34;k6OySQa9SB&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/k6OySQa9SB/&#34;},{&#34;name&#34;:&#34;国内源&#34;,&#34;slug&#34;:&#34;AVam_YHxdq&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/AVam_YHxdq/&#34;},{&#34;name&#34;:&#34;配置&#34;,&#34;slug&#34;:&#34;Bwz1BaTtzi&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/Bwz1BaTtzi/&#34;},{&#34;name&#34;:&#34;CentOS&#34;,&#34;slug&#34;:&#34;qjvKbAF653&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/qjvKbAF653/&#34;}],&#34;date&#34;:&#34;2020-09-10 18:54:55&#34;,&#34;dateFormat&#34;:&#34;2020-09-10&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://tomhht.github.io/post/zui-xiao-hua-an-zhuang-centos-hou-de-she-zhi/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;1 min read&#34;,&#34;time&#34;:53000,&#34;words&#34;:176,&#34;minutes&#34;:1},&#34;description&#34;:&#34;最小化安装centos 8后的设置。\n\n更换国内源\n参考配置清华源\n安装epel\nsudo yum install epel-release\n# 更换清华源\nsudo sed -e &#39;s!^metalink=!#metalink=!g&#39; \\...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%9B%B4%E6%8D%A2%E5%9B%BD%E5%86%85%E6%BA%90\&#34;&gt;更换国内源&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%AE%89%E8%A3%85epel\&#34;&gt;安装epel&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%9B%B4%E6%96%B0%E8%BD%AF%E4%BB%B6\&#34;&gt;更新软件&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E8%AE%BE%E7%BD%AE%E6%97%B6%E5%8C%BA%E5%92%8Cntp\&#34;&gt;设置时区和NTP&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E8%87%AA%E5%8A%A8%E8%A1%A5%E5%85%A8\&#34;&gt;自动补全&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%AE%89%E8%A3%85wget\&#34;&gt;安装wget&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%85%B6%E4%BB%96%E6%9C%89%E7%94%A8%E7%9A%84%E8%AE%B0%E5%BD%95\&#34;&gt;其他有用的记录&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;p&gt;发现libvirt/images下有个qcow2文件挺大，于是想用virsh安全删掉。&lt;/p&gt;\n&lt;!-- more --&gt;\n&lt;h1 id=\&#34;列出虚拟机\&#34;&gt;列出虚拟机&lt;/h1&gt;\n&lt;p&gt;开始没用sudo，结果啥都没有，明明记得之前搞过俩呢。&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;sudo virsh list --all\n Id    Name                           State\n----------------------------------------------------\n -     vm1                            shut off\n -     vm2                            shut off\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h1 id=\&#34;检查虚拟机配置\&#34;&gt;检查虚拟机配置&lt;/h1&gt;\n&lt;pre&gt;&lt;code&gt;sudo virsh dumpxml vm1 | grep &#39;source file&#39;\n    &amp;lt;source file=&#39;/var/lib/libvirt/images/cirros-0.5.1-x86_64-disk.img&#39;/&amp;gt;\n    &amp;lt;source file=&#39;/var/lib/libvirt/images/vm1.qcow2&#39;/&amp;gt; #要删这个\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h1 id=\&#34;编辑配置\&#34;&gt;编辑配置&lt;/h1&gt;\n&lt;p&gt;确保该虚拟机未运行。删除配置中挂载&lt;code&gt;vm1.qcow2&lt;/code&gt;的段落。&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;sudo virsh edit vm1\n# 删除这段\n    &amp;lt;disk type=&#39;file&#39; device=&#39;disk&#39;&amp;gt;\n      &amp;lt;driver name=&#39;qemu&#39; type=&#39;qcow2&#39;/&amp;gt;\n      &amp;lt;source file=&#39;/var/lib/libvirt/images/vm1.qcow2&#39;/&amp;gt;\n      &amp;lt;target dev=&#39;hda&#39; bus=&#39;ide&#39;/&amp;gt;\n      &amp;lt;address type=&#39;drive&#39; controller=&#39;0&#39; bus=&#39;0&#39; target=&#39;0&#39; unit=&#39;1&#39;/&amp;gt;\n    &amp;lt;/disk&amp;gt; \n&lt;/code&gt;&lt;/pre&gt;\n&lt;h1 id=\&#34;删除文件\&#34;&gt;删除文件&lt;/h1&gt;\n&lt;pre&gt;&lt;code&gt;sudo rm /var/lib/libvirt/images/vm1.qcow2\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;搞定。&lt;/p&gt;\n&lt;hr&gt;\n&lt;p&gt;参考链接：&lt;br&gt;\n&lt;a href=\&#34;https://huataihuang.gitbooks.io/cloud-atlas/content/virtual/kvm/startup/in_action/delete_a_running_vm_on_kvm.html\&#34;&gt;使用virsh删除运行的KVM VM · Cloud Atlas&lt;/a&gt;&lt;br&gt;\n&lt;a href=\&#34;https://www.jianshu.com/p/5111134452a8\&#34;&gt;KVM磁盘扩容和添加&lt;/a&gt;&lt;/p&gt;\n&#34;,&#34;fileName&#34;:&#34;shi-yong-virsh-shan-chu-kvm-xu-ni-ji&#34;,&#34;abstract&#34;:&#34;&lt;p&gt;发现libvirt/images下有个qcow2文件挺大，于是想用virsh安全删掉。&lt;/p&gt;\n&#34;,&#34;title&#34;:&#34;使用virsh删除kvm虚拟机&#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;virsh&#34;,&#34;slug&#34;:&#34;bUCnN5mej&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/bUCnN5mej/&#34;},{&#34;name&#34;:&#34;libvirt&#34;,&#34;slug&#34;:&#34;9_9Hadrd_e&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/9_9Hadrd_e/&#34;},{&#34;name&#34;:&#34;image&#34;,&#34;slug&#34;:&#34;j67cApQSbW&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/j67cApQSbW/&#34;},{&#34;name&#34;:&#34;kvm&#34;,&#34;slug&#34;:&#34;LEZftXqp1g&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/LEZftXqp1g/&#34;},{&#34;name&#34;:&#34;vm&#34;,&#34;slug&#34;:&#34;xUsIJSwbqY&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/xUsIJSwbqY/&#34;},{&#34;name&#34;:&#34;删除&#34;,&#34;slug&#34;:&#34;SCrO3KRB6z&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/SCrO3KRB6z/&#34;},{&#34;name&#34;:&#34;delete&#34;,&#34;slug&#34;:&#34;RGCjJupI7z&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/RGCjJupI7z/&#34;},{&#34;name&#34;:&#34;remove&#34;,&#34;slug&#34;:&#34;NOWugYtRFw&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/NOWugYtRFw/&#34;},{&#34;name&#34;:&#34;虚拟机&#34;,&#34;slug&#34;:&#34;tvA3wOlzOa&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/tvA3wOlzOa/&#34;},{&#34;name&#34;:&#34;硬盘&#34;,&#34;slug&#34;:&#34;ruGPvEEk15&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/ruGPvEEk15/&#34;}],&#34;date&#34;:&#34;2020-09-10 14:21:16&#34;,&#34;dateFormat&#34;:&#34;2020-09-10&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://tomhht.github.io/post/shi-yong-virsh-shan-chu-kvm-xu-ni-ji/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;2 min read&#34;,&#34;time&#34;:63000,&#34;words&#34;:219,&#34;minutes&#34;:2},&#34;description&#34;:&#34;发现libvirt/images下有个qcow2文件挺大，于是想用virsh安全删掉。\n\n列出虚拟机\n开始没用sudo，结果啥都没有，明明记得之前搞过俩呢。\nsudo virsh list --all\n Id    Name        ...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%88%97%E5%87%BA%E8%99%9A%E6%8B%9F%E6%9C%BA\&#34;&gt;列出虚拟机&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%A3%80%E6%9F%A5%E8%99%9A%E6%8B%9F%E6%9C%BA%E9%85%8D%E7%BD%AE\&#34;&gt;检查虚拟机配置&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E7%BC%96%E8%BE%91%E9%85%8D%E7%BD%AE\&#34;&gt;编辑配置&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%88%A0%E9%99%A4%E6%96%87%E4%BB%B6\&#34;&gt;删除文件&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;p&gt;命令挺简单，就是速度很感人。&lt;/p&gt;\n&lt;!-- more --&gt;\n&lt;h1 id=\&#34;安装\&#34;&gt;安装&lt;/h1&gt;\n&lt;pre&gt;&lt;code&gt;sudo snap install helm --classic\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;安装过慢的解决办法还没尝试，参考链接先记录下来了，先谢谢原作者。&lt;/p&gt;\n&lt;blockquote&gt;\n&lt;p&gt;据官方说明，Helm 3已经不需要Tiller了，所以其他参考资料上安装Tiller的步骤直接跳过。&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h1 id=\&#34;配置\&#34;&gt;配置&lt;/h1&gt;\n&lt;h2 id=\&#34;自动补全\&#34;&gt;自动补全&lt;/h2&gt;\n&lt;pre&gt;&lt;code&gt;echo &#39;source &amp;lt;(helm completion bash)&#39; &amp;gt;&amp;gt;~/.bashrc\nsource ~/.bashrc #使配置立刻生效\n&lt;/code&gt;&lt;/pre&gt;\n&lt;hr&gt;\n&lt;p&gt;参考链接：&lt;br&gt;\n&lt;a href=\&#34;https://helm.sh/\&#34;&gt;Helm官方&lt;/a&gt;&lt;br&gt;\n&lt;a href=\&#34;https://kuricat.com/gist/snap-install-too-slow-zmbjy\&#34;&gt;snap install 过慢 的解决方法 @Kurisu&lt;/a&gt;&lt;/p&gt;\n&#34;,&#34;fileName&#34;:&#34;zai-ubuntu-shang-yong-snap-an-zhuang-helm&#34;,&#34;abstract&#34;:&#34;&lt;p&gt;命令挺简单，就是速度很感人。&lt;/p&gt;\n&#34;,&#34;title&#34;:&#34;在Ubuntu上用snap安装Helm&#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;snap&#34;,&#34;slug&#34;:&#34;NDIcn-UIx&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/NDIcn-UIx/&#34;},{&#34;name&#34;:&#34;Helm&#34;,&#34;slug&#34;:&#34;lWU6BYd7-O&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/lWU6BYd7-O/&#34;},{&#34;name&#34;:&#34;Tiller&#34;,&#34;slug&#34;:&#34;qSw6tN1oLG&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/qSw6tN1oLG/&#34;},{&#34;name&#34;:&#34;安装&#34;,&#34;slug&#34;:&#34;Q8BfV1d_Wf&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/Q8BfV1d_Wf/&#34;},{&#34;name&#34;:&#34;配置&#34;,&#34;slug&#34;:&#34;Bwz1BaTtzi&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/Bwz1BaTtzi/&#34;},{&#34;name&#34;:&#34;Ubuntu&#34;,&#34;slug&#34;:&#34;pelgqi16au&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/pelgqi16au/&#34;}],&#34;date&#34;:&#34;2020-09-07 16:45:29&#34;,&#34;dateFormat&#34;:&#34;2020-09-07&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://tomhht.github.io/post/zai-ubuntu-shang-yong-snap-an-zhuang-helm/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;1 min read&#34;,&#34;time&#34;:28000,&#34;words&#34;:121,&#34;minutes&#34;:1},&#34;description&#34;:&#34;命令挺简单，就是速度很感人。\n\n安装\nsudo snap install helm --classic\n\n安装过慢的解决办法还没尝试，参考链接先记录下来了，先谢谢原作者。\n\n据官方说明，Helm 3已经不需要Tiller了，所以其他参考资料...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%AE%89%E8%A3%85\&#34;&gt;安装&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E9%85%8D%E7%BD%AE\&#34;&gt;配置&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E8%87%AA%E5%8A%A8%E8%A1%A5%E5%85%A8\&#34;&gt;自动补全&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;p&gt;学习nfs的配置，并测试k8s部署mysql挂载nfs的方式。&lt;/p&gt;\n&lt;!-- more --&gt;\n&lt;h1 id=\&#34;配置nfs\&#34;&gt;配置nfs&lt;/h1&gt;\n&lt;h2 id=\&#34;ubuntu\&#34;&gt;Ubuntu&lt;/h2&gt;\n&lt;p&gt;先将参考链接放这儿。&lt;a href=\&#34;https://www.digitalocean.com/community/tutorials/how-to-set-up-an-nfs-mount-on-ubuntu-20-04\&#34;&gt;How To Set Up an NFS Mount on Ubuntu 20.04&lt;/a&gt;&lt;/p&gt;\n&lt;h2 id=\&#34;centos\&#34;&gt;CentOS&lt;/h2&gt;\n&lt;p&gt;&lt;a href=\&#34;https://qizhanming.com/blog/2018/08/08/how-to-install-nfs-on-centos-7\&#34;&gt;CentOS 7 下 yum 安装和配置 NFS&lt;/a&gt;&lt;/p&gt;\n&lt;h1 id=\&#34;k8s测试遇到的问题\&#34;&gt;k8s测试遇到的问题&lt;/h1&gt;\n&lt;h2 id=\&#34;镜像pull不下来\&#34;&gt;镜像pull不下来&lt;/h2&gt;\n&lt;p&gt;&lt;strong&gt;问题描述&lt;/strong&gt;&lt;br&gt;\n测试mysql挂载nfs失败了n次，一开始是镜像pull不下来。&lt;br&gt;\n&lt;strong&gt;解决&lt;/strong&gt;&lt;br&gt;\n后来添加阿里云加速器后重启node上的docker &lt;code&gt;sudo systemctl restart docker.service&lt;/code&gt;解决了pull的问题。&lt;/p&gt;\n&lt;h2 id=\&#34;pod遇到backoff的错误\&#34;&gt;pod遇到backoff的错误&lt;/h2&gt;\n&lt;p&gt;&lt;strong&gt;问题描述&lt;/strong&gt;&lt;br&gt;\npull下来了还是运行失败，pod总是显示backoff &lt;code&gt;Back-off restarting failed container&lt;/code&gt;的错误，通过&lt;code&gt;kubectl logs &amp;lt;mysql pod的名字&amp;gt;&lt;/code&gt;发现&lt;code&gt;chown: changing ownership of &#39;/var/lib/mysql/&#39;: Operation not permitted&lt;/code&gt;错误。&lt;br&gt;\n&lt;strong&gt;解决&lt;/strong&gt;&lt;br&gt;\nnfs配置文件&lt;code&gt;/etc/exports&lt;/code&gt;里，加上了&lt;code&gt;no_root_squash&lt;/code&gt;的选项。&lt;/p&gt;\n&lt;hr&gt;\n&lt;p&gt;参考链接：&lt;br&gt;\n&lt;a href=\&#34;https://www.digitalocean.com/community/tutorials/how-to-set-up-an-nfs-mount-on-ubuntu-20-04\&#34;&gt;How To Set Up an NFS Mount on Ubuntu 20.04&lt;/a&gt;&lt;br&gt;\n&lt;a href=\&#34;https://qizhanming.com/blog/2018/08/08/how-to-install-nfs-on-centos-7\&#34;&gt;CentOS 7 下 yum 安装和配置 NFS&lt;/a&gt;&lt;/p&gt;\n&#34;,&#34;fileName&#34;:&#34;pei-zhi-nfs&#34;,&#34;abstract&#34;:&#34;&lt;p&gt;学习nfs的配置，并测试k8s部署mysql挂载nfs的方式。&lt;/p&gt;\n&#34;,&#34;title&#34;:&#34;k8s测试mysql挂载nfs遇到的问题&#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;mysql&#34;,&#34;slug&#34;:&#34;NmeeKMdHz&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/NmeeKMdHz/&#34;},{&#34;name&#34;:&#34;权限&#34;,&#34;slug&#34;:&#34;0eAyztTBAO&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/0eAyztTBAO/&#34;},{&#34;name&#34;:&#34;Centos&#34;,&#34;slug&#34;:&#34;EKOGZrskK&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/EKOGZrskK/&#34;},{&#34;name&#34;:&#34;nfs&#34;,&#34;slug&#34;:&#34;RznBLK3Uuv&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/RznBLK3Uuv/&#34;},{&#34;name&#34;:&#34;kubernetes&#34;,&#34;slug&#34;:&#34;9iWQqlqnT&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/9iWQqlqnT/&#34;},{&#34;name&#34;:&#34;k8s&#34;,&#34;slug&#34;:&#34;waCBSEanF&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/waCBSEanF/&#34;},{&#34;name&#34;:&#34;Linux&#34;,&#34;slug&#34;:&#34;mTyB0fhtc&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/mTyB0fhtc/&#34;},{&#34;name&#34;:&#34;Ubuntu&#34;,&#34;slug&#34;:&#34;pelgqi16au&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/pelgqi16au/&#34;}],&#34;date&#34;:&#34;2020-09-06 15:50:41&#34;,&#34;dateFormat&#34;:&#34;2020-09-06&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://tomhht.github.io/post/pei-zhi-nfs/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;1 min read&#34;,&#34;time&#34;:56000,&#34;words&#34;:218,&#34;minutes&#34;:1},&#34;description&#34;:&#34;学习nfs的配置，并测试k8s部署mysql挂载nfs的方式。\n\n配置nfs\nUbuntu\n先将参考链接放这儿。How To Set Up an NFS Mount on Ubuntu 20.04\nCentOS\nCentOS 7 下 yum...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E9%85%8D%E7%BD%AEnfs\&#34;&gt;配置nfs&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#ubuntu\&#34;&gt;Ubuntu&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#centos\&#34;&gt;CentOS&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#k8s%E6%B5%8B%E8%AF%95%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98\&#34;&gt;k8s测试遇到的问题&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E9%95%9C%E5%83%8Fpull%E4%B8%8D%E4%B8%8B%E6%9D%A5\&#34;&gt;镜像pull不下来&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#pod%E9%81%87%E5%88%B0backoff%E7%9A%84%E9%94%99%E8%AF%AF\&#34;&gt;pod遇到backoff的错误&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;p&gt;使用默认版本的busybox会出现nslookup提示无法解析的问题。使用1.28.3版本即可解决。&lt;/p&gt;\n&lt;!-- more --&gt;\n&lt;p&gt;症状：&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;kubectl run busybox --rm -it --image=busybox /bin/sh\n/ # nslookup httpd-svc\nServer:\t\t10.96.0.10\nAddress:\t10.96.0.10:53\n\n** server can&#39;t find httpd-svc.default.svc.cluster.local: NXDOMAIN\n\n*** Can&#39;t find httpd-svc.svc.cluster.local: No answer\n*** Can&#39;t find httpd-svc.cluster.local: No answer\n*** Can&#39;t find httpd-svc.default.svc.cluster.local: No answer\n*** Can&#39;t find httpd-svc.svc.cluster.local: No answer\n*** Can&#39;t find httpd-svc.cluster.local: No answer\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;解决：&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;kubectl run busybox --rm -it --image=busybox:1.28.3 /bin/sh\nIf you don&#39;t see a command prompt, try pressing enter.\n/ # nslookup httpd-svc\nServer:    10.96.0.10\nAddress 1: 10.96.0.10 kube-dns.kube-system.svc.cluster.local\n\nName:      httpd-svc\nAddress 1: 10.108.142.200 httpd-svc.default.svc.cluster.local\n&lt;/code&gt;&lt;/pre&gt;\n&lt;hr&gt;\n&lt;p&gt;参考链接：&lt;br&gt;\n&lt;a href=\&#34;https://www.cnblogs.com/vincenshen/p/9751193.html\&#34;&gt;https://www.cnblogs.com/vincenshen/p/9751193.html&lt;/a&gt;&lt;/p&gt;\n&#34;,&#34;fileName&#34;:&#34;kubernetes-busybox-nslookup-ti-shi-wu-fa-jie-xi-de-wen-ti&#34;,&#34;abstract&#34;:&#34;&lt;p&gt;使用默认版本的busybox会出现nslookup提示无法解析的问题。使用1.28.3版本即可解决。&lt;/p&gt;\n&#34;,&#34;title&#34;:&#34;Kubernetes busybox nslookup提示无法解析的问题&#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;kubernetes&#34;,&#34;slug&#34;:&#34;9iWQqlqnT&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/9iWQqlqnT/&#34;},{&#34;name&#34;:&#34;busybox&#34;,&#34;slug&#34;:&#34;pGSOA5-CqP&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/pGSOA5-CqP/&#34;},{&#34;name&#34;:&#34;nslookup&#34;,&#34;slug&#34;:&#34;if1OeykrkL&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/if1OeykrkL/&#34;},{&#34;name&#34;:&#34;issue&#34;,&#34;slug&#34;:&#34;aBL_wWn2jh&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/aBL_wWn2jh/&#34;},{&#34;name&#34;:&#34;问题&#34;,&#34;slug&#34;:&#34;jDEmr4zvgG&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/jDEmr4zvgG/&#34;},{&#34;name&#34;:&#34;解析&#34;,&#34;slug&#34;:&#34;iEfP63FFtR&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/iEfP63FFtR/&#34;},{&#34;name&#34;:&#34;k8s&#34;,&#34;slug&#34;:&#34;waCBSEanF&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/waCBSEanF/&#34;}],&#34;date&#34;:&#34;2020-09-05 15:43:38&#34;,&#34;dateFormat&#34;:&#34;2020-09-05&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://tomhht.github.io/post/kubernetes-busybox-nslookup-ti-shi-wu-fa-jie-xi-de-wen-ti/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;2 min read&#34;,&#34;time&#34;:64000,&#34;words&#34;:189,&#34;minutes&#34;:2},&#34;description&#34;:&#34;使用默认版本的busybox会出现nslookup提示无法解析的问题。使用1.28.3版本即可解决。\n\n症状：\nkubectl run busybox --rm -it --image=busybox /bin/sh\n/ # nslooku...&#34;,&#34;toc&#34;:&#34;&#34;},{&#34;content&#34;:&#34;&lt;p&gt;拿了本大半年了，昨天第一次正式开车。&lt;/p&gt;\n&lt;!-- more --&gt;\n&lt;p&gt;太刺激了。画龙、剐蹭、油合离门，应有尽有。科三考了3次才过，考过后抽奖中了一个陪练机会，跟着教练开了趟易县（同练的还有其他学员）。这就是之前全部的开车经历了。&lt;br /&gt;&lt;br&gt;\n昨天因为要接侄子，学校在一个鸟不拉屎的地方，约不到车，所以硬着头皮把家里的车开出来了。首先找地方掉头，光顾着看后面，结果车头蹭人家墙上了，引得人家出来检查。&lt;br /&gt;&lt;br&gt;\n好不容易掉好头，跟别的车交汇，一闪躲，噌，又是一声，之前左边，这次右边。&lt;br /&gt;&lt;br&gt;\n继续前行，后来想想，居然当时心态没崩。&lt;br /&gt;&lt;br&gt;\n画龙前行，志玲姐姐忽然来一句右转立刻左转，我这路口到底怎么走啊，遂决定直接左转，进了左转车道等红灯，发现右转后走10米果然有左转路，WTF。左转车道硬着头皮左转完了，终于找到一个路口直接掉头，走上了康庄大道。&lt;br /&gt;&lt;br&gt;\n转完了突然道路宽阔了起来，路上也没几辆车，于是let&#39;s go，4档的干活，这感觉就是乌龟爬到了兔子身上。&lt;br /&gt;&lt;br&gt;\n到校后，等了几个钟头，中途又开着出去练练手，接上娃后返程的路途也算有惊无险，终于平安的运送回家。庆幸的是这一路没有倒车入库、侧方停车之类的技术活。万幸。&lt;/p&gt;\n&#34;,&#34;fileName&#34;:&#34;di-yi-ci-zheng-shi-kai-che&#34;,&#34;abstract&#34;:&#34;&lt;p&gt;拿了本大半年了，昨天第一次正式开车。&lt;/p&gt;\n&#34;,&#34;title&#34;:&#34;第一次正式开车&#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;开车&#34;,&#34;slug&#34;:&#34;H65lpTSQ_&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/H65lpTSQ_/&#34;},{&#34;name&#34;:&#34;第一次&#34;,&#34;slug&#34;:&#34;r0iZcLdHQh&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/r0iZcLdHQh/&#34;},{&#34;name&#34;:&#34;惊险&#34;,&#34;slug&#34;:&#34;LvxBwvofUe&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/LvxBwvofUe/&#34;},{&#34;name&#34;:&#34;刺激&#34;,&#34;slug&#34;:&#34;nLGCexIFLh&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/nLGCexIFLh/&#34;},{&#34;name&#34;:&#34;journel&#34;,&#34;slug&#34;:&#34;JASWMsZcXM&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/JASWMsZcXM/&#34;},{&#34;name&#34;:&#34;随笔&#34;,&#34;slug&#34;:&#34;vVcJap5Pi&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/vVcJap5Pi/&#34;},{&#34;name&#34;:&#34;日记&#34;,&#34;slug&#34;:&#34;mU8w5MS9OO&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/mU8w5MS9OO/&#34;}],&#34;date&#34;:&#34;2020-09-05 13:44:19&#34;,&#34;dateFormat&#34;:&#34;2020-09-05&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://tomhht.github.io/post/di-yi-ci-zheng-shi-kai-che/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;2 min read&#34;,&#34;time&#34;:81000,&#34;words&#34;:401,&#34;minutes&#34;:2},&#34;description&#34;:&#34;拿了本大半年了，昨天第一次正式开车。\n\n太刺激了。画龙、剐蹭、油合离门，应有尽有。科三考了3次才过，考过后抽奖中了一个陪练机会，跟着教练开了趟易县（同练的还有其他学员）。这就是之前全部的开车经历了。\n昨天因为要接侄子，学校在一个鸟不拉屎的地...&#34;,&#34;toc&#34;:&#34;&#34;},{&#34;content&#34;:&#34;&lt;p&gt;除了k8s要求的端口要开，worker node上面的&lt;code&gt;8472/udp（vxlan backend）&lt;/code&gt;也得开。（尽管参考链接里明确的是worker node要开，但master似乎也得开，否则master里面的coredns无法为worker node服务）&lt;/p&gt;\n&lt;!-- more --&gt;\n&lt;p&gt;用&lt;code&gt;nmcli&lt;/code&gt;查看，发现flannel 用到的是&lt;code&gt;vxlan backend&lt;/code&gt;，因此需要打开&lt;code&gt;8472/udp&lt;/code&gt;。&lt;br  /&gt;&lt;br&gt;\n打开后，发现Ubuntu的node可以被ping通，同时如果上面跑着&lt;code&gt;httpd&lt;/code&gt;，其他node也可以&lt;code&gt;curl&lt;/code&gt;到内容；而CentOS只能被ping通，&lt;code&gt;curl 10.244.2.19&lt;/code&gt;的时候会显示&lt;code&gt;curl: (7) Failed to connect to 10.244.2.19 port 80: No route to host&lt;/code&gt;。&lt;br /&gt;&lt;br&gt;\n查了n多资料，几乎都是关闭防火墙，关闭后确实能解决，但我想这不是生产环境中的做法。最终在这位仁兄Louis He的博文&lt;a href=\&#34;https://www.cnblogs.com/Dev0ps/p/11401530.html\&#34;&gt;Kubernetes集群开启Firewall&lt;/a&gt;中找到答案&lt;code&gt;add-masquerade&lt;/code&gt;。同时也谢谢让我找到8472端口的仁兄&lt;a href=\&#34;https://www.codenong.com/39293441/\&#34;&gt;关于网络：Kubernetes集群所需的端口&lt;/a&gt;。&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;# Ubuntu\nsudo ufw allow 8472/udp #搞定\n\n# CentOS\nsudo firewall-cmd --zone=public --add-port=8472/udp --permanent\nsudo firewall-cmd --reload #这步搞完只能被ping通，curl时是No route to host，头疼死了\nsudo firewall-cmd --add-masquerade --permanent\nsudo firewall-cmd --reload #这才把curl也打通了，我太难了\n&lt;/code&gt;&lt;/pre&gt;\n&lt;hr&gt;\n&lt;p&gt;参考链接：&lt;br&gt;\n&lt;a href=\&#34;https://www.codenong.com/39293441/\&#34;&gt;https://www.codenong.com/39293441/&lt;/a&gt;&lt;br&gt;\n&lt;a href=\&#34;https://www.cnblogs.com/Dev0ps/p/11401530.html\&#34;&gt;https://www.cnblogs.com/Dev0ps/p/11401530.html&lt;/a&gt;&lt;/p&gt;\n&#34;,&#34;fileName&#34;:&#34;k8s-ji-qun-kua-jie-dian-pods-wu-fa-ping-tong&#34;,&#34;abstract&#34;:&#34;&lt;p&gt;除了k8s要求的端口要开，worker node上面的&lt;code&gt;8472/udp（vxlan backend）&lt;/code&gt;也得开。（尽管参考链接里明确的是worker node要开，但master似乎也得开，否则master里面的coredns无法为worker node服务）&lt;/p&gt;\n&#34;,&#34;title&#34;:&#34;k8s集群跨节点pods无法ping通以及无法curl&#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;node&#34;,&#34;slug&#34;:&#34;ktPWlgDOF&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/ktPWlgDOF/&#34;},{&#34;name&#34;:&#34;master&#34;,&#34;slug&#34;:&#34;oqB9teWmFq&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/oqB9teWmFq/&#34;},{&#34;name&#34;:&#34;worker&#34;,&#34;slug&#34;:&#34;ZoV7NucWOu&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/ZoV7NucWOu/&#34;},{&#34;name&#34;:&#34;coredns&#34;,&#34;slug&#34;:&#34;4P-c28hZd&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/4P-c28hZd/&#34;},{&#34;name&#34;:&#34;k8s&#34;,&#34;slug&#34;:&#34;waCBSEanF&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/waCBSEanF/&#34;},{&#34;name&#34;:&#34;集群&#34;,&#34;slug&#34;:&#34;naHmaZ_HMS&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/naHmaZ_HMS/&#34;},{&#34;name&#34;:&#34;cluster&#34;,&#34;slug&#34;:&#34;yE4fTs2PIS&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/yE4fTs2PIS/&#34;},{&#34;name&#34;:&#34;pod&#34;,&#34;slug&#34;:&#34;FAeA3gxSv-&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/FAeA3gxSv-/&#34;},{&#34;name&#34;:&#34;deployment&#34;,&#34;slug&#34;:&#34;GPRVeyKbA2&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/GPRVeyKbA2/&#34;},{&#34;name&#34;:&#34;curl&#34;,&#34;slug&#34;:&#34;7vahxDiu2H&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/7vahxDiu2H/&#34;},{&#34;name&#34;:&#34;ping&#34;,&#34;slug&#34;:&#34;0bvHxHIt3f&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/0bvHxHIt3f/&#34;},{&#34;name&#34;:&#34;firewall&#34;,&#34;slug&#34;:&#34;8I-WOs8AEy&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/8I-WOs8AEy/&#34;},{&#34;name&#34;:&#34;utw&#34;,&#34;slug&#34;:&#34;mxbKCZJxae&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/mxbKCZJxae/&#34;},{&#34;name&#34;:&#34;端口&#34;,&#34;slug&#34;:&#34;guNk0JsrG&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/guNk0JsrG/&#34;},{&#34;name&#34;:&#34;port&#34;,&#34;slug&#34;:&#34;nU_jlBkSws&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/nU_jlBkSws/&#34;},{&#34;name&#34;:&#34;Linux&#34;,&#34;slug&#34;:&#34;mTyB0fhtc&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/mTyB0fhtc/&#34;},{&#34;name&#34;:&#34;Kubernetes&#34;,&#34;slug&#34;:&#34;2myAgZVX1&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/2myAgZVX1/&#34;},{&#34;name&#34;:&#34;Ubuntu&#34;,&#34;slug&#34;:&#34;pelgqi16au&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/pelgqi16au/&#34;},{&#34;name&#34;:&#34;CentOS&#34;,&#34;slug&#34;:&#34;qjvKbAF653&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/qjvKbAF653/&#34;}],&#34;date&#34;:&#34;2020-09-03 18:33:25&#34;,&#34;dateFormat&#34;:&#34;2020-09-03&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://tomhht.github.io/post/k8s-ji-qun-kua-jie-dian-pods-wu-fa-ping-tong/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;2 min read&#34;,&#34;time&#34;:77000,&#34;words&#34;:304,&#34;minutes&#34;:2},&#34;description&#34;:&#34;除了k8s要求的端口要开，worker node上面的8472/udp（vxlan backend）也得开。（尽管参考链接里明确的是worker node要开，但master似乎也得开，否则master里面的coredns无法为worker...&#34;,&#34;toc&#34;:&#34;&#34;},{&#34;content&#34;:&#34;&lt;p&gt;上周六去了趟圣莲山，陪人散心，尽管好像只是把他当作车夫。&lt;/p&gt;\n&lt;!-- more --&gt;\n&lt;p&gt;建议买观光车的票，否则从入口到正经爬山点有7里地，走个往返就该打道回府了。&lt;br /&gt;&lt;br&gt;\n之前只是听人说过，这次别人想散心，于是推荐此地，想散心的当了全程司机。坐在车上往山里去是越来越凉快，途中也见到了十分陡峭的山，果然房山就是山多。&lt;br /&gt;&lt;br&gt;\n散心人腿受伤了，因此到了景区后尽量搞不需要用腿的项目，比如观光车、缆车（内心OS：既然腿不好，来山上干啥）。&lt;br /&gt;&lt;br&gt;\n其实本人是第一次坐缆车，稍微往下看看，确实有点腿软。同时想起意大利的一首民歌，就叫缆车，讲的是18几几年的事儿，有个老板搞山区旅游项目，于是搞了人力缆车，并且专门找作曲家写了个曲子，就是缆车，实际上原文的发音是fu ni ku li fu ni ku la，模拟缆车的声音，这个歌曲更准确说应该类似于咱们的劳动号子，大家边唱边使劲拉绳子。曲子非常欢快，进行曲的那种感觉，很多歌剧演员都唱过，比如著名的帕瓦罗蒂。但我第一次听是在芒果台的声入人心，一遍就喜欢上了。我妈觉得有些段落像是鬼子进村。&lt;br /&gt;&lt;br&gt;\n缆车上山后，直奔观光车司机推荐的必去景点，一个叫圣莲宝塔，一个叫莲子峰。圣莲宝塔就是后人翻建的一个建筑，每层都绘制了佛教的故事。其实更喜欢纯的古建筑，或者以古修古的那种，可惜这个宝塔之前彻底倒塌了。塔旁边的山上还有题字，开始还以为是书法家才会题字，可这个字怎么看都觉得挺小学生的（没有侮辱小学生的意思），一直也联想不到是哪位大家的风格。正暗自感叹见识太少，忽听得旁人百度的结果，题字人正是宝塔翻建的出资人之一，心里的大石头终于落地，看来自己审美没出大问题。旁人也怀同样感觉，大家都释然了。当然出资人的功德肯定是大大的。&lt;br /&gt;&lt;br&gt;\n实际上两个景点带来的感觉没有太震撼，但是游玩这种事情，过程才是核心。中间还路过一个景点叫八仙洞，就是在山上凿穿了个洞，看洞壁的坑坑洼洼，猜测应该是前人一凿一斧的心血，洞内凉气十足，且洞顶还有渗水滴下，我们感叹应该穿棉袄进来。后来散心人在洞外忽悠后来者，说洞里租军大衣。一个几岁的小男孩说什么也不进去，跟爸妈说里面可怕，我在想估计他们一家就要就此打住了，结果孩子爸妈想了个办法，把孩子抱上让孩子趴肩头挡住眼睛，直接就进去了。这都行，孩子就是孩子。&lt;br /&gt;&lt;br&gt;\n之后我们找了个僻静处吃午饭，说实话背了一路，烧饼、香肠还有水，累死我了。我爸买的这香肠也有个性，外面塑料皮剥开，里面居然还有一层塑料膜，我还没叫出来，散心人已经一口啃下并吞下了一角塑料膜。这肠有个性，这人更有个性。&lt;/p&gt;\n&#34;,&#34;fileName&#34;:&#34;sheng-lian-shan-sui-bi&#34;,&#34;abstract&#34;:&#34;&lt;p&gt;上周六去了趟圣莲山，陪人散心，尽管好像只是把他当作车夫。&lt;/p&gt;\n&#34;,&#34;title&#34;:&#34;圣莲山随笔&#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;随笔&#34;,&#34;slug&#34;:&#34;vVcJap5Pi&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/vVcJap5Pi/&#34;},{&#34;name&#34;:&#34;日记&#34;,&#34;slug&#34;:&#34;mU8w5MS9OO&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/mU8w5MS9OO/&#34;},{&#34;name&#34;:&#34;journal&#34;,&#34;slug&#34;:&#34;ejOgYFlYcd&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/ejOgYFlYcd/&#34;},{&#34;name&#34;:&#34;游记&#34;,&#34;slug&#34;:&#34;wP0dWoTcod&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/wP0dWoTcod/&#34;},{&#34;name&#34;:&#34;圣莲山&#34;,&#34;slug&#34;:&#34;hYtK2OUdp&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/hYtK2OUdp/&#34;},{&#34;name&#34;:&#34;郊游&#34;,&#34;slug&#34;:&#34;XND26UythC&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/XND26UythC/&#34;},{&#34;name&#34;:&#34;散心&#34;,&#34;slug&#34;:&#34;QgK8_fIsEU&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/QgK8_fIsEU/&#34;},{&#34;name&#34;:&#34;缆车&#34;,&#34;slug&#34;:&#34;knK15BJeDj&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/knK15BJeDj/&#34;},{&#34;name&#34;:&#34;观光车&#34;,&#34;slug&#34;:&#34;KD74sZYvHK&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/KD74sZYvHK/&#34;},{&#34;name&#34;:&#34;老子&#34;,&#34;slug&#34;:&#34;bbNdAvIFcC&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/bbNdAvIFcC/&#34;},{&#34;name&#34;:&#34;陡峭&#34;,&#34;slug&#34;:&#34;0Yqv2YqYXn&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/0Yqv2YqYXn/&#34;},{&#34;name&#34;:&#34;人少&#34;,&#34;slug&#34;:&#34;AcwXp59em0&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/AcwXp59em0/&#34;},{&#34;name&#34;:&#34;道教&#34;,&#34;slug&#34;:&#34;zCIZXoeJU-&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/zCIZXoeJU-/&#34;}],&#34;date&#34;:&#34;2020-09-03 14:39:26&#34;,&#34;dateFormat&#34;:&#34;2020-09-03&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://tomhht.github.io/post/sheng-lian-shan-sui-bi/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;4 min read&#34;,&#34;time&#34;:183000,&#34;words&#34;:910,&#34;minutes&#34;:4},&#34;description&#34;:&#34;上周六去了趟圣莲山，陪人散心，尽管好像只是把他当作车夫。\n\n建议买观光车的票，否则从入口到正经爬山点有7里地，走个往返就该打道回府了。\n之前只是听人说过，这次别人想散心，于是推荐此地，想散心的当了全程司机。坐在车上往山里去是越来越凉快，途中...&#34;,&#34;toc&#34;:&#34;&#34;},{&#34;content&#34;:&#34;&lt;p&gt;实操遇到问题好多，记录下。&lt;/p&gt;\n&lt;!-- more --&gt;\n&lt;h1 id=\&#34;image拉取失败replicas被弃用\&#34;&gt;image拉取失败，replicas被弃用&lt;/h1&gt;\n&lt;h2 id=\&#34;问题\&#34;&gt;问题&lt;/h2&gt;\n&lt;pre&gt;&lt;code&gt;# 执行run，显示replicas has been deprecated，因此不生效，只部署了1个实例 \nkubectl run httpd-app --image=httpd --replicas=2\n# 检查pods运行情况，READY列显示未就绪\nkubectl get pods -n wide\n# 检查运行细节，一直显示pulling\nkubectl describe pods httpd-app\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;解决\&#34;&gt;解决&lt;/h2&gt;\n&lt;ol&gt;\n&lt;li&gt;删除之前的部署：&lt;/li&gt;\n&lt;/ol&gt;\n&lt;pre&gt;&lt;code&gt;kubectl delete pods httpd-app\n&lt;/code&gt;&lt;/pre&gt;\n&lt;ol start=\&#34;2\&#34;&gt;\n&lt;li&gt;创建部署文件：&lt;/li&gt;\n&lt;/ol&gt;\n&lt;pre&gt;&lt;code&gt;cd ~/k8s\nnano nginx.yaml\n&lt;/code&gt;&lt;/pre&gt;\n&lt;ol start=\&#34;3\&#34;&gt;\n&lt;li&gt;粘贴下面内容进nginx.yaml：&lt;/li&gt;\n&lt;/ol&gt;\n&lt;pre&gt;&lt;code&gt;# API 版本号\napiVersion: apps/v1\n# 类型，如：Pod/ReplicationController/Deployment/Service/Ingress\nkind: Deployment\nmetadata:\n  # Kind 的名称\n  name: nginx-app\nspec:\n  selector:\n    matchLabels:\n      # 容器标签的名字，发布 Service 时，selector 需要和这里对应\n      app: nginx\n  # 部署的实例数量\n  replicas: 2\n  template:\n    metadata:\n      labels:\n        app: nginx\n    spec:\n      # 配置容器，数组类型，说明可以配置多个容器\n      containers:\n      # 容器名称\n      - name: nginx\n        # 容器镜像\n        image: nginx:1.17\n        # 只有镜像不存在时，才会进行镜像拉取\n        imagePullPolicy: IfNotPresent\n        ports:\n        # Pod 端口\n        - containerPort: 80\n&lt;/code&gt;&lt;/pre&gt;\n&lt;ol start=\&#34;4\&#34;&gt;\n&lt;li&gt;创建：&lt;/li&gt;\n&lt;/ol&gt;\n&lt;pre&gt;&lt;code&gt;kubectl apply -f nginx.yaml\n&lt;/code&gt;&lt;/pre&gt;\n&lt;ol start=\&#34;5\&#34;&gt;\n&lt;li&gt;检查：&lt;/li&gt;\n&lt;/ol&gt;\n&lt;pre&gt;&lt;code&gt;kubectl get deployments\nkubectl describe deployment nginx-app\nkubectl get replicaset\nkubectl describe rs nginx-app-5d85b5fb59\nkubectl get pods -o wide\nkubectl describe pods nginx-app-5d85b5fb59-2ct5p\n&lt;/code&gt;&lt;/pre&gt;\n&lt;ol start=\&#34;6\&#34;&gt;\n&lt;li&gt;暴露服务：&lt;/li&gt;\n&lt;/ol&gt;\n&lt;pre&gt;&lt;code&gt;kubectl expose deployment nginx-app --port=80 --type=LoadBalancer\n&lt;/code&gt;&lt;/pre&gt;\n&lt;ol start=\&#34;7\&#34;&gt;\n&lt;li&gt;查看服务状态(查看对外的端口)&lt;/li&gt;\n&lt;/ol&gt;\n&lt;pre&gt;&lt;code&gt;kubectl get services\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;code&gt;nginx-app&lt;/code&gt;一直处于pending状态，应该是type设置为&lt;code&gt;LoadBalancer&lt;/code&gt;，但没有云服务商和本地服务提供该功能。&lt;/p&gt;\n&lt;hr&gt;\n&lt;p&gt;参考链接：&lt;br&gt;\n&lt;a href=\&#34;https://blog.csdn.net/qq_43279371/article/details/107768713\&#34;&gt;https://blog.csdn.net/qq_43279371/article/details/107768713&lt;/a&gt;&lt;br&gt;\n&lt;a href=\&#34;https://blog.csdn.net/kenkao/article/details/86764788\&#34;&gt;https://blog.csdn.net/kenkao/article/details/86764788&lt;/a&gt;&lt;/p&gt;\n&#34;,&#34;fileName&#34;:&#34;k8s-cao-zuo-bi-ji&#34;,&#34;abstract&#34;:&#34;&lt;p&gt;实操遇到问题好多，记录下。&lt;/p&gt;\n&#34;,&#34;title&#34;:&#34;k8s操作笔记&#34;,&#34;tags&#34;:[],&#34;date&#34;:&#34;2020-09-02 17:00:52&#34;,&#34;dateFormat&#34;:&#34;2020-09-02&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://tomhht.github.io/post/k8s-cao-zuo-bi-ji/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;2 min read&#34;,&#34;time&#34;:98000,&#34;words&#34;:361,&#34;minutes&#34;:2},&#34;description&#34;:&#34;实操遇到问题好多，记录下。\n\nimage拉取失败，replicas被弃用\n问题\n# 执行run，显示replicas has been deprecated，因此不生效，只部署了1个实例 \nkubectl run httpd-app --i...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;&lt;a href=\&#34;#image%E6%8B%89%E5%8F%96%E5%A4%B1%E8%B4%A5replicas%E8%A2%AB%E5%BC%83%E7%94%A8\&#34;&gt;image拉取失败，replicas被弃用&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E9%97%AE%E9%A2%98\&#34;&gt;问题&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E8%A7%A3%E5%86%B3\&#34;&gt;解决&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;p&gt;加快Ubuntu和CentOS软件下载速度。&lt;/p&gt;\n&lt;!-- more --&gt;\n&lt;h1 id=\&#34;ubuntu\&#34;&gt;Ubuntu&lt;/h1&gt;\n&lt;p&gt;备份源配置文件：&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;sudo cp /etc/apt/sources.list /etc/apt/sources.list.bak\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;使用vim或gedit编辑source.list，用下面内容替换原有内容：&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;# 默认注释了源码镜像以提高 apt update 速度，如有需要可自行取消注释\ndeb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal main restricted universe multiverse\n# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal main restricted universe multiverse\ndeb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-updates main restricted universe multiverse\n# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-updates main restricted universe multiverse\ndeb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-backports main restricted universe multiverse\n# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-backports main restricted universe multiverse\ndeb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-security main restricted universe multiverse\n# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-security main restricted universe multiverse\n\n# 预发布软件源，不建议启用\n# deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-proposed main restricted universe multiverse\n# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-proposed main restricted universe multiverse\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;更新软件包缓存，使配置文件生效：&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;sudo apt-get update\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h1 id=\&#34;centos\&#34;&gt;CentOS&lt;/h1&gt;\n&lt;pre&gt;&lt;code&gt;path=&#39;/etc/yum.repos.d/&#39;\nrepos=(CentOS-AppStream.repo CentOS-Base.repo CentOS-centosplus.repo CentOS-Extras.repo CentOS-PowerTools.repo)\nfor repo in ${repos[@]}; do\nsudo cp $path$repo $path$repo&#39;.bak&#39; #备份源配置文件\nsudo sed -i &amp;quot;s/^mirrorlist/#&amp;amp;/; s/^#baseurl/baseurl/; s/http:\\/\\/mirror.centos.org\\/\\$contentdir/https:\\/\\/mirrors.tuna.tsinghua.edu.cn\\/centos/&amp;quot; $path$repo #修改配置文件\ndone\n# 更新软件包缓存，使配置文件生效\nsudo yum makecache\n&lt;/code&gt;&lt;/pre&gt;\n&lt;hr&gt;\n&lt;p&gt;参考链接：&lt;br&gt;\n&lt;a href=\&#34;https://mirrors.tuna.tsinghua.edu.cn/help/ubuntu/\&#34;&gt;https://mirrors.tuna.tsinghua.edu.cn/help/ubuntu/&lt;/a&gt;&lt;br&gt;\n&lt;a href=\&#34;https://blog.csdn.net/xiangxianghehe/article/details/105688062\&#34;&gt;https://blog.csdn.net/xiangxianghehe/article/details/105688062&lt;/a&gt;&lt;br&gt;\n&lt;a href=\&#34;https://mirror.tuna.tsinghua.edu.cn/help/centos/\&#34;&gt;https://mirror.tuna.tsinghua.edu.cn/help/centos/&lt;/a&gt;&lt;/p&gt;\n&#34;,&#34;fileName&#34;:&#34;pei-zhi-ubuntu-he-centos-qing-hua-yuan&#34;,&#34;abstract&#34;:&#34;&lt;p&gt;加快Ubuntu和CentOS软件下载速度。&lt;/p&gt;\n&#34;,&#34;title&#34;:&#34;配置Ubuntu和CentOS清华源&#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;加速&#34;,&#34;slug&#34;:&#34;-7LE7Ga8N&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/-7LE7Ga8N/&#34;},{&#34;name&#34;:&#34;源&#34;,&#34;slug&#34;:&#34;hxgTAOH_N6&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/hxgTAOH_N6/&#34;},{&#34;name&#34;:&#34;国内源&#34;,&#34;slug&#34;:&#34;AVam_YHxdq&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/AVam_YHxdq/&#34;},{&#34;name&#34;:&#34;清华源&#34;,&#34;slug&#34;:&#34;xl0sLn8kCY&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/xl0sLn8kCY/&#34;},{&#34;name&#34;:&#34;tsinghua&#34;,&#34;slug&#34;:&#34;8ea4TbNf-K&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/8ea4TbNf-K/&#34;},{&#34;name&#34;:&#34;tuna&#34;,&#34;slug&#34;:&#34;AKueiIe07M&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/AKueiIe07M/&#34;},{&#34;name&#34;:&#34;Linux&#34;,&#34;slug&#34;:&#34;mTyB0fhtc&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/mTyB0fhtc/&#34;},{&#34;name&#34;:&#34;Ubuntu&#34;,&#34;slug&#34;:&#34;pelgqi16au&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/pelgqi16au/&#34;},{&#34;name&#34;:&#34;CentOS&#34;,&#34;slug&#34;:&#34;qjvKbAF653&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/qjvKbAF653/&#34;}],&#34;date&#34;:&#34;2020-09-01 19:56:40&#34;,&#34;dateFormat&#34;:&#34;2020-09-01&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://tomhht.github.io/post/pei-zhi-ubuntu-he-centos-qing-hua-yuan/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;2 min read&#34;,&#34;time&#34;:117000,&#34;words&#34;:365,&#34;minutes&#34;:2},&#34;description&#34;:&#34;加快Ubuntu和CentOS软件下载速度。\n\nUbuntu\n备份源配置文件：\nsudo cp /etc/apt/sources.list /etc/apt/sources.list.bak\n\n使用vim或gedit编辑source.lis...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;&lt;a href=\&#34;#ubuntu\&#34;&gt;Ubuntu&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#centos\&#34;&gt;CentOS&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;p&gt;整理docker安装心得。&lt;/p&gt;\n&lt;!-- more --&gt;\n&lt;h1 id=\&#34;centos\&#34;&gt;CentOS&lt;/h1&gt;\n&lt;pre&gt;&lt;code&gt;# 移除旧版\nsudo yum remove docker \\\n                  docker-client \\\n                  docker-client-latest \\\n                  docker-common \\\n                  docker-latest \\\n                  docker-latest-logrotate \\\n                  docker-logrotate \\\n                  docker-engine\n# 设置阿里云仓库repository\nsudo yum install -y yum-utils\nsudo yum-config-manager \\\n    --add-repo \\\n   http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo\n# 安装containerd.io\nsudo yum install -y https://mirrors.aliyun.com/docker-ce/linux/centos/7/x86_64/stable/Packages/containerd.io-1.2.6-3.3.el7.x86_64.rpm\n# 安装docker\nsudo yum install docker-ce docker-ce-cli\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h1 id=\&#34;ubuntu\&#34;&gt;Ubuntu&lt;/h1&gt;\n&lt;pre&gt;&lt;code&gt;# 移除旧版\nsudo apt-get remove docker docker-engine docker.io containerd runc\n# 安装依赖软件\nsudo apt-get update\nsudo apt-get install \\\n    apt-transport-https \\\n    ca-certificates \\\n    curl \\\n    gnupg-agent \\\n    software-properties-common\n# 添加中科大DockerGPG KEY\ncurl -fsSL https://mirrors.ustc.edu.cn/docker-ce/linux/ubuntu/gpg | sudo apt-key add -\n# 添加中科大仓库\nsudo add-apt-repository &amp;quot;deb [arch=amd64] https://mirrors.ustc.edu.cn/docker-ce/linux/ubuntu \\\n$(lsb_release -cs) stable&amp;quot;\n# 安装docker\nsudo apt update\nsudo apt install docker-ce docker-ce-cli containerd.io\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;以上操作完毕后，继续操作下面通用部分。&lt;/p&gt;\n&lt;h1 id=\&#34;通用\&#34;&gt;通用&lt;/h1&gt;\n&lt;pre&gt;&lt;code&gt;# 启动docker\nsudo systemctl start docker\n# 加入开机启动\nsudo systemctl enable docker\n# 允许当前用户使用docker\nsudo usermod -aG docker ${USER}\nsu - $USER //立刻生效\n# 配置国内加速器（可显著增加docker pull镜像的成功率和速度）\nsudo tee /etc/docker/daemon.json &amp;lt;&amp;lt;-&#39;EOF&#39;\n{\n  &amp;quot;registry-mirrors&amp;quot;: [\n    &amp;quot;https://97g5u05j.mirror.aliyuncs.com&amp;quot;,\n    &amp;quot;https://dockerhub.azk8s.cn&amp;quot;,\n    &amp;quot;https://hub-mirror.c.163.com&amp;quot;,\n    &amp;quot;https://docker.mirrors.ustc.edu.cn&amp;quot;\n  ],\n  &amp;quot;exec-opts&amp;quot;: [&amp;quot;native.cgroupdriver=systemd&amp;quot;],\n  &amp;quot;log-driver&amp;quot;: &amp;quot;json-file&amp;quot;,\n  &amp;quot;log-opts&amp;quot;: {\n    &amp;quot;max-size&amp;quot;: &amp;quot;100m&amp;quot;\n  },\n  &amp;quot;storage-driver&amp;quot;: &amp;quot;overlay2&amp;quot;\n}\nEOF\nsudo systemctl daemon-reload\nsudo systemctl restart docker\n&lt;/code&gt;&lt;/pre&gt;\n&lt;hr&gt;\n&lt;p&gt;参考链接：&lt;br&gt;\n&lt;a href=\&#34;https://docs.docker.com/engine/install/\&#34;&gt;https://docs.docker.com/engine/install/&lt;/a&gt;&lt;br&gt;\n&lt;a href=\&#34;https://developer.aliyun.com/article/763983\&#34;&gt;https://developer.aliyun.com/article/763983&lt;/a&gt;&lt;br&gt;\n&lt;a href=\&#34;https://www.jianshu.com/p/5a911f20d93e\&#34;&gt;https://www.jianshu.com/p/5a911f20d93e&lt;/a&gt;&lt;br&gt;\n&lt;a href=\&#34;https://blog.csdn.net/Alexhcf/article/details/106726860\&#34;&gt;https://blog.csdn.net/Alexhcf/article/details/106726860&lt;/a&gt;&lt;br&gt;\n&lt;a href=\&#34;https://www.cnblogs.com/xuyaowen/p/usermod_session.html\&#34;&gt;Linux 修改用户组后，如何关闭所有 X session 下使得组生效？&lt;/a&gt;&lt;/p&gt;\n&#34;,&#34;fileName&#34;:&#34;zai-centos-he-ubuntu-shang-an-zhuang-he-pei-zhi-docker&#34;,&#34;abstract&#34;:&#34;&lt;p&gt;整理docker安装心得。&lt;/p&gt;\n&#34;,&#34;title&#34;:&#34;在CentOS和Ubuntu上安装和配置docker&#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;安装&#34;,&#34;slug&#34;:&#34;Q8BfV1d_Wf&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/Q8BfV1d_Wf/&#34;},{&#34;name&#34;:&#34;Linux&#34;,&#34;slug&#34;:&#34;mTyB0fhtc&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/mTyB0fhtc/&#34;},{&#34;name&#34;:&#34;配置&#34;,&#34;slug&#34;:&#34;Bwz1BaTtzi&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/Bwz1BaTtzi/&#34;},{&#34;name&#34;:&#34;Ubuntu&#34;,&#34;slug&#34;:&#34;pelgqi16au&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/pelgqi16au/&#34;},{&#34;name&#34;:&#34;CentOS&#34;,&#34;slug&#34;:&#34;qjvKbAF653&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/qjvKbAF653/&#34;},{&#34;name&#34;:&#34;Docker&#34;,&#34;slug&#34;:&#34;RkYw1lQ_qY&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/RkYw1lQ_qY/&#34;},{&#34;name&#34;:&#34;Aliyun&#34;,&#34;slug&#34;:&#34;LQERLoeDmq&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/LQERLoeDmq/&#34;},{&#34;name&#34;:&#34;阿里云&#34;,&#34;slug&#34;:&#34;CDrtFP3hgt&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/CDrtFP3hgt/&#34;}],&#34;date&#34;:&#34;2020-09-01 18:06:21&#34;,&#34;dateFormat&#34;:&#34;2020-09-01&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://tomhht.github.io/post/zai-centos-he-ubuntu-shang-an-zhuang-he-pei-zhi-docker/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;3 min read&#34;,&#34;time&#34;:138000,&#34;words&#34;:428,&#34;minutes&#34;:3},&#34;description&#34;:&#34;整理docker安装心得。\n\nCentOS\n# 移除旧版\nsudo yum remove docker \\\n                  docker-client \\\n                  docker-client-...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;&lt;a href=\&#34;#centos\&#34;&gt;CentOS&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#ubuntu\&#34;&gt;Ubuntu&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E9%80%9A%E7%94%A8\&#34;&gt;通用&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;p&gt;记录下端口设置，用到啥记录啥。&lt;/p&gt;\n&lt;!-- more --&gt;\n&lt;h1 id=\&#34;centos\&#34;&gt;CentOS&lt;/h1&gt;\n&lt;p&gt;核心指令&lt;code&gt;firewall-cmd&lt;/code&gt;&lt;/p&gt;\n&lt;h2 id=\&#34;查看已开放端口\&#34;&gt;查看已开放端口&lt;/h2&gt;\n&lt;pre&gt;&lt;code&gt;sudo firewall-cmd --list-ports\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;开启端口\&#34;&gt;开启端口&lt;/h2&gt;\n&lt;pre&gt;&lt;code&gt;sudo firewall-cmd --zone=public --add-port=10250/tcp --permanent\nsudo firewall-cmd --zone=public --add-port=30000-32767/tcp --permanent\n//--zone: 作用域 \n//--add-port=2181/tcp: 要开启的端口号，格式为：端口号/通讯协议 \n//--permanent: 使端口永久开放，如不添加，则表示临时有效，开机重启后便会失效\n//30000-32767，端口区间\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;关闭端口\&#34;&gt;关闭端口&lt;/h2&gt;\n&lt;pre&gt;&lt;code&gt;sudo firewall-cmd --zone=public --remove-port=6443/tcp --permanent\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;reload以便-permanent配置生效\&#34;&gt;reload以便--permanent配置生效&lt;/h2&gt;\n&lt;pre&gt;&lt;code&gt;sudo firewall-cmd --reload\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h1 id=\&#34;ubuntu\&#34;&gt;Ubuntu&lt;/h1&gt;\n&lt;p&gt;核心指令&lt;code&gt;ufw&lt;/code&gt;&lt;/p&gt;\n&lt;h2 id=\&#34;启用ufw\&#34;&gt;启用ufw&lt;/h2&gt;\n&lt;pre&gt;&lt;code&gt;sudo ufw enable\nsudo ufw allow ssh\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;查看已开放端口-2\&#34;&gt;查看已开放端口&lt;/h2&gt;\n&lt;pre&gt;&lt;code&gt;sudo ufw status\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;开启端口-2\&#34;&gt;开启端口&lt;/h2&gt;\n&lt;pre&gt;&lt;code&gt;sudo ufw allow 10250/tcp\nsudo ufw allow 30000:32767/tcp\n//30000:32767是端口区间\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;关闭端口-2\&#34;&gt;关闭端口&lt;/h2&gt;\n&lt;pre&gt;&lt;code&gt;sudo ufw delete allow 10250/tcp\n&lt;/code&gt;&lt;/pre&gt;\n&lt;hr&gt;\n&lt;p&gt;参考链接：&lt;br&gt;\n&lt;a href=\&#34;https://www.cnblogs.com/Sungeek/p/8257681.html\&#34;&gt;https://www.cnblogs.com/Sungeek/p/8257681.html&lt;/a&gt;&lt;br&gt;\n&lt;a href=\&#34;https://blog.csdn.net/Sun_Hui_/article/details/103178840\&#34;&gt;https://blog.csdn.net/Sun_Hui_/article/details/103178840&lt;/a&gt;&lt;br&gt;\n&lt;a href=\&#34;https://www.itcoder.tech/posts/how-to-setup-a-firewall-with-ufw-on-ubuntu-20-04/\&#34;&gt;https://www.itcoder.tech/posts/how-to-setup-a-firewall-with-ufw-on-ubuntu-20-04/&lt;/a&gt;&lt;/p&gt;\n&#34;,&#34;fileName&#34;:&#34;ubuntu-he-centos-duan-kou-she-zhi&#34;,&#34;abstract&#34;:&#34;&lt;p&gt;记录下端口设置，用到啥记录啥。&lt;/p&gt;\n&#34;,&#34;title&#34;:&#34;Ubuntu和CentOS端口设置&#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;端口&#34;,&#34;slug&#34;:&#34;guNk0JsrG&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/guNk0JsrG/&#34;},{&#34;name&#34;:&#34;port&#34;,&#34;slug&#34;:&#34;nU_jlBkSws&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/nU_jlBkSws/&#34;},{&#34;name&#34;:&#34;ufw&#34;,&#34;slug&#34;:&#34;IBSMukFxes&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/IBSMukFxes/&#34;},{&#34;name&#34;:&#34;firewalld&#34;,&#34;slug&#34;:&#34;M75-gGzjYj&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/M75-gGzjYj/&#34;},{&#34;name&#34;:&#34;firewall-cmd&#34;,&#34;slug&#34;:&#34;3Sy8n-oU5d&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/3Sy8n-oU5d/&#34;},{&#34;name&#34;:&#34;iptables&#34;,&#34;slug&#34;:&#34;OXPcFg0jmJ&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/OXPcFg0jmJ/&#34;},{&#34;name&#34;:&#34;Linux&#34;,&#34;slug&#34;:&#34;mTyB0fhtc&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/mTyB0fhtc/&#34;},{&#34;name&#34;:&#34;Ubuntu&#34;,&#34;slug&#34;:&#34;pelgqi16au&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/pelgqi16au/&#34;},{&#34;name&#34;:&#34;CentOS&#34;,&#34;slug&#34;:&#34;qjvKbAF653&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/qjvKbAF653/&#34;}],&#34;date&#34;:&#34;2020-08-31 17:53:59&#34;,&#34;dateFormat&#34;:&#34;2020-08-31&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://tomhht.github.io/post/ubuntu-he-centos-duan-kou-she-zhi/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;2 min read&#34;,&#34;time&#34;:67000,&#34;words&#34;:236,&#34;minutes&#34;:2},&#34;description&#34;:&#34;记录下端口设置，用到啥记录啥。\n\nCentOS\n核心指令firewall-cmd\n查看已开放端口\nsudo firewall-cmd --list-ports\n\n开启端口\nsudo firewall-cmd --zone=public --...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;&lt;a href=\&#34;#centos\&#34;&gt;CentOS&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%9F%A5%E7%9C%8B%E5%B7%B2%E5%BC%80%E6%94%BE%E7%AB%AF%E5%8F%A3\&#34;&gt;查看已开放端口&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%BC%80%E5%90%AF%E7%AB%AF%E5%8F%A3\&#34;&gt;开启端口&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%85%B3%E9%97%AD%E7%AB%AF%E5%8F%A3\&#34;&gt;关闭端口&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#reload%E4%BB%A5%E4%BE%BF-permanent%E9%85%8D%E7%BD%AE%E7%94%9F%E6%95%88\&#34;&gt;reload以便--permanent配置生效&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#ubuntu\&#34;&gt;Ubuntu&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%90%AF%E7%94%A8ufw\&#34;&gt;启用ufw&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%9F%A5%E7%9C%8B%E5%B7%B2%E5%BC%80%E6%94%BE%E7%AB%AF%E5%8F%A3-2\&#34;&gt;查看已开放端口&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%BC%80%E5%90%AF%E7%AB%AF%E5%8F%A3-2\&#34;&gt;开启端口&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%85%B3%E9%97%AD%E7%AB%AF%E5%8F%A3-2\&#34;&gt;关闭端口&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;p&gt;grub的修改位置和生效方法。&lt;/p&gt;\n&lt;!-- more --&gt;\n&lt;h1 id=\&#34;修改位置\&#34;&gt;修改位置&lt;/h1&gt;\n&lt;pre&gt;&lt;code&gt;sudo vim /etc/default/grub\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h1 id=\&#34;生效方法\&#34;&gt;生效方法&lt;/h1&gt;\n&lt;pre&gt;&lt;code&gt;sudo grub2-mkconfig –o /etc/grub2.cfg  #CentOS\nsudo update-grub2  #Ubuntu\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h1 id=\&#34;troubleshooting\&#34;&gt;Troubleshooting&lt;/h1&gt;\n&lt;h2 id=\&#34;描述\&#34;&gt;描述&lt;/h2&gt;\n&lt;p&gt;CentOS按上面操作修改&lt;code&gt;GRUB_TIMEOUT=0&lt;/code&gt;后，无论怎样都不生效，无法跳过boot menu倒计时5秒的魔咒。尝试过&lt;code&gt;GRUB_TIMEOUT_STYLE=&amp;quot;hidden&amp;quot; GRUB_HIDDEN_TIMEOUT_QUIET=true GRUB_ENABLE_BLSCFG=false&lt;/code&gt;等各种选项，均无效。&lt;code&gt;sudo ls -l /boot/grub2/&lt;/code&gt;查看&lt;code&gt;grub.cfg&lt;/code&gt;，修改时间纹丝未动，合着玩儿呢。&lt;br /&gt;&lt;/p&gt;\n&lt;h2 id=\&#34;解决\&#34;&gt;解决&lt;/h2&gt;\n&lt;p&gt;&lt;code&gt;sudo vim /etc/grub2.cfg&lt;/code&gt;发现：&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt; 63 if [ x$feature_timeout_style = xy ] ; then\n 64   set timeout_style=menu\n 65   set timeout=5\n 66 # Fallback normal timeout code in case the timeout_style feature is\n 67 # unavailable.\n 68 else\n 69   set timeout=5\n 70 fi\n 71 ### END /etc/grub.d/00_header ###\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;感觉问题出在&lt;code&gt;/etc/grub.d/00_header&lt;/code&gt;，研究header半天，没懂😅 &lt;br /&gt;&lt;br&gt;\n而&lt;code&gt;/etc/grub2.cfg&lt;/code&gt;开篇就写着&lt;code&gt;# DO NOT EDIT THIS FILE&lt;/code&gt;，可实在没辙了，试着改了上面65行的timeout，直接改成0：&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;65   set timeout=0\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;保存退出重启，成功了。这都是什么鬼。🙃&lt;/p&gt;\n&lt;hr&gt;\n&lt;p&gt;参考链接：&lt;br&gt;\n&lt;a href=\&#34;https://blog.csdn.net/whatday/article/details/106123164\&#34;&gt;https://blog.csdn.net/whatday/article/details/106123164&lt;/a&gt;&lt;br&gt;\n&lt;a href=\&#34;https://www.techbrown.com/change-default-grub2-entries-timeout-centos-7/\&#34;&gt;https://www.techbrown.com/change-default-grub2-entries-timeout-centos-7/&lt;/a&gt;&lt;/p&gt;\n&#34;,&#34;fileName&#34;:&#34;ubuntu-he-centos-xiu-gai-grub&#34;,&#34;abstract&#34;:&#34;&lt;p&gt;grub的修改位置和生效方法。&lt;/p&gt;\n&#34;,&#34;title&#34;:&#34;Ubuntu和CentOS修改grub&#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;Linux&#34;,&#34;slug&#34;:&#34;mTyB0fhtc&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/mTyB0fhtc/&#34;},{&#34;name&#34;:&#34;Grub&#34;,&#34;slug&#34;:&#34;SaVkQAc9U4&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/SaVkQAc9U4/&#34;},{&#34;name&#34;:&#34;配置&#34;,&#34;slug&#34;:&#34;Bwz1BaTtzi&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/Bwz1BaTtzi/&#34;},{&#34;name&#34;:&#34;开机&#34;,&#34;slug&#34;:&#34;SziKjUrpjt&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/SziKjUrpjt/&#34;},{&#34;name&#34;:&#34;启动项&#34;,&#34;slug&#34;:&#34;rBmg59Vjxj&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/rBmg59Vjxj/&#34;},{&#34;name&#34;:&#34;启动时间&#34;,&#34;slug&#34;:&#34;cWawItHFUb&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/cWawItHFUb/&#34;},{&#34;name&#34;:&#34;Ubuntu&#34;,&#34;slug&#34;:&#34;pelgqi16au&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/pelgqi16au/&#34;},{&#34;name&#34;:&#34;CentOS&#34;,&#34;slug&#34;:&#34;qjvKbAF653&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/qjvKbAF653/&#34;}],&#34;date&#34;:&#34;2020-08-31 11:19:33&#34;,&#34;dateFormat&#34;:&#34;2020-08-31&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://tomhht.github.io/post/ubuntu-he-centos-xiu-gai-grub/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;2 min read&#34;,&#34;time&#34;:72000,&#34;words&#34;:254,&#34;minutes&#34;:2},&#34;description&#34;:&#34;grub的修改位置和生效方法。\n\n修改位置\nsudo vim /etc/default/grub\n\n生效方法\nsudo grub2-mkconfig –o /etc/grub2.cfg  #CentOS\nsudo update-grub2 ...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E4%BF%AE%E6%94%B9%E4%BD%8D%E7%BD%AE\&#34;&gt;修改位置&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E7%94%9F%E6%95%88%E6%96%B9%E6%B3%95\&#34;&gt;生效方法&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#troubleshooting\&#34;&gt;Troubleshooting&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%8F%8F%E8%BF%B0\&#34;&gt;描述&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E8%A7%A3%E5%86%B3\&#34;&gt;解决&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;p&gt;第一次拥有自己的博客，感觉兴奋，折腾了半天，主要是为了自己能有一个记录和吐槽的地方。曾经也在其他网站做过blogger，结果要么关张要么消失要么墙墙，一言难尽。&lt;/p&gt;\n&#34;,&#34;fileName&#34;:&#34;about&#34;,&#34;abstract&#34;:&#34;&#34;,&#34;title&#34;:&#34;关于&#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;关于&#34;,&#34;slug&#34;:&#34;_YTMFN_lm&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/_YTMFN_lm/&#34;},{&#34;name&#34;:&#34;about&#34;,&#34;slug&#34;:&#34;cVh0paDPKo&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/cVh0paDPKo/&#34;}],&#34;date&#34;:&#34;2020-08-28 17:32:03&#34;,&#34;dateFormat&#34;:&#34;2020-08-28&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://tomhht.github.io/post/about/&#34;,&#34;hideInList&#34;:true,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;1 min read&#34;,&#34;time&#34;:13000,&#34;words&#34;:67,&#34;minutes&#34;:1},&#34;description&#34;:&#34;第一次拥有自己的博客，感觉兴奋，折腾了半天，主要是为了自己能有一个记录和吐槽的地方。曾经也在其他网站做过blogger，结果要么关张要么消失要么墙墙，一言难尽。\n&#34;,&#34;toc&#34;:&#34;&#34;},{&#34;content&#34;:&#34;&lt;p&gt;本文主要是踩坑后想记录下避坑方法，内容涉及Kubernetes, Kubeadm, Kubectl, Kubelet, Ubuntu, CentOS, Flannel, Docker, 阿里云。&lt;/p&gt;\n&lt;!-- more --&gt;\n&lt;h1 id=\&#34;写作背景\&#34;&gt;写作背景&lt;/h1&gt;\n&lt;p&gt;初学Kubernetes，虽然网上资源很多，但没一个能彻底搞定，于是杂烩一下。&lt;/p&gt;\n&lt;h1 id=\&#34;安装前的准备工作\&#34;&gt;安装前的准备工作&lt;/h1&gt;\n&lt;blockquote&gt;\n&lt;p&gt;control node（控制节点）、worker node（工作节点） 都要做这些准备工作。&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h2 id=\&#34;检查各主机配置\&#34;&gt;检查各主机配置&lt;/h2&gt;\n&lt;h3 id=\&#34;检查cpu和内存\&#34;&gt;检查cpu和内存&lt;/h3&gt;\n&lt;p&gt;无论是虚拟机还是物理机，都要求&lt;strong&gt;cpu内核≥2，内存≥2G&lt;/strong&gt;。&lt;/p&gt;\n&lt;h3 id=\&#34;检查主机名hostname\&#34;&gt;检查主机名hostname&lt;/h3&gt;\n&lt;p&gt;hostname要求&lt;strong&gt;不能是 localhost，且不包含下划线、小数点、大写字母&lt;/strong&gt;。&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;# 检查hostname\nhostname \n# 修改 hostname\nhostnamectl set-hostname 名字\n# 查看修改结果\nhostnamectl status\n# 设置 hostname 解析\necho &amp;quot;127.0.0.1   $(hostname)&amp;quot; &amp;gt;&amp;gt; /etc/hosts\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;设置固定ip\&#34;&gt;设置固定IP&lt;/h3&gt;\n&lt;p&gt;建议使用nmcli配置，因为跨平台（Ubuntu和CentOS）。&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;nmcli\n//如果提示没有安装，先按下面步骤安装\n# 安装nmcli\nsudo yum install NetworkManager #CentOS\nsudo apt-get install network-manager #Ubuntu\n# 检查nmcli是否接管了网络管理\nnmcli g\n//正常是显示绿色的信息。如果STATE列显示disconnected，则Ubuntu要修改/etc/netplan/里的yaml文件，在version下面添加一行renderer: NetworkManager，保存退出后执行sudo systemctl daemon-reload 和 sudo systemctl restart NetworkManager\n# 查看当前默认网卡和ip信息\nip route show\nip a\n//ip route show 命令中，可以知道机器的网关DNS和默认网卡，如 default via 192.168.127.2 dev ens33，via后面的内容 192.168.127.2 就是网关和DNS，dev后面的内容 ens33 就是默认网卡\n//ip a 命令中，可显示默认网卡的 IP 地址，Kubernetes 将使用此 IP 地址与集群内的其他节点通信，如192.168.127.131\n//所有节点上 Kubernetes 所使用的 IP 地址必须可以互通（无需 NAT 映射、无安全组或防火墙隔离）\n# 设置固定IP，网卡、ip地址、网关、DNS可参考上面的信息\nsudo nmcli c mod ens33 \\\nipv4.addresses 192.168.127.131/24 \\\nipv4.method manual \\\nipv4.gateway 192.168.127.2 \\\nipv4.dns 192.168.127.2\n# 让配置立刻生效\nsudo nmcli c up ens33\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;设置iptables\&#34;&gt;设置iptables&lt;/h2&gt;\n&lt;p&gt;执行下面代码：&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;sudo modprobe br_netfilter\ncat &amp;lt;&amp;lt;EOF | sudo tee /etc/sysctl.d/k8s.conf\nnet.bridge.bridge-nf-call-ip6tables = 1\nnet.bridge.bridge-nf-call-iptables = 1\nEOF\nsudo sysctl --system\n# 如果想检查配置，可执行\nsysctl -n net.bridge.bridge-nf-call-iptables\nsysctl -n net.bridge.bridge-nf-call-ip6tables\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;打开端口\&#34;&gt;打开端口&lt;/h2&gt;\n&lt;h3 id=\&#34;ubuntu的准备工作\&#34;&gt;Ubuntu的准备工作&lt;/h3&gt;\n&lt;p&gt;先打开Ubuntu自带的防火墙ufw。执行下面代码：&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;sudo ufw enable\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;执行后提示可能断开连接，直接y继续，别担心，ssh连接不会断。&lt;br&gt;\n如果使用ssh连接，还需要执行下面代码，以便打开ssh连接：&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;sudo ufw allow ssh\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;打开相应端口\&#34;&gt;打开相应端口&lt;/h3&gt;\n&lt;p&gt;依据所使用的系统（Ubuntu / CentOS），执行相应代码。&lt;/p&gt;\n&lt;ol&gt;\n&lt;li&gt;控制节点 Control-plane nodes&lt;/li&gt;\n&lt;/ol&gt;\n&lt;pre&gt;&lt;code&gt;# Ubuntu\nsudo ufw allow 6443/tcp\nsudo ufw allow 2379:2380/tcp\nsudo ufw allow 10250:10252/tcp\nsudo ufw allow 8472/udp #for flannel。如果不开，则coredns无法为worker nodes服务\n//上面代码中的冒号代表端口区间。\n\n# CentOS\nsudo firewall-cmd --zone=public --add-port=6443/tcp --permanent\nsudo firewall-cmd --zone=public --add-port=2379-2380/tcp --permanent\nsudo firewall-cmd --zone=public --add-port=10250-10252/tcp --permanent\nsudo firewall-cmd --zone=public --add-port=8472/udp --permanent #for flannel。如果不开，则coredns无法为worker nodes服务\nsudo firewall-cmd --add-masquerade --permanent #for flannel NAT\nsudo firewall-cmd --reload\nsudo firewall-cmd --list-ports //查看设置效果\n&lt;/code&gt;&lt;/pre&gt;\n&lt;ol start=\&#34;2\&#34;&gt;\n&lt;li&gt;工作节点 Worker nodes&lt;/li&gt;\n&lt;/ol&gt;\n&lt;pre&gt;&lt;code&gt;# Ubuntu\nsudo ufw allow 10250/tcp\nsudo ufw allow 30000:32767/tcp\nsudo ufw allow 8472/udp #for flannel\n\n# CentOS\nsudo firewall-cmd --zone=public --add-port=10250/tcp --permanent\nsudo firewall-cmd --zone=public --add-port=30000-32767/tcp --permanent\nsudo firewall-cmd --zone=public --add-port=8472/udp --permanent #for flannel\nsudo firewall-cmd --add-masquerade --permanent #for flannel NAT\nsudo firewall-cmd --reload\nsudo firewall-cmd --list-ports //查看设置效果\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;禁用swap\&#34;&gt;禁用swap&lt;/h2&gt;\n&lt;p&gt;由于swap性能低下，Kubeadm默认要求禁止使用swap。执行如下代码：&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;sudo swapoff -a  #临时禁用swap\nsudo sed -i &#39;s/.*swap.*/#&amp;amp;/&#39; /etc/fstab  #永久禁用swap\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;可通过&lt;code&gt;free -m&lt;/code&gt;来检查禁用效果。&lt;/p&gt;\n&lt;h2 id=\&#34;安装docker\&#34;&gt;安装docker&lt;/h2&gt;\n&lt;p&gt;详见&lt;a href=\&#34;/post/zai-centos-he-ubuntu-shang-an-zhuang-he-pei-zhi-docker\&#34;&gt;docker安装和配置&lt;/a&gt;&lt;/p&gt;\n&lt;h2 id=\&#34;创建k8s文件夹\&#34;&gt;创建k8s文件夹&lt;/h2&gt;\n&lt;p&gt;可用来存放相关文件。执行下面代码：&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;mkdir ~/k8s\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h1 id=\&#34;安装kubeadm-kubelet和kubectl\&#34;&gt;安装kubeadm, kubelet和kubectl&lt;/h1&gt;\n&lt;blockquote&gt;\n&lt;p&gt;control node（控制节点）、worker node（工作节点） 上都安装。&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;p&gt;&lt;strong&gt;Ubuntu&lt;/strong&gt;&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;sudo apt-get update &amp;amp;&amp;amp; sudo apt-get install -y apt-transport-https curl\ncurl -s https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg | sudo apt-key add -\ncat &amp;lt;&amp;lt;EOF | sudo tee /etc/apt/sources.list.d/kubernetes.list\ndeb https://mirrors.aliyun.com/kubernetes/apt kubernetes-xenial main\nEOF\nsudo apt-get update\nsudo apt-get install -y kubelet kubeadm kubectl\nsudo apt-mark hold kubelet kubeadm kubectl\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;strong&gt;CentOS&lt;/strong&gt;&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;cat &amp;lt;&amp;lt;EOF | sudo tee /etc/yum.repos.d/kubernetes.repo\n[kubernetes]\nname=Kubernetes\nbaseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/\nenabled=1\ngpgcheck=0\nrepo_gpgcheck=0\ngpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg\nexclude=kubelet kubeadm kubectl\nEOF\n\n# Set SELinux in permissive mode (effectively disabling it)\nsudo setenforce 0\nsudo sed -i &#39;s/^SELINUX=enforcing$/SELINUX=permissive/&#39; /etc/selinux/config\n\nsudo yum install -y kubelet kubeadm kubectl --disableexcludes=kubernetes\n\nsudo systemctl enable --now kubelet\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h1 id=\&#34;在control-node控制节点上用kubeadm创建集群\&#34;&gt;在control node控制节点上用kubeadm创建集群&lt;/h1&gt;\n&lt;h2 id=\&#34;初始化集群\&#34;&gt;初始化集群&lt;/h2&gt;\n&lt;!-- - 方法一（推荐，能成功就很幸运）--&gt;\n&lt;pre&gt;&lt;code&gt;sudo kubeadm init --apiserver-advertise-address=你的本机IP \\\n--pod-network-cidr=10.244.0.0/16 \\\n--kubernetes-version=v1.19.0 \\\n--image-repository=registry.cn-hangzhou.aliyuncs.com/google_containers\n...\n...\nkubeadm join 192.168.127.132:6443 --token 4pwz11.1m0u1k3ak3ibgx08 \\\n    --discovery-token-ca-cert-hash sha256:671404c4f80afe5d06d8eefcd5acc6049c4d84f1ebf1091b09bc180ea44e79b7   \n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;将输出内容中的&lt;code&gt;kubeadm join ...&lt;/code&gt;记录下来，这是其他节点加入主节点的信息。&lt;/p&gt;\n&lt;!-- 如果安装失败，再试几次，还不行就尝试方法二。\n如果安装成功，则输出类似下面内容，将内容中的`kubeadm join ...`单独保存出来，这是其他节点加入主节点的信息。跳过方法二。\n如果安装顺利，&lt;a href=\&#34;#%E8%B5%8B%E4%BA%88%E5%BD%93%E5%89%8D%E7%94%A8%E6%88%B7%E4%BD%BF%E7%94%A8kubectl%E7%9A%84%E6%9D%83%E9%99%90\&#34;&gt;点这里跳过方法二&lt;/a&gt;。\n## 初始化集群 - 方法二（只在方法一失败的情况下使用）\n由于种种原因，国内无法从k8s.gcr.io下载到kubeadm部署所需的文件，以下方法将通过阿里云获取。\n### 准备工作\n#### 查看所需镜像\n```\nkubeadm config images list\n#下面是执行的结果\nk8s.gcr.io/kube-apiserver:v1.18.8\nk8s.gcr.io/kube-controller-manager:v1.18.8\nk8s.gcr.io/kube-scheduler:v1.18.8\nk8s.gcr.io/kube-proxy:v1.18.8\nk8s.gcr.io/pause:3.2\nk8s.gcr.io/etcd:3.4.3-0\nk8s.gcr.io/coredns:1.6.7\n```\n#### 在阿里云控制台找到所需镜像\n1. [https://cr.console.aliyun.com/](https://cr.console.aliyun.com/)  左侧点”镜像搜索“\n2. 分别搜索”kube-apiserver“等所有名称，点开搜索到的镜像，一定找到正确的版本号（如v1.18.8）（日期越新的越容易找到），复制页面中的”公网地址“\n#### pull镜像、打标签、移除无用镜像\n1. pull镜像\n```\nKUBE_VERSION=v1.18.8\nPAUSE_VERSION=3.2\nETCD_VERSION=3.4.3-0\nCORE_DNS_VERSION=1.6.7\ndocker pull registry.cn-hangzhou.aliyuncs.com/wyc_google_containers/kube-apiserver:$KUBE_VERSION\ndocker pull registry.cn-hangzhou.aliyuncs.com/wyc_google_containers/kube-controller-manager:$KUBE_VERSION\ndocker pull registry.cn-hangzhou.aliyuncs.com/wyc_google_containers/kube-scheduler:$KUBE_VERSION\ndocker pull registry.cn-hangzhou.aliyuncs.com/wyc_google_containers/kube-proxy:$KUBE_VERSION\ndocker pull registry.cn-hangzhou.aliyuncs.com/google_containers/pause:$PAUSE_VERSION\ndocker pull registry.cn-hangzhou.aliyuncs.com/google_containers/coredns:$CORE_DNS_VERSION\ndocker pull registry.cn-hangzhou.aliyuncs.com/google_containers/etcd:$ETCD_VERSION\n```\n2. 给pull下来的镜像打标签\n因为kubeadm部署时会找k8s.gcr.io标签的镜像，因此需要将上一步pull的镜像打上k8s.gcr.io标签。\n```\ndocker tag registry.cn-hangzhou.aliyuncs.com/wyc_google_containers/kube-apiserver:$KUBE_VERSION  k8s.gcr.io/kube-proxy:$KUBE_VERSION\ndocker tag registry.cn-hangzhou.aliyuncs.com/wyc_google_containers/kube-apiserver:$KUBE_VERSION k8s.gcr.io/kube-controller-manager:$KUBE_VERSION\ndocker tag registry.cn-hangzhou.aliyuncs.com/wyc_google_containers/kube-apiserver:$KUBE_VERSION k8s.gcr.io/kube-apiserver:$KUBE_VERSION\ndocker tag registry.cn-hangzhou.aliyuncs.com/wyc_google_containers/kube-apiserver:$KUBE_VERSION k8s.gcr.io/kube-scheduler:$KUBE_VERSION\ndocker tag registry.cn-hangzhou.aliyuncs.com/google_containers/pause:$PAUSE_VERSION k8s.gcr.io/pause:$PAUSE_VERSION\ndocker tag registry.cn-hangzhou.aliyuncs.com/google_containers/coredns:$CORE_DNS_VERSION k8s.gcr.io/coredns:$CORE_DNS_VERSION\ndocker tag registry.cn-hangzhou.aliyuncs.com/google_containers/etcd:$ETCD_VERSION k8s.gcr.io/etcd:$ETCD_VERSION\n```\n3. 移除从阿里云pull下来的镜像\n```\ndocker rmi registry.cn-hangzhou.aliyuncs.com/wyc_google_containers/kube-apiserver:$KUBE_VERSION\ndocker rmi registry.cn-hangzhou.aliyuncs.com/wyc_google_containers/kube-controller-manager:$KUBE_VERSION\ndocker rmi registry.cn-hangzhou.aliyuncs.com/wyc_google_containers/kube-scheduler:$KUBE_VERSION\ndocker rmi registry.cn-hangzhou.aliyuncs.com/wyc_google_containers/kube-proxy:$KUBE_VERSION\ndocker rmi registry.cn-hangzhou.aliyuncs.com/google_containers/pause:$PAUSE_VERSION\ndocker rmi registry.cn-hangzhou.aliyuncs.com/google_containers/coredns:$CORE_DNS_VERSION\ndocker rmi registry.cn-hangzhou.aliyuncs.com/google_containers/etcd:$ETCD_VERSION\n``` \n### 部署\n```\nsudo kubeadm init --apiserver-advertise-address=你的本机IP --pod-network-cidr=10.244.0.0/16  --kubernetes-version=v1.19.0\n#执行后的输出\n...\n...\nkubeadm join 192.168.127.132:6443 --token 4pwz11.1m0u1k3ak3ibgx08 \\\n    --discovery-token-ca-cert-hash sha256:671404c4f80afe5d06d8eefcd5acc6049c4d84f1ebf1091b09bc180ea44e79b7\n```--&gt;\n&lt;h2 id=\&#34;赋予当前用户使用kubectl的权限\&#34;&gt;赋予当前用户使用kubectl的权限&lt;/h2&gt;\n&lt;pre&gt;&lt;code&gt;mkdir -p $HOME/.kube\nsudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\nsudo chown $(id -u):$(id -g) $HOME/.kube/config\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;安装网络组件flannel\&#34;&gt;安装网络组件flannel&lt;/h2&gt;\n&lt;h3 id=\&#34;准备工作\&#34;&gt;准备工作&lt;/h3&gt;\n&lt;p&gt;由于种种原因，无法直接pull到网络组件flannel的docker镜像，因此需单独下载。&lt;br&gt;\nhttps://github.com/coreos/flannel/releases/download/v0.12.0/flanneld-v0.12.0-amd64.docker&lt;br&gt;\n下载后放进&lt;code&gt;~/k8s&lt;/code&gt;，执行命令：&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;cd ~/k8s\ndocker load &amp;lt; flanneld-v0.12.0-amd64.docker\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;开始安装\&#34;&gt;开始安装&lt;/h3&gt;\n&lt;pre&gt;&lt;code&gt;wget https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml\nkubectl apply -f kube-flannel.yml\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;检查部署情况\&#34;&gt;检查部署情况&lt;/h2&gt;\n&lt;pre&gt;&lt;code&gt;kubectl get nodes\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;img src=\&#34;https://tomhht.github.io/post-images/1598781753839.png\&#34; alt=\&#34;节点运行情况\&#34; loading=\&#34;lazy\&#34;&gt;     &lt;br /&gt;&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;kubectl get pods -A\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;img src=\&#34;https://tomhht.github.io/post-images/1598781791291.png\&#34; alt=\&#34;Pods运行情况\&#34; loading=\&#34;lazy\&#34;&gt;&lt;br&gt;\n通过&lt;code&gt;docker container ls&lt;/code&gt;也可以看到pods里的容器运行情况。&lt;/p&gt;\n&lt;h2 id=\&#34;打开kubectl和kubeadm的自动补全功能\&#34;&gt;打开kubectl和kubeadm的自动补全功能&lt;/h2&gt;\n&lt;pre&gt;&lt;code&gt;echo &#39;source &amp;lt;(kubectl completion bash)&#39; &amp;gt;&amp;gt;~/.bashrc\necho &#39;source &amp;lt;(kubeadm completion bash)&#39; &amp;gt;&amp;gt;~/.bashrc\nsource ~/.bashrc #使配置立刻生效\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;以上为control node控制节点的部署全流程。&lt;/p&gt;\n&lt;hr&gt;\n&lt;h1 id=\&#34;worker-node工作节点加入集群\&#34;&gt;worker node工作节点加入集群&lt;/h1&gt;\n&lt;blockquote&gt;\n&lt;p&gt;确认在worker node主机上已安装了kubeadm, kubelet和kubectl。&lt;br&gt;\n如未安装，参考&lt;a href=\&#34;#安装kubeadm-kubelet和kubectl\&#34;&gt;安装kubeadm, kubelet和kubectl&lt;/a&gt;。&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h2 id=\&#34;安装网络组件flannel-2\&#34;&gt;安装网络组件flannel&lt;/h2&gt;\n&lt;ol&gt;\n&lt;li&gt;在&lt;strong&gt;control node&lt;/strong&gt;上导出flannel的docker镜像，并复制到worker node：&lt;/li&gt;\n&lt;/ol&gt;\n&lt;blockquote&gt;\n&lt;p&gt;提醒：~/k8s目录在各node上都提前建好&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;pre&gt;&lt;code&gt;docker save quay.io/coreos/flannel:v0.12.0 &amp;gt; ~/k8s/flannel-v0.12.0.tar\nscp ~k8s/flannel-v0.12.0.tar tom@192.168.127.133:~/k8s\n&lt;/code&gt;&lt;/pre&gt;\n&lt;ol start=\&#34;2\&#34;&gt;\n&lt;li&gt;在&lt;strong&gt;worker node&lt;/strong&gt;上导入flannel的docker镜像：&lt;/li&gt;\n&lt;/ol&gt;\n&lt;pre&gt;&lt;code&gt;docker load &amp;lt; k8s/flannel-v0.12.0.tar\n&lt;/code&gt;&lt;/pre&gt;\n&lt;!-- ## 载入control  node上pull好的镜像\n1. 在control node上，备份出全套docker镜像（含kubeadm所需镜像+网络组件flannel镜像）：\n```\ncd ~/k8s\ndocker save k8s.gcr.io/kube-proxy:v1.18.8 \\\nk8s.gcr.io/kube-apiserver:v1.18.8 \\\nk8s.gcr.io/kube-controller-manager:v1.18.8 \\\nk8s.gcr.io/kube-scheduler:v1.18.8 \\\nk8s.gcr.io/pause:3.2 \\\nk8s.gcr.io/coredns:1.6.7 \\\nk8s.gcr.io/etcd:3.4.3-0 \\\nquay.io/coreos/flannel:v0.12.0-amd64 &gt; k8s-imagesV1.18.8-flannelV0.12.0.tar\n```\n&gt; 之前踩坑，偷懒用IMAGE ID做的备份，结果载入以后name和tag全都是none，还得打name和tag上去，无比繁琐- _ -||\n2. scp上面的备份文件到各个worker node的`~/k8s`文件夹里\n3. 在worker node上载入备份文件：\n```\ncd ~/k8s\ndocker load &lt; k8s-imagesV1.18.8-flannelV0.12.0.tar\n```\n&gt; worker node实际需要的只有3个镜像，分别是`kube-proxy, pause, flannel`--&gt;\n&lt;h2 id=\&#34;加入集群\&#34;&gt;加入集群&lt;/h2&gt;\n&lt;p&gt;在worker node上，执行之前记录的&lt;code&gt;kubeadm join...&lt;/code&gt;代码，类似于：&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;sudo kubeadm join 192.168.127.132:6443 --token rddtz5.mz2v4ee96177eay5     --discovery-token-ca-cert-hash sha256:671404c4f80afe5d06d8eefcd5acc6049c4d84f1ebf1091b09bc180ea44e79b7\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;如果join指令没记录下来，或者集群创建已经超过24小时了，那么需要重新生成join指令。在&lt;strong&gt;control node&lt;/strong&gt;上执行：&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;kubeadm token create --print-join-command\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;复制输出的内容并在&lt;strong&gt;worker node&lt;/strong&gt;上执行即可加入。&lt;/p&gt;\n&lt;hr&gt;\n&lt;h1 id=\&#34;检查部署结果\&#34;&gt;检查部署结果&lt;/h1&gt;\n&lt;p&gt;在control node上执行：&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;kubectl get nodes -o wide\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;img src=\&#34;https://tomhht.github.io/post-images/1599032788153.png\&#34; alt=\&#34;集群节点信息\&#34; loading=\&#34;lazy\&#34;&gt; &lt;br /&gt;&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;kubectl get pods -A -o wide\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;img src=\&#34;https://tomhht.github.io/post-images/1599032818248.png\&#34; alt=\&#34;集群pods信息\&#34; loading=\&#34;lazy\&#34;&gt;&lt;br&gt;\n如果STATUS不是Running，则排查故障点：&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;kubectl describe pods -n kube-system kube-proxy-t2zbw\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h1 id=\&#34;troubleshooting\&#34;&gt;Troubleshooting&lt;/h1&gt;\n&lt;h2 id=\&#34;pull-image失败\&#34;&gt;pull image失败&lt;/h2&gt;\n&lt;p&gt;如果&lt;code&gt;kubectl get pods -n kube-system -o wide&lt;/code&gt;发现某个pods还没ready，而docker也已经配置了国内加速器，那么试着重启docker一下。&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;sudo systemctl restart docker.service\n&lt;/code&gt;&lt;/pre&gt;\n&lt;hr&gt;\n&lt;p&gt;参考链接：&lt;br&gt;\n&lt;a href=\&#34;https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/\&#34;&gt;https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/&lt;/a&gt;&lt;br&gt;\n&lt;a href=\&#34;https://www.cnblogs.com/hellxz/p/use-kubeadm-init-kubernetes-cluster.html\&#34;&gt;https://www.cnblogs.com/hellxz/p/use-kubeadm-init-kubernetes-cluster.html&lt;/a&gt;&lt;br&gt;\n&lt;a href=\&#34;https://www.kuboard.cn/install/install-k8s.html\&#34;&gt;https://www.kuboard.cn/install/install-k8s.html&lt;/a&gt;&lt;br&gt;\n&lt;a href=\&#34;https://blog.csdn.net/LeonardoYasuo/article/details/101483438\&#34;&gt;https://blog.csdn.net/LeonardoYasuo/article/details/101483438&lt;/a&gt;&lt;br&gt;\n&lt;a href=\&#34;https://www.cnblogs.com/yinzhengjie/p/12258215.html\&#34;&gt;https://www.cnblogs.com/yinzhengjie/p/12258215.html&lt;/a&gt;&lt;br&gt;\n&lt;a href=\&#34;https://developer.aliyun.com/article/763983\&#34;&gt;https://developer.aliyun.com/article/763983&lt;/a&gt;&lt;/p&gt;\n&#34;,&#34;fileName&#34;:&#34;zai-ubuntu-2004-shang-shi-yong-kubeadm-bu-shu-kubernetes-ji-qun&#34;,&#34;abstract&#34;:&#34;&lt;p&gt;本文主要是踩坑后想记录下避坑方法，内容涉及Kubernetes, Kubeadm, Kubectl, Kubelet, Ubuntu, CentOS, Flannel, Docker, 阿里云。&lt;/p&gt;\n&#34;,&#34;title&#34;:&#34;在Ubuntu 20.04和CentOS 8上使用kubeadm部署Kubernetes集群&#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;Kubernetes&#34;,&#34;slug&#34;:&#34;2myAgZVX1&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/2myAgZVX1/&#34;},{&#34;name&#34;:&#34;Kubeadm&#34;,&#34;slug&#34;:&#34;o7K32AxyIA&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/o7K32AxyIA/&#34;},{&#34;name&#34;:&#34;Kubectl&#34;,&#34;slug&#34;:&#34;xGRD-5em-T&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/xGRD-5em-T/&#34;},{&#34;name&#34;:&#34;Kubelet&#34;,&#34;slug&#34;:&#34;et2DIyRaOM&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/et2DIyRaOM/&#34;},{&#34;name&#34;:&#34;Ubuntu&#34;,&#34;slug&#34;:&#34;pelgqi16au&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/pelgqi16au/&#34;},{&#34;name&#34;:&#34;CentOS&#34;,&#34;slug&#34;:&#34;qjvKbAF653&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/qjvKbAF653/&#34;},{&#34;name&#34;:&#34;Flannel&#34;,&#34;slug&#34;:&#34;2W4Ff5s-rE&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/2W4Ff5s-rE/&#34;},{&#34;name&#34;:&#34;Docker&#34;,&#34;slug&#34;:&#34;RkYw1lQ_qY&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/RkYw1lQ_qY/&#34;},{&#34;name&#34;:&#34;Aliyun&#34;,&#34;slug&#34;:&#34;LQERLoeDmq&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/LQERLoeDmq/&#34;},{&#34;name&#34;:&#34;阿里云&#34;,&#34;slug&#34;:&#34;CDrtFP3hgt&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/CDrtFP3hgt/&#34;}],&#34;date&#34;:&#34;2020-08-27 18:40:02&#34;,&#34;dateFormat&#34;:&#34;2020-08-27&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://tomhht.github.io/post/zai-ubuntu-2004-shang-shi-yong-kubeadm-bu-shu-kubernetes-ji-qun/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;9 min read&#34;,&#34;time&#34;:534000,&#34;words&#34;:1871,&#34;minutes&#34;:9},&#34;description&#34;:&#34;本文主要是踩坑后想记录下避坑方法，内容涉及Kubernetes, Kubeadm, Kubectl, Kubelet, Ubuntu, CentOS, Flannel, Docker, 阿里云。\n\n写作背景\n初学Kubernetes，虽然网...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%86%99%E4%BD%9C%E8%83%8C%E6%99%AF\&#34;&gt;写作背景&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%AE%89%E8%A3%85%E5%89%8D%E7%9A%84%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C\&#34;&gt;安装前的准备工作&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%A3%80%E6%9F%A5%E5%90%84%E4%B8%BB%E6%9C%BA%E9%85%8D%E7%BD%AE\&#34;&gt;检查各主机配置&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%A3%80%E6%9F%A5cpu%E5%92%8C%E5%86%85%E5%AD%98\&#34;&gt;检查cpu和内存&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%A3%80%E6%9F%A5%E4%B8%BB%E6%9C%BA%E5%90%8Dhostname\&#34;&gt;检查主机名hostname&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E8%AE%BE%E7%BD%AE%E5%9B%BA%E5%AE%9Aip\&#34;&gt;设置固定IP&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E8%AE%BE%E7%BD%AEiptables\&#34;&gt;设置iptables&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%89%93%E5%BC%80%E7%AB%AF%E5%8F%A3\&#34;&gt;打开端口&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#ubuntu%E7%9A%84%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C\&#34;&gt;Ubuntu的准备工作&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%89%93%E5%BC%80%E7%9B%B8%E5%BA%94%E7%AB%AF%E5%8F%A3\&#34;&gt;打开相应端口&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E7%A6%81%E7%94%A8swap\&#34;&gt;禁用swap&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%AE%89%E8%A3%85docker\&#34;&gt;安装docker&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%88%9B%E5%BB%BAk8s%E6%96%87%E4%BB%B6%E5%A4%B9\&#34;&gt;创建k8s文件夹&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%AE%89%E8%A3%85kubeadm-kubelet%E5%92%8Ckubectl\&#34;&gt;安装kubeadm, kubelet和kubectl&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%9C%A8control-node%E6%8E%A7%E5%88%B6%E8%8A%82%E7%82%B9%E4%B8%8A%E7%94%A8kubeadm%E5%88%9B%E5%BB%BA%E9%9B%86%E7%BE%A4\&#34;&gt;在control node控制节点上用kubeadm创建集群&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%88%9D%E5%A7%8B%E5%8C%96%E9%9B%86%E7%BE%A4\&#34;&gt;初始化集群&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E8%B5%8B%E4%BA%88%E5%BD%93%E5%89%8D%E7%94%A8%E6%88%B7%E4%BD%BF%E7%94%A8kubectl%E7%9A%84%E6%9D%83%E9%99%90\&#34;&gt;赋予当前用户使用kubectl的权限&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%AE%89%E8%A3%85%E7%BD%91%E7%BB%9C%E7%BB%84%E4%BB%B6flannel\&#34;&gt;安装网络组件flannel&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C\&#34;&gt;准备工作&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%BC%80%E5%A7%8B%E5%AE%89%E8%A3%85\&#34;&gt;开始安装&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%A3%80%E6%9F%A5%E9%83%A8%E7%BD%B2%E6%83%85%E5%86%B5\&#34;&gt;检查部署情况&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%89%93%E5%BC%80kubectl%E5%92%8Ckubeadm%E7%9A%84%E8%87%AA%E5%8A%A8%E8%A1%A5%E5%85%A8%E5%8A%9F%E8%83%BD\&#34;&gt;打开kubectl和kubeadm的自动补全功能&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#worker-node%E5%B7%A5%E4%BD%9C%E8%8A%82%E7%82%B9%E5%8A%A0%E5%85%A5%E9%9B%86%E7%BE%A4\&#34;&gt;worker node工作节点加入集群&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%AE%89%E8%A3%85%E7%BD%91%E7%BB%9C%E7%BB%84%E4%BB%B6flannel-2\&#34;&gt;安装网络组件flannel&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%8A%A0%E5%85%A5%E9%9B%86%E7%BE%A4\&#34;&gt;加入集群&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%A3%80%E6%9F%A5%E9%83%A8%E7%BD%B2%E7%BB%93%E6%9E%9C\&#34;&gt;检查部署结果&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#troubleshooting\&#34;&gt;Troubleshooting&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#pull-image%E5%A4%B1%E8%B4%A5\&#34;&gt;pull image失败&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;}]";
  // var json = escape.substr(1, escape.length - 2);
  // var datas = json.split(',');
  // for (let i=0; i < datas.length; i++) {
  //   let item = datas[i];
  //   let attrs = item.split('34;:&#34')
  //   debugger
  //   console.log(datas[i])
  // }
  let escapeMap = new Map();
  escapeMap.set('&#34;', '"');
  escapeMap.set('&gt;', '>');
  escapeMap.set('&#39;', "'");
  escapeMap.set('&lt;', '<');
  escapeMap.set('&quot;', '"');
  escapeMap.set('&amp;', '&');
</script> -->



</html>