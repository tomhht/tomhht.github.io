<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="keywords" content="GitHub, IT, ICT, 大数据, Linux, Ubuntu, CentOS, 云计算, 机器学习, 深度学习, Kubernetes, Docker, OpenStack">
<meta name="description" content="">
<meta name="theme-color" content="#000">
<title>hello, world</title>
<link rel="shortcut icon" href="/favicon.ico?v=1599048199649">
<link rel="stylesheet" href="/styles/main.css">
<link rel="stylesheet" href="/media/css/mist.css">

<link rel="stylesheet" href="/media/fonts/font-awesome.css">
<link
  href="//fonts.googleapis.com/css?family=Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Rosario:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext"
  rel="stylesheet" type="text/css">

<link href="/media/hljs/styles/androidstudio.css"
  rel="stylesheet">

<script src="/media/hljs/highlight.js"></script>
<script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.0/velocity.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.0/velocity.ui.min.js"></script>

<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>



</head>

<body>
  <div class="head-top-line"></div>
  <div class="header-box">
    
<div class="mist">
  <header class="header bg-color ">
    <div class="blog-header box-shadow-wrapper  " id="header">
      <div class="nav-toggle" id="nav_toggle">
        <div class="toggle-box">
          <div class="line line-top"></div>
          <div class="line line-center"></div>
          <div class="line line-bottom"></div>
        </div>
      </div>
      <div class="site-meta">       
        <div class="site-title">
          
            <a href="/" class="">
              <span class="logo-line-before">
                <i class=""></i>
              </span>
              <span class="main-title">hello, world</span>
              <span class="logo-line-after">
                <i class=""></i>
              </span>
            </a>  
          
        </div>
        
      </div>
      <nav class="site-nav" id="site_nav">
        <ul id="nav_ul">
          
            
            
            <li class="nav-item ">
              
              
                <a href="/" target="_self">
                  <i class="fa fa-home"></i> 首页
                </a>
              
            </li>
          
            
            
            <li class="nav-item ">
              
              
                <a href="/archives/" target="_self">
                  <i class="fa fa-archive"></i> 归档
                </a>
              
            </li>
          
            
            
            <li class="nav-item ">
              
              
                <a href="/tags/" target="_self">
                  <i class="fa fa-tags"></i> 标签
                </a>
              
            </li>
          
            
            
            <li class="nav-item ">
              
              
                <a href="/post/about/" target="_self">
                  <i class="fa fa-user"></i> 关于
                </a>
              
            </li>
          
          
        </ul>
      </nav>
    </div>
  </header>
</div>

<script type="text/javascript"> 
 
  let showNav = true;

  let navToggle = document.querySelector('#nav_toggle'),
  siteNav = document.querySelector('#site_nav');
  
  function navClick() {
    let sideBar = document.querySelector('.sidebar');
    let navUl = document.querySelector('#nav_ul');
    navToggle.classList.toggle('nav-toggle-active');
    siteNav.classList.toggle('nav-menu-active');
    if (siteNav.classList.contains('nav-menu-active')) {
      siteNav.style = "height: " + (navUl.children.length * 42) +"px !important";
    } else {
      siteNav.style = "";
    }
  }

  navToggle.addEventListener('click',navClick);  
</script>
  </div>
  <div class="main-continer">
    
    <div
      class="section-layout bg-color mist">
      <div class="section-layout-wrapper">
        <div id="sidebarMeta" class="sidebar">
    
<div class="sidebar-wrapper box-shadow-wrapper ">
  <div class="sidebar-item">
    <img class="site-author-image right-motion" src="/images/avatar.png"/>
    <p class="site-author-name">Tom</p>
    
    <div class="site-description right-motion">
      
      
      
        <p>第一次有自己的博客</p>
      
      
    </div>
    
  </div>
  <div class="sidebar-item side-item-stat right-motion">
    <div class="sidebar-item-box">
      <a href="/archives/">
        
        <span class="site-item-stat-count">6</span>
        <span class="site-item-stat-name">文章</span>
      </a>
    </div>
    <div class="sidebar-item-box">
      <a href="">
        <span class="site-item-stat-count">29</span>
        <span class="site-item-stat-name">分类</span>
      </a>
    </div>
    <div class="sidebar-item-box">
      <a href="/tags/">
        <span class="site-item-stat-count">29</span>
        <span class="site-item-stat-name">标签</span>
      </a>
    </div>
  </div>
  
  

  


</div>
</div>
<script>
  let sidebarMeta = document.querySelector('#sidebarMeta');
  let scheme = 'mist';
  let sidebarWrapper = document.querySelector('.sidebar-wrapper');
  if (sidebarMeta && (scheme === 'pisces' || scheme === 'gemini')) {
    document.addEventListener('scroll', function(e) {
      if (document.scrollingElement.scrollTop > parseInt(sidebarMeta.style.marginTop) + 10) {
        sidebarWrapper.classList.add('home-sidebar-fixed')
      } else {
        sidebarWrapper.classList.remove('home-sidebar-fixed')
      }
    });
  }
  </script>
        <div class="section-box tag-line box-shadow-wrapper">
          <section class="section tags-section posts-expand bg-color">
            <div class="padding-wrapper">
  <div class="tag-timeline-box">
    <div class="tag-timeline-wrapper">
      <div class="tag-timeline-title">
        <h2>
          Aliyun
          <small>标签</small>
        </h2>
      </div>
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      <a href="https://tomhht.github.io/post/zai-centos-he-ubuntu-shang-an-zhuang-he-pei-zhi-docker/">
        <div class="motion-warpper">
          <div class="tag-post-node">
            <h1>
              09-01
              <small>在CentOS和Ubuntu上安装和配置docker</small>
            </h1>
          </div>
        </div>
      </a>
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      <a href="https://tomhht.github.io/post/zai-ubuntu-2004-shang-shi-yong-kubeadm-bu-shu-kubernetes-ji-qun/">
        <div class="motion-warpper">
          <div class="tag-post-node">
            <h1>
              08-27
              <small>在Ubuntu 20.04和CentOS 8上使用kubeadm部署Kubernetes集群</small>
            </h1>
          </div>
        </div>
      </a>
      
      
      
      
      
    </div>
  </div>
</div>
          </section>
        </div>
      </div>
    </div>
    <div class="footer-box">
  <footer class="footer">
    <div class="copyright">
      Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | © 2019-2020 Theme By <a href="https://github.com/hsxyhao/gridea-theme-next" target="_blank">HsxyHao</a>
    </div>
    <div class="poweredby">
      Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a>
    </div>
  </footer>
  
  
    <div class="drawer-box left" id="drawer_box">
      <span class="muse-line muse-line-first"></span>
      <span class="muse-line muse-line-middle"></span>
      <span class="muse-line muse-line-last"></span>
    </div>
  
  <div class="mist back-to-top" id="back_to_top">
    <i class="fa fa-arrow-up"></i>
    
  </div>
  
  
  
</div>
<script>

  let sideBarOpen = 'sidebar-open';
  let body = document.body;
  let back2Top = document.querySelector('#back_to_top'),
  back2TopText = document.querySelector('#back_to_top_text'),
  drawerBox = document.querySelector('#drawer_box'),
  rightSideBar = document.querySelector('.sidebar'),
  viewport = document.querySelector('body');

  function scrollAnimation(currentY, targetY) {
   
    let needScrollTop = targetY - currentY
    let _currentY = currentY
    setTimeout(() => {
      const dist = Math.ceil(needScrollTop / 10)
      _currentY += dist
      window.scrollTo(_currentY, currentY)
      if (needScrollTop > 10 || needScrollTop < -10) {
        scrollAnimation(_currentY, targetY)
      } else {
        window.scrollTo(_currentY, targetY)
      }
    }, 1)
  }

  back2Top.addEventListener("click", function(e) {
    scrollAnimation(document.scrollingElement.scrollTop, 0);
    e.stopPropagation();
    return false;
  });
  
  window.addEventListener('scroll', function(e) {
    let percent = document.scrollingElement.scrollTop / (document.scrollingElement.scrollHeight - document.scrollingElement.clientHeight) * 100;
    if (percent > 1 && !back2Top.classList.contains('back-top-active')) {
      back2Top.classList.add('back-top-active');
    }
    if (percent == 0) {
      back2Top.classList.remove('back-top-active');
    }
    if (back2TopText) {
      back2TopText.textContent = Math.floor(percent);
    }
  });

  
  let hasCacu = false;
  window.onresize = function() {
    if (window.width > 991) {
      calcuHeight();
    } else {
      hasCacu = false;
    }
  }

  function calcuHeight() {
    // 动态调整站点概览高度
    if (!hasCacu && back2Top.classList.contains('pisces') || back2Top.classList.contains('gemini')) {
      let sideBar = document.querySelector('.sidebar');
      let navUl = document.querySelector('#site_nav');
      sideBar.style = 'margin-top:' + (navUl.offsetHeight + navUl.offsetTop + 15) + 'px;';
      hasCacu = true;
    }
  }
  calcuHeight();
  
  let open = false, MOTION_TIME = 300, RIGHT_MOVE_DIS = '320px';

  if (drawerBox) {
    let rightMotions = document.querySelectorAll('.right-motion');
    let right = drawerBox.classList.contains('right');

    let transitionDir = right ? "transition.slideRightIn" : "transition.slideLeftIn";

    let openProp, closeProp;
    if (right) {
      openProp = {
        paddingRight: RIGHT_MOVE_DIS 
      };
      closeProp = {
        paddingRight: '0px'
      };
    } else {
      openProp = {
        paddingLeft: RIGHT_MOVE_DIS 
      };
      closeProp = {
        paddingLeft: '0px'
      };
    }

    drawerBox.onclick = function() {
      open = !open;
      window.Velocity(rightSideBar, 'stop');
      window.Velocity(viewport, 'stop');
      window.Velocity(rightMotions, 'stop');
      if (open) {
        window.Velocity(rightSideBar, {
          width: RIGHT_MOVE_DIS
        }, {
          duration: MOTION_TIME,
          begin: function() {
            window.Velocity(rightMotions, transitionDir,{ });
          }
        })
        window.Velocity(viewport, openProp,{
          duration: MOTION_TIME
        });
      } else {
        window.Velocity(rightSideBar, {
          width: '0px'
        }, {
          duration: MOTION_TIME,
          begin: function() {
            window.Velocity(rightMotions, {
              opacity: 0
            });
          }
        })
        window.Velocity(viewport, closeProp ,{
          duration: MOTION_TIME
        });
      }
      for (let i = 0; i < drawerBox.children.length; i++) {
        drawerBox.children[i].classList.toggle('muse-line');
      }
      drawerBox.classList.toggle(sideBarOpen);
    }
  }

  // 链接跳转
  let newWindow = 'true'
  if (newWindow === 'true') {
    let links = document.querySelectorAll('.post-body a')
    links.forEach(item => {
      if (!item.classList.contains('btn')) {
        item.setAttribute("target","_blank");
      }
    })
  }
  // 代码高亮
  hljs.initHighlightingOnLoad();

</script>
  </div>
</body>
<input hidden id="copy" />
<script>
  //拿来主义(真香)^_^，Clipboard 实现摘自掘金 https://juejin.im/post/5aefeb6e6fb9a07aa43c20af
  window.Clipboard = (function (window, document, navigator) {
    var textArea,
      copy;

    // 判断是不是ios端
    function isOS() {
      return navigator.userAgent.match(/ipad|iphone/i);
    }
    //创建文本元素
    function createTextArea(text) {
      textArea = document.createElement('textArea');
      textArea.value = text;
      textArea.style.width = 0;
      textArea.style.height = 0;
      textArea.clientHeight = 0;
      textArea.clientWidth = 0;
      document.body.appendChild(textArea);
    }
    //选择内容
    function selectText() {
      var range,
        selection;

      if (isOS()) {
        range = document.createRange();
        range.selectNodeContents(textArea);
        selection = window.getSelection();
        selection.removeAllRanges();
        selection.addRange(range);
        textArea.setSelectionRange(0, 999999);
      } else {
        textArea.select();
      }
    }

    //复制到剪贴板
    function copyToClipboard() {
      try {
        document.execCommand("Copy")
      } catch (err) {
        alert("复制错误！请手动复制！")
      }
      document.body.removeChild(textArea);
    }

    copy = function (text) {
      createTextArea(text);
      selectText();
      copyToClipboard();
    };

    return {
      copy: copy
    };
  })(window, document, navigator);

  function copyCode(e) {
    if (e.srcElement.tagName === 'SPAN' && e.srcElement.classList.contains('copy-code')) {
      let code = e.currentTarget.querySelector('code');
      var text = code.innerText;
      if (e.srcElement.textContent === '复制成功') {
        console.log('复制操作频率过高');
        return;
      }
      e.srcElement.textContent = '复制成功';
      (function (elem) {
        setTimeout(() => {
          if (elem.textContent === '复制成功') {
            elem.textContent = '复制代码'
          }
        }, 1000);
      })(e.srcElement)
      Clipboard.copy(text);
    }
  }

  let pres = document.querySelectorAll('pre');
  pres.forEach(pre => {
    let code = pre.querySelector('code');
    let copyElem = document.createElement('span');
    copyElem.classList.add('copy-code');
    copyElem.textContent = '复制代码';
    pre.appendChild(copyElem);
    pre.onclick = copyCode
  })
</script>
<script src="/media/js/motion.js"></script>

<script src="https://cdn.jsdelivr.net/gh/cferdinandi/smooth-scroll/dist/smooth-scroll.polyfills.min.js"></script>
<script>
  var scroll = new SmoothScroll('a[href*="#"]', {
    speed: 500
  });
</script>

<!-- <div class="search-mask" id="search_mask">
  <div class="search-box">
    <div class="search-title">
      <i class="fa fa-search"></i>
      <div class="input-box">
        <input type="text" placeholder="搜索">
      </div>
      <i class="fa fa-times-circle"></i>
    </div>
    <div class="result">
      
      <div class="item">
        <a class="result-title" href="https://tomhht.github.io/post/k8s-cao-zuo-bi-ji/"" data-c="
          &lt;p&gt;实操遇到问题好多，记录下。&lt;/p&gt;
&lt;!-- more --&gt;
&lt;h1 id=&#34;image拉取失败replicas被弃用&#34;&gt;image拉取失败，replicas被弃用&lt;/h1&gt;
&lt;h2 id=&#34;问题&#34;&gt;问题&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;# 执行run，显示replicas has been deprecated，因此不生效，只部署了1个实例 
kubectl run httpd-app --image=httpd --replicas=2
# 检查pods运行情况，READY列显示未就绪
kubectl get pods -n wide
# 检查运行细节，一直显示pulling
kubectl describe pods httpd-app
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;解决&#34;&gt;解决&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;删除之前的部署：&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code&gt;kubectl delete pods httpd-app
&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;创建部署文件：&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code&gt;cd ~/k8s
nano nginx.yaml
&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;粘贴下面内容进nginx.yaml：&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code&gt;# API 版本号
apiVersion: apps/v1
# 类型，如：Pod/ReplicationController/Deployment/Service/Ingress
kind: Deployment
metadata:
  # Kind 的名称
  name: nginx-app
spec:
  selector:
    matchLabels:
      # 容器标签的名字，发布 Service 时，selector 需要和这里对应
      app: nginx
  # 部署的实例数量
  replicas: 2
  template:
    metadata:
      labels:
        app: nginx
    spec:
      # 配置容器，数组类型，说明可以配置多个容器
      containers:
      # 容器名称
      - name: nginx
        # 容器镜像
        image: nginx:1.17
        # 只有镜像不存在时，才会进行镜像拉取
        imagePullPolicy: IfNotPresent
        ports:
        # Pod 端口
        - containerPort: 80
&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&#34;4&#34;&gt;
&lt;li&gt;创建：&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code&gt;kubectl apply -f nginx.yaml
&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&#34;5&#34;&gt;
&lt;li&gt;检查：&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code&gt;kubectl get deployments
kubectl describe deployment nginx-app
kubectl get replicaset
kubectl describe rs nginx-app-5d85b5fb59
kubectl get pods -o wide
kubectl describe pods nginx-app-5d85b5fb59-2ct5p
&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&#34;6&#34;&gt;
&lt;li&gt;暴露服务：&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code&gt;kubectl expose deployment nginx-app --port=80 --type=LoadBalancer
&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&#34;7&#34;&gt;
&lt;li&gt;查看服务状态(查看对外的端口)&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code&gt;kubectl get services
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;nginx-app&lt;/code&gt;一直处于pending状态，应该是type设置为&lt;code&gt;LoadBalancer&lt;/code&gt;，但没有云服务商和本地服务提供该功能。&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;参考链接：&lt;br&gt;
&lt;a href=&#34;https://blog.csdn.net/qq_43279371/article/details/107768713&#34;&gt;https://blog.csdn.net/qq_43279371/article/details/107768713&lt;/a&gt;&lt;br&gt;
&lt;a href=&#34;https://blog.csdn.net/kenkao/article/details/86764788&#34;&gt;https://blog.csdn.net/kenkao/article/details/86764788&lt;/a&gt;&lt;/p&gt;
">k8s操作笔记</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://tomhht.github.io/post/pei-zhi-ubuntu-he-centos-qing-hua-yuan/"" data-c="
          &lt;p&gt;加快Ubuntu和CentOS软件下载速度。&lt;/p&gt;
&lt;!-- more --&gt;
&lt;h1 id=&#34;ubuntu&#34;&gt;Ubuntu&lt;/h1&gt;
&lt;p&gt;备份源配置文件：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;sudo cp /etc/apt/sources.list /etc/apt/sources.list.bak
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;使用vim或gedit编辑source.list，用下面内容替换原有内容：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# 默认注释了源码镜像以提高 apt update 速度，如有需要可自行取消注释
deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal main restricted universe multiverse
# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal main restricted universe multiverse
deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-updates main restricted universe multiverse
# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-updates main restricted universe multiverse
deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-backports main restricted universe multiverse
# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-backports main restricted universe multiverse
deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-security main restricted universe multiverse
# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-security main restricted universe multiverse

# 预发布软件源，不建议启用
# deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-proposed main restricted universe multiverse
# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-proposed main restricted universe multiverse
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;更新软件包缓存，使配置文件生效：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;sudo apt-get update
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;centos&#34;&gt;CentOS&lt;/h1&gt;
&lt;pre&gt;&lt;code&gt;path=&#39;/etc/yum.repos.d/&#39;
repos=(CentOS-AppStream.repo CentOS-Base.repo CentOS-centosplus.repo CentOS-Extras.repo CentOS-PowerTools.repo)
for repo in ${repos[@]}; do
sudo cp $path$repo $path$repo&#39;.bak&#39; #备份源配置文件
sudo sed -i &amp;quot;s/^mirrorlist/#&amp;amp;/; s/^#baseurl/baseurl/; s/http:\/\/mirror.centos.org/https:\/\/mirrors.tuna.tsinghua.edu.cn\/centos/&amp;quot; $path$repo #修改配置文件
done
# 更新软件包缓存，使配置文件生效
sudo yum makecache
&lt;/code&gt;&lt;/pre&gt;
&lt;hr&gt;
&lt;p&gt;参考链接：&lt;br&gt;
&lt;a href=&#34;https://mirrors.tuna.tsinghua.edu.cn/help/ubuntu/&#34;&gt;https://mirrors.tuna.tsinghua.edu.cn/help/ubuntu/&lt;/a&gt;&lt;br&gt;
&lt;a href=&#34;https://blog.csdn.net/xiangxianghehe/article/details/105688062&#34;&gt;https://blog.csdn.net/xiangxianghehe/article/details/105688062&lt;/a&gt;&lt;br&gt;
&lt;a href=&#34;https://mirror.tuna.tsinghua.edu.cn/help/centos/&#34;&gt;https://mirror.tuna.tsinghua.edu.cn/help/centos/&lt;/a&gt;&lt;/p&gt;
">配置Ubuntu和CentOS清华源</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://tomhht.github.io/post/zai-centos-he-ubuntu-shang-an-zhuang-he-pei-zhi-docker/"" data-c="
          &lt;p&gt;整理docker安装心得。&lt;/p&gt;
&lt;!-- more --&gt;
&lt;h1 id=&#34;centos&#34;&gt;CentOS&lt;/h1&gt;
&lt;pre&gt;&lt;code&gt;# 移除旧版
sudo yum remove docker \
                  docker-client \
                  docker-client-latest \
                  docker-common \
                  docker-latest \
                  docker-latest-logrotate \
                  docker-logrotate \
                  docker-engine
# 设置阿里云仓库repository
sudo yum install -y yum-utils
sudo yum-config-manager \
    --add-repo \
   http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
# 安装docker
sudo yum install docker-ce docker-ce-cli containerd.io
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;ubuntu&#34;&gt;Ubuntu&lt;/h1&gt;
&lt;pre&gt;&lt;code&gt;# 移除旧版
sudo apt-get remove docker docker-engine docker.io containerd runc
# 安装依赖软件
sudo apt-get update
sudo apt-get install \
    apt-transport-https \
    ca-certificates \
    curl \
    gnupg-agent \
    software-properties-common
# 添加Docker官方GPG KEY
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -
# 添加官方仓库
sudo add-apt-repository \
   &amp;quot;deb [arch=amd64] https://download.docker.com/linux/ubuntu \
   $(lsb_release -cs) \
   stable&amp;quot;
# 安装docker
sudo apt-get update
sudo apt-get install docker-ce docker-ce-cli containerd.io
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;以上操作完毕后，继续操作下面通用部分。&lt;/p&gt;
&lt;h1 id=&#34;通用&#34;&gt;通用&lt;/h1&gt;
&lt;pre&gt;&lt;code&gt;# 启动docker
sudo systemctl start docker
# 加入开机启动
sudo systemctl enable docker
# 允许当前用户使用docker
sudo usermod -aG docker ${USER}
# 配置国内加速器（可显著增加docker pull镜像的成功率和速度）
sudo tee /etc/docker/daemon.json &amp;lt;&amp;lt;-&#39;EOF&#39;
{
    &amp;quot;registry-mirrors&amp;quot;: [
        &amp;quot;https://dockerhub.azk8s.cn/ &amp;quot;,
        &amp;quot;https://hub-mirror.c.163.com/&amp;quot;,
        &amp;quot;https://docker.mirrors.ustc.edu.cn&amp;quot;
    ]
}
EOF
sudo systemctl daemon-reload
sudo systemctl restart docker
&lt;/code&gt;&lt;/pre&gt;
&lt;hr&gt;
&lt;p&gt;参考链接：&lt;br&gt;
&lt;a href=&#34;https://docs.docker.com/engine/install/&#34;&gt;https://docs.docker.com/engine/install/&lt;/a&gt;&lt;br&gt;
&lt;a href=&#34;https://developer.aliyun.com/article/763983&#34;&gt;https://developer.aliyun.com/article/763983&lt;/a&gt;&lt;br&gt;
&lt;a href=&#34;https://www.jianshu.com/p/5a911f20d93e&#34;&gt;https://www.jianshu.com/p/5a911f20d93e&lt;/a&gt;&lt;/p&gt;
">在CentOS和Ubuntu上安装和配置docker</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://tomhht.github.io/post/ubuntu-he-centos-duan-kou-she-zhi/"" data-c="
          &lt;p&gt;记录下端口设置，用到啥记录啥。&lt;/p&gt;
&lt;!-- more --&gt;
&lt;h1 id=&#34;centos&#34;&gt;CentOS&lt;/h1&gt;
&lt;p&gt;核心指令&lt;code&gt;firewall-cmd&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&#34;查看已开放端口&#34;&gt;查看已开放端口&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;sudo firewall-cmd --list-ports
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;开启端口&#34;&gt;开启端口&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;sudo firewall-cmd --zone=public --add-port=10250/tcp --permanent
sudo firewall-cmd --zone=public --add-port=30000-32767/tcp --permanent
//--zone: 作用域 
//--add-port=2181/tcp: 要开启的端口号，格式为：端口号/通讯协议 
//--permanent: 使端口永久开放，如不添加，则表示临时有效，开机重启后便会失效
//30000-32767，端口区间
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;关闭端口&#34;&gt;关闭端口&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;sudo firewall-cmd --zone= public --remove-port=6443/tcp --permanent
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;reload以便-permanent配置生效&#34;&gt;reload以便--permanent配置生效&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;sudo firewall-cmd --reload
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;ubuntu&#34;&gt;Ubuntu&lt;/h1&gt;
&lt;p&gt;核心指令&lt;code&gt;ufw&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&#34;启用ufw&#34;&gt;启用ufw&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;sudo ufw enable
sudo ufw allow ssh
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;查看已开放端口-2&#34;&gt;查看已开放端口&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;sudo ufw status
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;开启端口-2&#34;&gt;开启端口&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;sudo ufw allow 10250/tcp
sudo ufw allow 30000:32767/tcp
//30000:32767是端口区间
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;关闭端口-2&#34;&gt;关闭端口&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;sudo ufw delete allow 10250/tcp
&lt;/code&gt;&lt;/pre&gt;
&lt;hr&gt;
&lt;p&gt;参考链接：&lt;br&gt;
&lt;a href=&#34;https://www.cnblogs.com/Sungeek/p/8257681.html&#34;&gt;https://www.cnblogs.com/Sungeek/p/8257681.html&lt;/a&gt;&lt;br&gt;
&lt;a href=&#34;https://blog.csdn.net/Sun_Hui_/article/details/103178840&#34;&gt;https://blog.csdn.net/Sun_Hui_/article/details/103178840&lt;/a&gt;&lt;br&gt;
&lt;a href=&#34;https://www.itcoder.tech/posts/how-to-setup-a-firewall-with-ufw-on-ubuntu-20-04/&#34;&gt;https://www.itcoder.tech/posts/how-to-setup-a-firewall-with-ufw-on-ubuntu-20-04/&lt;/a&gt;&lt;/p&gt;
">Ubuntu和CentOS端口设置</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://tomhht.github.io/post/ubuntu-he-centos-xiu-gai-grub/"" data-c="
          &lt;p&gt;grub的修改位置和生效方法。&lt;/p&gt;
&lt;!-- more --&gt;
&lt;p&gt;grub的修改位置是同样的。&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;sudo vim /etc/default/grub
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;生效方法有区别：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;sudo grub2-mkconfig –o /etc/grub2.cfg  #CentOS
sudo update-grub2  #Ubuntu
&lt;/code&gt;&lt;/pre&gt;
&lt;hr&gt;
&lt;p&gt;参考链接：&lt;br&gt;
&lt;a href=&#34;https://blog.csdn.net/whatday/article/details/106123164&#34;&gt;https://blog.csdn.net/whatday/article/details/106123164&lt;/a&gt;&lt;br&gt;
&lt;a href=&#34;https://www.techbrown.com/change-default-grub2-entries-timeout-centos-7/&#34;&gt;https://www.techbrown.com/change-default-grub2-entries-timeout-centos-7/&lt;/a&gt;&lt;/p&gt;
">Ubuntu和CentOS修改grub</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://tomhht.github.io/post/about/"" data-c="
          &lt;p&gt;第一次拥有自己的博客，感觉兴奋，折腾了半天，主要是为了自己能有一个记录和吐槽的地方。曾经也在其他网站做过blogger，结果要么关张要么消失要么墙墙，一言难尽。&lt;/p&gt;
">关于</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://tomhht.github.io/post/zai-ubuntu-2004-shang-shi-yong-kubeadm-bu-shu-kubernetes-ji-qun/"" data-c="
          &lt;p&gt;本文主要是踩坑后想记录下避坑方法，内容涉及Kubernetes, Kubeadm, Kubectl, Kubelet, Ubuntu, CentOS, Flannel, Docker, 阿里云。&lt;/p&gt;
&lt;!-- more --&gt;
&lt;h1 id=&#34;写作背景&#34;&gt;写作背景&lt;/h1&gt;
&lt;p&gt;初学Kubernetes，虽然网上资源很多，但没一个能彻底搞定，于是杂烩一下。&lt;/p&gt;
&lt;h1 id=&#34;安装前的准备工作&#34;&gt;安装前的准备工作&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;control node（控制节点）、worker node（工作节点） 都要做这些准备工作。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;检查各主机配置&#34;&gt;检查各主机配置&lt;/h2&gt;
&lt;h3 id=&#34;检查cpu和内存&#34;&gt;检查cpu和内存&lt;/h3&gt;
&lt;p&gt;无论是虚拟机还是物理机，都要求&lt;strong&gt;cpu内核≥2，内存≥2G&lt;/strong&gt;。&lt;/p&gt;
&lt;h3 id=&#34;检查主机名hostname&#34;&gt;检查主机名hostname&lt;/h3&gt;
&lt;p&gt;hostname要求&lt;strong&gt;不能是 localhost，且不包含下划线、小数点、大写字母&lt;/strong&gt;。&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# 检查hostname
hostname 
# 修改 hostname
hostnamectl set-hostname 名字
# 查看修改结果
hostnamectl status
# 设置 hostname 解析
echo &amp;quot;127.0.0.1   $(hostname)&amp;quot; &amp;gt;&amp;gt; /etc/hosts
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;设置固定ip&#34;&gt;设置固定IP&lt;/h3&gt;
&lt;p&gt;建议使用nmcli配置，因为跨平台（Ubuntu和CentOS）。&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;nmcli
//如果提示没有安装，先按下面步骤安装
# 安装nmcli
sudo yum install NetworkManager #CentOS
sudo apt-get install network-manager #Ubuntu
# 检查nmcli是否接管了网络管理
nmcli g
//正常是显示绿色的信息。如果STATE列显示disconnected，则Ubuntu要修改/etc/netplan/里的yaml文件，在version下面添加一行renderer: NetworkManager，保存退出后执行sudo systemctl daemon-reload 和 sudo systemctl restart NetworkManager
# 查看当前默认网卡和ip信息
ip route show
ip a
//ip route show 命令中，可以知道机器的网关DNS和默认网卡，如 default via 192.168.127.2 dev ens33，via后面的内容 192.168.127.2 就是网关和DNS，dev后面的内容 ens33 就是默认网卡
//ip a 命令中，可显示默认网卡的 IP 地址，Kubernetes 将使用此 IP 地址与集群内的其他节点通信，如192.168.127.131
//所有节点上 Kubernetes 所使用的 IP 地址必须可以互通（无需 NAT 映射、无安全组或防火墙隔离）
# 设置固定IP，网卡、ip地址、网关、DNS可参考上面的信息
sudo nmcli c mod ens33 \
ipv4.addresses 192.168.127.131/24 \
ipv4.method manual \
ipv4.gateway 192.168.127.2 \
ipv4.dns 192.168.127.2
# 让配置立刻生效
sudo nmcli c up ens33
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;创建k8s文件夹&#34;&gt;创建k8s文件夹&lt;/h2&gt;
&lt;p&gt;存放安装过程所需文件。执行下面代码：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;mkdir ~/k8s
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;设置iptables&#34;&gt;设置iptables&lt;/h2&gt;
&lt;p&gt;执行下面代码：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;cat &amp;lt;&amp;lt;EOF | sudo tee /etc/sysctl.d/k8s.conf
net.bridge.bridge-nf-call-ip6tables = 1
net.bridge.bridge-nf-call-iptables = 1
EOF
sudo sysctl --system
# 如果想检查配置，可执行
sysctl -n net.bridge.bridge-nf-call-iptables
sysctl -n net.bridge.bridge-nf-call-ip6tables
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;打开端口&#34;&gt;打开端口&lt;/h2&gt;
&lt;h3 id=&#34;ubuntu的准备工作centos跳过&#34;&gt;Ubuntu的准备工作（CentOS跳过）&lt;/h3&gt;
&lt;p&gt;先打开Ubuntu自带的防火墙ufw。执行下面代码：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;sudo ufw enable
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;执行后提示可能断开连接，直接y继续，别担心，ssh连接不会断。&lt;br&gt;
如果使用ssh连接，还需要执行下面代码，以便打开ssh连接：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;sudo ufw allow ssh
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;打开相应端口&#34;&gt;打开相应端口&lt;/h3&gt;
&lt;p&gt;依据所使用的系统（Ubuntu / CentOS），执行相应代码。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;控制节点 Control-plane nodes&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code&gt;# Ubuntu
sudo ufw allow 6443/tcp
sudo ufw allow 2379:2380/tcp
sudo ufw allow 10250:10252/tcp
//上面代码中的冒号代表端口区间。

#CentOS
sudo firewall-cmd --zone=public --add-port=6443/tcp --permanent
sudo firewall-cmd --zone=public --add-port=2379-2380/tcp --permanent
sudo firewall-cmd --zone=public --add-port=10250-10252/tcp --permanent
sudo firewall-cmd --reload
&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;工作节点 Worker nodes&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code&gt;# Ubuntu
sudo ufw allow 10250/tcp
sudo ufw allow 30000:32767/tcp

# CentOS
sudo firewall-cmd --zone=public --add-port=10250/tcp --permanent
sudo firewall-cmd --zone=public --add-port=30000-32767/tcp --permanent
sudo firewall-cmd --reload
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;禁用swap&#34;&gt;禁用swap&lt;/h2&gt;
&lt;p&gt;由于swap性能低下，Kubeadm默认要求禁止使用swap。执行如下代码：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;sudo swapoff -a  #临时禁用swap
sudo sed -i &#39;s/.*swap.*/#&amp;amp;/&#39; /etc/fstab  #永久禁用swap
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;可通过&lt;code&gt;free -m&lt;/code&gt;来检查禁用效果。&lt;/p&gt;
&lt;h2 id=&#34;安装docker&#34;&gt;安装docker&lt;/h2&gt;
&lt;p&gt;详见&lt;a href=&#34;post/zai-centos-he-ubuntu-shang-an-zhuang-he-pei-zhi-docker/&#34;&gt;docker安装和配置&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;安装kubeadm-kubelet和kubectl&#34;&gt;安装kubeadm, kubelet和kubectl&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;control node（控制节点）、worker node（工作节点） 上都安装。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;Ubuntu&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;sudo apt-get update &amp;amp;&amp;amp; sudo apt-get install -y apt-transport-https curl
curl -s https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg | sudo apt-key add -
cat &amp;lt;&amp;lt;EOF | sudo tee /etc/apt/sources.list.d/kubernetes.list
deb https://mirrors.aliyun.com/kubernetes/apt kubernetes-xenial main
EOF
sudo apt-get update
sudo apt-get install -y kubelet kubeadm kubectl
sudo apt-mark hold kubelet kubeadm kubectl
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;CentOS&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;cat &amp;lt;&amp;lt;EOF | sudo tee /etc/yum.repos.d/kubernetes.repo
[kubernetes]
name=Kubernetes
baseurl=https://mirrors.aliyun.com/yum/repos/kubernetes-el7-x86_64
enabled=1
gpgcheck=0
repo_gpgcheck=0
gpgkey=https:/mirrors.aliyun.com/yum/doc/yum-key.gpg https://mirrors.aliyun.com/yum/doc/rpm-package-key.gpg
exclude=kubelet kubeadm kubectl
EOF

# Set SELinux in permissive mode (effectively disabling it)
sudo setenforce 0
sudo sed -i &#39;s/^SELINUX=enforcing$/SELINUX=permissive/&#39; /etc/selinux/config

sudo yum install -y kubelet kubeadm kubectl --disableexcludes=kubernetes

sudo systemctl enable --now kubelet
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;在control-node控制节点上用kubeadm创建集群&#34;&gt;在control node控制节点上用kubeadm创建集群&lt;/h1&gt;
&lt;h2 id=&#34;初始化集群-方法一推荐能成功就很幸运&#34;&gt;初始化集群 - 方法一（推荐，能成功就很幸运）&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;kubeadm init --apiserver-advertise-address=你的本机IP \
--pod-network-cidr=10.244.0.0/16 \
--kubernetes-version=v1.18.8 \
--image-repository=registry.cn-hangzhou.aliyuncs.com/google_containers
//--image-repository指定从阿里云拉取所需镜像
#如果安装失败，再试几次，还不行就尝试方法二。
#如果安装成功，则输出类似下面内容，将内容中的`kubeadm join ...`单独保存出来，这是其他节点加入主节点的信息。跳过方法二。
...
...
kubeadm join 192.168.127.132:6443 --token 4pwz11.1m0u1k3ak3ibgx08 \
    --discovery-token-ca-cert-hash sha256:671404c4f80afe5d06d8eefcd5acc6049c4d84f1ebf1091b09bc180ea44e79b7   
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;如果安装顺利，&lt;a href=&#34;#%E8%B5%8B%E4%BA%88%E5%BD%93%E5%89%8D%E7%94%A8%E6%88%B7%E4%BD%BF%E7%94%A8kubectl%E7%9A%84%E6%9D%83%E9%99%90&#34;&gt;点这里跳过方法二&lt;/a&gt;。&lt;/p&gt;
&lt;h2 id=&#34;初始化集群-方法二只在方法一失败的情况下使用&#34;&gt;初始化集群 - 方法二（只在方法一失败的情况下使用）&lt;/h2&gt;
&lt;p&gt;由于种种原因，国内无法从k8s.gcr.io下载到kubeadm部署所需的文件，以下方法将通过阿里云获取。&lt;/p&gt;
&lt;h3 id=&#34;准备工作&#34;&gt;准备工作&lt;/h3&gt;
&lt;h4 id=&#34;查看所需镜像&#34;&gt;查看所需镜像&lt;/h4&gt;
&lt;pre&gt;&lt;code&gt;kubeadm config images list
#下面是执行的结果
k8s.gcr.io/kube-apiserver:v1.18.8
k8s.gcr.io/kube-controller-manager:v1.18.8
k8s.gcr.io/kube-scheduler:v1.18.8
k8s.gcr.io/kube-proxy:v1.18.8
k8s.gcr.io/pause:3.2
k8s.gcr.io/etcd:3.4.3-0
k8s.gcr.io/coredns:1.6.7
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;在阿里云控制台找到所需镜像&#34;&gt;在阿里云控制台找到所需镜像&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&#34;https://cr.console.aliyun.com/&#34;&gt;https://cr.console.aliyun.com/&lt;/a&gt;  左侧点”镜像搜索“&lt;/li&gt;
&lt;li&gt;分别搜索”kube-apiserver“等所有名称，点开搜索到的镜像，一定找到正确的版本号（如v1.18.8）（日期越新的越容易找到），复制页面中的”公网地址“&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;pull镜像-打标签-移除无用镜像&#34;&gt;pull镜像、打标签、移除无用镜像&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;pull镜像&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code&gt;KUBE_VERSION=v1.18.8
PAUSE_VERSION=3.2
ETCD_VERSION=3.4.3-0
CORE_DNS_VERSION=1.6.7
docker pull registry.cn-hangzhou.aliyuncs.com/wyc_google_containers/kube-apiserver:$KUBE_VERSION
docker pull registry.cn-hangzhou.aliyuncs.com/wyc_google_containers/kube-controller-manager:$KUBE_VERSION
docker pull registry.cn-hangzhou.aliyuncs.com/wyc_google_containers/kube-scheduler:$KUBE_VERSION
docker pull registry.cn-hangzhou.aliyuncs.com/wyc_google_containers/kube-proxy:$KUBE_VERSION
docker pull registry.cn-hangzhou.aliyuncs.com/google_containers/pause:$PAUSE_VERSION
docker pull registry.cn-hangzhou.aliyuncs.com/google_containers/coredns:$CORE_DNS_VERSION
docker pull registry.cn-hangzhou.aliyuncs.com/google_containers/etcd:$ETCD_VERSION
&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;给pull下来的镜像打标签&lt;br&gt;
因为kubeadm部署时会找k8s.gcr.io标签的镜像，因此需要将上一步pull的镜像打上k8s.gcr.io标签。&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code&gt;docker tag registry.cn-hangzhou.aliyuncs.com/wyc_google_containers/kube-apiserver:$KUBE_VERSION  k8s.gcr.io/kube-proxy:$KUBE_VERSION
docker tag registry.cn-hangzhou.aliyuncs.com/wyc_google_containers/kube-apiserver:$KUBE_VERSION k8s.gcr.io/kube-controller-manager:$KUBE_VERSION
docker tag registry.cn-hangzhou.aliyuncs.com/wyc_google_containers/kube-apiserver:$KUBE_VERSION k8s.gcr.io/kube-apiserver:$KUBE_VERSION
docker tag registry.cn-hangzhou.aliyuncs.com/wyc_google_containers/kube-apiserver:$KUBE_VERSION k8s.gcr.io/kube-scheduler:$KUBE_VERSION
docker tag registry.cn-hangzhou.aliyuncs.com/google_containers/pause:$PAUSE_VERSION k8s.gcr.io/pause:$PAUSE_VERSION
docker tag registry.cn-hangzhou.aliyuncs.com/google_containers/coredns:$CORE_DNS_VERSION k8s.gcr.io/coredns:$CORE_DNS_VERSION
docker tag registry.cn-hangzhou.aliyuncs.com/google_containers/etcd:$ETCD_VERSION k8s.gcr.io/etcd:$ETCD_VERSION
&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;移除从阿里云pull下来的镜像&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code&gt;docker rmi registry.cn-hangzhou.aliyuncs.com/wyc_google_containers/kube-apiserver:$KUBE_VERSION
docker rmi registry.cn-hangzhou.aliyuncs.com/wyc_google_containers/kube-controller-manager:$KUBE_VERSION
docker rmi registry.cn-hangzhou.aliyuncs.com/wyc_google_containers/kube-scheduler:$KUBE_VERSION
docker rmi registry.cn-hangzhou.aliyuncs.com/wyc_google_containers/kube-proxy:$KUBE_VERSION
docker rmi registry.cn-hangzhou.aliyuncs.com/google_containers/pause:$PAUSE_VERSION
docker rmi registry.cn-hangzhou.aliyuncs.com/google_containers/coredns:$CORE_DNS_VERSION
docker rmi registry.cn-hangzhou.aliyuncs.com/google_containers/etcd:$ETCD_VERSION
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;部署&#34;&gt;部署&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;kubeadm init --apiserver-advertise-address=你的本机IP --pod-network-cidr=10.244.0.0/16  --kubernetes-version=v1.18.8
#执行后的输出
...
...
kubeadm join 192.168.127.132:6443 --token 4pwz11.1m0u1k3ak3ibgx08 \
    --discovery-token-ca-cert-hash sha256:671404c4f80afe5d06d8eefcd5acc6049c4d84f1ebf1091b09bc180ea44e79b7
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;将输出内容中的&lt;code&gt;kubeadm join ...&lt;/code&gt;单独保存出来，这是其他节点加入主节点的信息。&lt;/p&gt;
&lt;h2 id=&#34;赋予当前用户使用kubectl的权限&#34;&gt;赋予当前用户使用kubectl的权限&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;mkdir -p $HOME/.kube
sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
sudo chown $(id -u):$(id -g) $HOME/.kube/config
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;安装网络组件flannel&#34;&gt;安装网络组件flannel&lt;/h2&gt;
&lt;h3 id=&#34;准备工作-2&#34;&gt;准备工作&lt;/h3&gt;
&lt;p&gt;由于种种原因，无法直接pull到网络组件flannel的docker镜像，因此需单独下载。&lt;br&gt;
https://github.com/coreos/flannel/releases/download/v0.12.0/flanneld-v0.12.0-amd64.docker&lt;br&gt;
下载后放进&lt;code&gt;~/k8s&lt;/code&gt;，执行命令：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;cd ~/k8s
docker load &amp;lt; flanneld-v0.12.0-amd64.docker
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;开始安装&#34;&gt;开始安装&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;wget https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml
kubectl apply -f kube-flannel.yml
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;检查部署情况&#34;&gt;检查部署情况&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;kubectl get nodes
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://tomhht.github.io/post-images/1598781753839.png&#34; alt=&#34;节点运行情况&#34; loading=&#34;lazy&#34;&gt;     &lt;br /&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;kubectl get pods -A
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://tomhht.github.io/post-images/1598781791291.png&#34; alt=&#34;Pods运行情况&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
通过&lt;code&gt;docker container ls&lt;/code&gt;也可以看到pods里的容器运行情况。&lt;/p&gt;
&lt;h2 id=&#34;打开kubectl的autocompletion自动完成功能&#34;&gt;打开kubectl的autocompletion自动完成功能&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;echo &#39;source &amp;lt;(kubectl completion bash)&#39; &amp;gt;&amp;gt;~/.bashrc
# 执行后，退出shell（如exit）再进入，即可实现自动完成
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;以上为control node控制节点的部署全流程。&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;worker-node工作节点加入集群&#34;&gt;worker node工作节点加入集群&lt;/h1&gt;
&lt;h2 id=&#34;安装kubeadm-kubelet和kubectl-2&#34;&gt;安装kubeadm, kubelet和kubectl&lt;/h2&gt;
&lt;p&gt;在worker node上，按照上面&lt;strong&gt;安装前的准备工作&lt;/strong&gt;和&lt;strong&gt;安装kubeadm, kubelet和kubectl&lt;/strong&gt;操作。&lt;/p&gt;
&lt;h2 id=&#34;载入control-node上pull好的镜像&#34;&gt;载入control  node上pull好的镜像&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;在control node上，备份出全套docker镜像（含kubeadm所需镜像+网络组件flannel镜像）：&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code&gt;cd ~/k8s
docker save k8s.gcr.io/kube-proxy:v1.18.8 \
k8s.gcr.io/kube-apiserver:v1.18.8 \
k8s.gcr.io/kube-controller-manager:v1.18.8 \
k8s.gcr.io/kube-scheduler:v1.18.8 \
k8s.gcr.io/pause:3.2 \
k8s.gcr.io/coredns:1.6.7 \
k8s.gcr.io/etcd:3.4.3-0 \
quay.io/coreos/flannel:v0.12.0-amd64 &amp;gt; k8s-imagesV1.18.8-flannelV0.12.0.tar
&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;之前踩坑，偷懒用IMAGE ID做的备份，结果载入以后name和tag全都是none，还得打name和tag上去，无比繁琐- _ -||&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;scp上面的备份文件到各个worker node的&lt;code&gt;~/k8s&lt;/code&gt;文件夹里&lt;/li&gt;
&lt;li&gt;在worker node上载入备份文件：&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code&gt;cd ~/k8s
docker load &amp;lt; k8s-imagesV1.18.8-flannelV0.12.0.tar
&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;worker node实际需要的只有3个镜像，分别是&lt;code&gt;kube-proxy, pause, flannel&lt;/code&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;加入集群&#34;&gt;加入集群&lt;/h2&gt;
&lt;p&gt;执行之前在control node上单独保存出来的&lt;code&gt;kubeadm join...&lt;/code&gt;，类似于：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;sudo kubeadm join 192.168.127.132:6443 --token rddtz5.mz2v4ee96177eay5     --discovery-token-ca-cert-hash sha256:671404c4f80afe5d06d8eefcd5acc6049c4d84f1ebf1091b09bc180ea44e79b7
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;如果join指令没记录下来，或者集群创建已经超过24小时了，那么需要重新生成join指令。在&lt;strong&gt;control node&lt;/strong&gt;上执行：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;kubeadm token create --print-join-command
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;复制输出的内容并在&lt;strong&gt;worker node&lt;/strong&gt;上执行即可加入。&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;检查部署结果&#34;&gt;检查部署结果&lt;/h1&gt;
&lt;p&gt;在control node上执行：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;kubectl get nodes -o wide
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://tomhht.github.io/post-images/1599032788153.png&#34; alt=&#34;集群节点信息&#34; loading=&#34;lazy&#34;&gt; &lt;br /&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;kubectl get pods -A -o wide
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://tomhht.github.io/post-images/1599032818248.png&#34; alt=&#34;集群pods信息&#34; loading=&#34;lazy&#34;&gt;&lt;br&gt;
如果STATUS不是Running，则排查故障点：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;kubectl describe pods -n kube-system kube-proxy-t2zbw
&lt;/code&gt;&lt;/pre&gt;
&lt;hr&gt;
&lt;p&gt;参考链接：&lt;br&gt;
&lt;a href=&#34;https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/&#34;&gt;https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/&lt;/a&gt;&lt;br&gt;
&lt;a href=&#34;https://www.cnblogs.com/hellxz/p/use-kubeadm-init-kubernetes-cluster.html&#34;&gt;https://www.cnblogs.com/hellxz/p/use-kubeadm-init-kubernetes-cluster.html&lt;/a&gt;&lt;br&gt;
&lt;a href=&#34;https://www.kuboard.cn/install/install-k8s.html&#34;&gt;https://www.kuboard.cn/install/install-k8s.html&lt;/a&gt;&lt;br&gt;
&lt;a href=&#34;https://blog.csdn.net/LeonardoYasuo/article/details/101483438&#34;&gt;https://blog.csdn.net/LeonardoYasuo/article/details/101483438&lt;/a&gt;&lt;br&gt;
&lt;a href=&#34;https://www.cnblogs.com/yinzhengjie/p/12258215.html&#34;&gt;https://www.cnblogs.com/yinzhengjie/p/12258215.html&lt;/a&gt;&lt;br&gt;
&lt;a href=&#34;https://developer.aliyun.com/article/763983&#34;&gt;https://developer.aliyun.com/article/763983&lt;/a&gt;&lt;/p&gt;
">在Ubuntu 20.04和CentOS 8上使用kubeadm部署Kubernetes集群</a>
      </div>
      
    </div>
  </div>
</div>
<script>
  // var escape = "[{&#34;content&#34;:&#34;&lt;p&gt;实操遇到问题好多，记录下。&lt;/p&gt;\n&lt;!-- more --&gt;\n&lt;h1 id=\&#34;image拉取失败replicas被弃用\&#34;&gt;image拉取失败，replicas被弃用&lt;/h1&gt;\n&lt;h2 id=\&#34;问题\&#34;&gt;问题&lt;/h2&gt;\n&lt;pre&gt;&lt;code&gt;# 执行run，显示replicas has been deprecated，因此不生效，只部署了1个实例 \nkubectl run httpd-app --image=httpd --replicas=2\n# 检查pods运行情况，READY列显示未就绪\nkubectl get pods -n wide\n# 检查运行细节，一直显示pulling\nkubectl describe pods httpd-app\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;解决\&#34;&gt;解决&lt;/h2&gt;\n&lt;ol&gt;\n&lt;li&gt;删除之前的部署：&lt;/li&gt;\n&lt;/ol&gt;\n&lt;pre&gt;&lt;code&gt;kubectl delete pods httpd-app\n&lt;/code&gt;&lt;/pre&gt;\n&lt;ol start=\&#34;2\&#34;&gt;\n&lt;li&gt;创建部署文件：&lt;/li&gt;\n&lt;/ol&gt;\n&lt;pre&gt;&lt;code&gt;cd ~/k8s\nnano nginx.yaml\n&lt;/code&gt;&lt;/pre&gt;\n&lt;ol start=\&#34;3\&#34;&gt;\n&lt;li&gt;粘贴下面内容进nginx.yaml：&lt;/li&gt;\n&lt;/ol&gt;\n&lt;pre&gt;&lt;code&gt;# API 版本号\napiVersion: apps/v1\n# 类型，如：Pod/ReplicationController/Deployment/Service/Ingress\nkind: Deployment\nmetadata:\n  # Kind 的名称\n  name: nginx-app\nspec:\n  selector:\n    matchLabels:\n      # 容器标签的名字，发布 Service 时，selector 需要和这里对应\n      app: nginx\n  # 部署的实例数量\n  replicas: 2\n  template:\n    metadata:\n      labels:\n        app: nginx\n    spec:\n      # 配置容器，数组类型，说明可以配置多个容器\n      containers:\n      # 容器名称\n      - name: nginx\n        # 容器镜像\n        image: nginx:1.17\n        # 只有镜像不存在时，才会进行镜像拉取\n        imagePullPolicy: IfNotPresent\n        ports:\n        # Pod 端口\n        - containerPort: 80\n&lt;/code&gt;&lt;/pre&gt;\n&lt;ol start=\&#34;4\&#34;&gt;\n&lt;li&gt;创建：&lt;/li&gt;\n&lt;/ol&gt;\n&lt;pre&gt;&lt;code&gt;kubectl apply -f nginx.yaml\n&lt;/code&gt;&lt;/pre&gt;\n&lt;ol start=\&#34;5\&#34;&gt;\n&lt;li&gt;检查：&lt;/li&gt;\n&lt;/ol&gt;\n&lt;pre&gt;&lt;code&gt;kubectl get deployments\nkubectl describe deployment nginx-app\nkubectl get replicaset\nkubectl describe rs nginx-app-5d85b5fb59\nkubectl get pods -o wide\nkubectl describe pods nginx-app-5d85b5fb59-2ct5p\n&lt;/code&gt;&lt;/pre&gt;\n&lt;ol start=\&#34;6\&#34;&gt;\n&lt;li&gt;暴露服务：&lt;/li&gt;\n&lt;/ol&gt;\n&lt;pre&gt;&lt;code&gt;kubectl expose deployment nginx-app --port=80 --type=LoadBalancer\n&lt;/code&gt;&lt;/pre&gt;\n&lt;ol start=\&#34;7\&#34;&gt;\n&lt;li&gt;查看服务状态(查看对外的端口)&lt;/li&gt;\n&lt;/ol&gt;\n&lt;pre&gt;&lt;code&gt;kubectl get services\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;code&gt;nginx-app&lt;/code&gt;一直处于pending状态，应该是type设置为&lt;code&gt;LoadBalancer&lt;/code&gt;，但没有云服务商和本地服务提供该功能。&lt;/p&gt;\n&lt;hr&gt;\n&lt;p&gt;参考链接：&lt;br&gt;\n&lt;a href=\&#34;https://blog.csdn.net/qq_43279371/article/details/107768713\&#34;&gt;https://blog.csdn.net/qq_43279371/article/details/107768713&lt;/a&gt;&lt;br&gt;\n&lt;a href=\&#34;https://blog.csdn.net/kenkao/article/details/86764788\&#34;&gt;https://blog.csdn.net/kenkao/article/details/86764788&lt;/a&gt;&lt;/p&gt;\n&#34;,&#34;fileName&#34;:&#34;k8s-cao-zuo-bi-ji&#34;,&#34;abstract&#34;:&#34;&lt;p&gt;实操遇到问题好多，记录下。&lt;/p&gt;\n&#34;,&#34;title&#34;:&#34;k8s操作笔记&#34;,&#34;tags&#34;:[],&#34;date&#34;:&#34;2020-09-02 17:00:52&#34;,&#34;dateFormat&#34;:&#34;2020-09-02&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://tomhht.github.io/post/k8s-cao-zuo-bi-ji/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;2 min read&#34;,&#34;time&#34;:98000,&#34;words&#34;:361,&#34;minutes&#34;:2},&#34;description&#34;:&#34;实操遇到问题好多，记录下。\n\nimage拉取失败，replicas被弃用\n问题\n# 执行run，显示replicas has been deprecated，因此不生效，只部署了1个实例 \nkubectl run httpd-app --i...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;&lt;a href=\&#34;#image%E6%8B%89%E5%8F%96%E5%A4%B1%E8%B4%A5replicas%E8%A2%AB%E5%BC%83%E7%94%A8\&#34;&gt;image拉取失败，replicas被弃用&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E9%97%AE%E9%A2%98\&#34;&gt;问题&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E8%A7%A3%E5%86%B3\&#34;&gt;解决&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;p&gt;加快Ubuntu和CentOS软件下载速度。&lt;/p&gt;\n&lt;!-- more --&gt;\n&lt;h1 id=\&#34;ubuntu\&#34;&gt;Ubuntu&lt;/h1&gt;\n&lt;p&gt;备份源配置文件：&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;sudo cp /etc/apt/sources.list /etc/apt/sources.list.bak\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;使用vim或gedit编辑source.list，用下面内容替换原有内容：&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;# 默认注释了源码镜像以提高 apt update 速度，如有需要可自行取消注释\ndeb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal main restricted universe multiverse\n# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal main restricted universe multiverse\ndeb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-updates main restricted universe multiverse\n# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-updates main restricted universe multiverse\ndeb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-backports main restricted universe multiverse\n# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-backports main restricted universe multiverse\ndeb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-security main restricted universe multiverse\n# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-security main restricted universe multiverse\n\n# 预发布软件源，不建议启用\n# deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-proposed main restricted universe multiverse\n# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-proposed main restricted universe multiverse\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;更新软件包缓存，使配置文件生效：&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;sudo apt-get update\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h1 id=\&#34;centos\&#34;&gt;CentOS&lt;/h1&gt;\n&lt;pre&gt;&lt;code&gt;path=&#39;/etc/yum.repos.d/&#39;\nrepos=(CentOS-AppStream.repo CentOS-Base.repo CentOS-centosplus.repo CentOS-Extras.repo CentOS-PowerTools.repo)\nfor repo in ${repos[@]}; do\nsudo cp $path$repo $path$repo&#39;.bak&#39; #备份源配置文件\nsudo sed -i &amp;quot;s/^mirrorlist/#&amp;amp;/; s/^#baseurl/baseurl/; s/http:\\/\\/mirror.centos.org/https:\\/\\/mirrors.tuna.tsinghua.edu.cn\\/centos/&amp;quot; $path$repo #修改配置文件\ndone\n# 更新软件包缓存，使配置文件生效\nsudo yum makecache\n&lt;/code&gt;&lt;/pre&gt;\n&lt;hr&gt;\n&lt;p&gt;参考链接：&lt;br&gt;\n&lt;a href=\&#34;https://mirrors.tuna.tsinghua.edu.cn/help/ubuntu/\&#34;&gt;https://mirrors.tuna.tsinghua.edu.cn/help/ubuntu/&lt;/a&gt;&lt;br&gt;\n&lt;a href=\&#34;https://blog.csdn.net/xiangxianghehe/article/details/105688062\&#34;&gt;https://blog.csdn.net/xiangxianghehe/article/details/105688062&lt;/a&gt;&lt;br&gt;\n&lt;a href=\&#34;https://mirror.tuna.tsinghua.edu.cn/help/centos/\&#34;&gt;https://mirror.tuna.tsinghua.edu.cn/help/centos/&lt;/a&gt;&lt;/p&gt;\n&#34;,&#34;fileName&#34;:&#34;pei-zhi-ubuntu-he-centos-qing-hua-yuan&#34;,&#34;abstract&#34;:&#34;&lt;p&gt;加快Ubuntu和CentOS软件下载速度。&lt;/p&gt;\n&#34;,&#34;title&#34;:&#34;配置Ubuntu和CentOS清华源&#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;加速&#34;,&#34;slug&#34;:&#34;-7LE7Ga8N&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/-7LE7Ga8N/&#34;},{&#34;name&#34;:&#34;源&#34;,&#34;slug&#34;:&#34;hxgTAOH_N6&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/hxgTAOH_N6/&#34;},{&#34;name&#34;:&#34;国内源&#34;,&#34;slug&#34;:&#34;AVam_YHxdq&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/AVam_YHxdq/&#34;},{&#34;name&#34;:&#34;清华源&#34;,&#34;slug&#34;:&#34;xl0sLn8kCY&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/xl0sLn8kCY/&#34;},{&#34;name&#34;:&#34;tsinghua&#34;,&#34;slug&#34;:&#34;8ea4TbNf-K&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/8ea4TbNf-K/&#34;},{&#34;name&#34;:&#34;tuna&#34;,&#34;slug&#34;:&#34;AKueiIe07M&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/AKueiIe07M/&#34;},{&#34;name&#34;:&#34;Linux&#34;,&#34;slug&#34;:&#34;mTyB0fhtc&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/mTyB0fhtc/&#34;},{&#34;name&#34;:&#34;Ubuntu&#34;,&#34;slug&#34;:&#34;pelgqi16au&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/pelgqi16au/&#34;},{&#34;name&#34;:&#34;CentOS&#34;,&#34;slug&#34;:&#34;qjvKbAF653&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/qjvKbAF653/&#34;}],&#34;date&#34;:&#34;2020-09-01 19:56:40&#34;,&#34;dateFormat&#34;:&#34;2020-09-01&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://tomhht.github.io/post/pei-zhi-ubuntu-he-centos-qing-hua-yuan/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;2 min read&#34;,&#34;time&#34;:116000,&#34;words&#34;:364,&#34;minutes&#34;:2},&#34;description&#34;:&#34;加快Ubuntu和CentOS软件下载速度。\n\nUbuntu\n备份源配置文件：\nsudo cp /etc/apt/sources.list /etc/apt/sources.list.bak\n\n使用vim或gedit编辑source.lis...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;&lt;a href=\&#34;#ubuntu\&#34;&gt;Ubuntu&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#centos\&#34;&gt;CentOS&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;p&gt;整理docker安装心得。&lt;/p&gt;\n&lt;!-- more --&gt;\n&lt;h1 id=\&#34;centos\&#34;&gt;CentOS&lt;/h1&gt;\n&lt;pre&gt;&lt;code&gt;# 移除旧版\nsudo yum remove docker \\\n                  docker-client \\\n                  docker-client-latest \\\n                  docker-common \\\n                  docker-latest \\\n                  docker-latest-logrotate \\\n                  docker-logrotate \\\n                  docker-engine\n# 设置阿里云仓库repository\nsudo yum install -y yum-utils\nsudo yum-config-manager \\\n    --add-repo \\\n   http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo\n# 安装docker\nsudo yum install docker-ce docker-ce-cli containerd.io\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h1 id=\&#34;ubuntu\&#34;&gt;Ubuntu&lt;/h1&gt;\n&lt;pre&gt;&lt;code&gt;# 移除旧版\nsudo apt-get remove docker docker-engine docker.io containerd runc\n# 安装依赖软件\nsudo apt-get update\nsudo apt-get install \\\n    apt-transport-https \\\n    ca-certificates \\\n    curl \\\n    gnupg-agent \\\n    software-properties-common\n# 添加Docker官方GPG KEY\ncurl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -\n# 添加官方仓库\nsudo add-apt-repository \\\n   &amp;quot;deb [arch=amd64] https://download.docker.com/linux/ubuntu \\\n   $(lsb_release -cs) \\\n   stable&amp;quot;\n# 安装docker\nsudo apt-get update\nsudo apt-get install docker-ce docker-ce-cli containerd.io\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;以上操作完毕后，继续操作下面通用部分。&lt;/p&gt;\n&lt;h1 id=\&#34;通用\&#34;&gt;通用&lt;/h1&gt;\n&lt;pre&gt;&lt;code&gt;# 启动docker\nsudo systemctl start docker\n# 加入开机启动\nsudo systemctl enable docker\n# 允许当前用户使用docker\nsudo usermod -aG docker ${USER}\n# 配置国内加速器（可显著增加docker pull镜像的成功率和速度）\nsudo tee /etc/docker/daemon.json &amp;lt;&amp;lt;-&#39;EOF&#39;\n{\n    &amp;quot;registry-mirrors&amp;quot;: [\n        &amp;quot;https://dockerhub.azk8s.cn/ &amp;quot;,\n        &amp;quot;https://hub-mirror.c.163.com/&amp;quot;,\n        &amp;quot;https://docker.mirrors.ustc.edu.cn&amp;quot;\n    ]\n}\nEOF\nsudo systemctl daemon-reload\nsudo systemctl restart docker\n&lt;/code&gt;&lt;/pre&gt;\n&lt;hr&gt;\n&lt;p&gt;参考链接：&lt;br&gt;\n&lt;a href=\&#34;https://docs.docker.com/engine/install/\&#34;&gt;https://docs.docker.com/engine/install/&lt;/a&gt;&lt;br&gt;\n&lt;a href=\&#34;https://developer.aliyun.com/article/763983\&#34;&gt;https://developer.aliyun.com/article/763983&lt;/a&gt;&lt;br&gt;\n&lt;a href=\&#34;https://www.jianshu.com/p/5a911f20d93e\&#34;&gt;https://www.jianshu.com/p/5a911f20d93e&lt;/a&gt;&lt;/p&gt;\n&#34;,&#34;fileName&#34;:&#34;zai-centos-he-ubuntu-shang-an-zhuang-he-pei-zhi-docker&#34;,&#34;abstract&#34;:&#34;&lt;p&gt;整理docker安装心得。&lt;/p&gt;\n&#34;,&#34;title&#34;:&#34;在CentOS和Ubuntu上安装和配置docker&#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;安装&#34;,&#34;slug&#34;:&#34;Q8BfV1d_Wf&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/Q8BfV1d_Wf/&#34;},{&#34;name&#34;:&#34;Linux&#34;,&#34;slug&#34;:&#34;mTyB0fhtc&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/mTyB0fhtc/&#34;},{&#34;name&#34;:&#34;配置&#34;,&#34;slug&#34;:&#34;Bwz1BaTtzi&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/Bwz1BaTtzi/&#34;},{&#34;name&#34;:&#34;Ubuntu&#34;,&#34;slug&#34;:&#34;pelgqi16au&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/pelgqi16au/&#34;},{&#34;name&#34;:&#34;CentOS&#34;,&#34;slug&#34;:&#34;qjvKbAF653&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/qjvKbAF653/&#34;},{&#34;name&#34;:&#34;Docker&#34;,&#34;slug&#34;:&#34;RkYw1lQ_qY&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/RkYw1lQ_qY/&#34;},{&#34;name&#34;:&#34;Aliyun&#34;,&#34;slug&#34;:&#34;LQERLoeDmq&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/LQERLoeDmq/&#34;},{&#34;name&#34;:&#34;阿里云&#34;,&#34;slug&#34;:&#34;CDrtFP3hgt&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/CDrtFP3hgt/&#34;}],&#34;date&#34;:&#34;2020-09-01 18:06:21&#34;,&#34;dateFormat&#34;:&#34;2020-09-01&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://tomhht.github.io/post/zai-centos-he-ubuntu-shang-an-zhuang-he-pei-zhi-docker/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;2 min read&#34;,&#34;time&#34;:101000,&#34;words&#34;:317,&#34;minutes&#34;:2},&#34;description&#34;:&#34;整理docker安装心得。\n\nCentOS\n# 移除旧版\nsudo yum remove docker \\\n                  docker-client \\\n                  docker-client-...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;&lt;a href=\&#34;#centos\&#34;&gt;CentOS&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#ubuntu\&#34;&gt;Ubuntu&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E9%80%9A%E7%94%A8\&#34;&gt;通用&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;p&gt;记录下端口设置，用到啥记录啥。&lt;/p&gt;\n&lt;!-- more --&gt;\n&lt;h1 id=\&#34;centos\&#34;&gt;CentOS&lt;/h1&gt;\n&lt;p&gt;核心指令&lt;code&gt;firewall-cmd&lt;/code&gt;&lt;/p&gt;\n&lt;h2 id=\&#34;查看已开放端口\&#34;&gt;查看已开放端口&lt;/h2&gt;\n&lt;pre&gt;&lt;code&gt;sudo firewall-cmd --list-ports\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;开启端口\&#34;&gt;开启端口&lt;/h2&gt;\n&lt;pre&gt;&lt;code&gt;sudo firewall-cmd --zone=public --add-port=10250/tcp --permanent\nsudo firewall-cmd --zone=public --add-port=30000-32767/tcp --permanent\n//--zone: 作用域 \n//--add-port=2181/tcp: 要开启的端口号，格式为：端口号/通讯协议 \n//--permanent: 使端口永久开放，如不添加，则表示临时有效，开机重启后便会失效\n//30000-32767，端口区间\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;关闭端口\&#34;&gt;关闭端口&lt;/h2&gt;\n&lt;pre&gt;&lt;code&gt;sudo firewall-cmd --zone= public --remove-port=6443/tcp --permanent\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;reload以便-permanent配置生效\&#34;&gt;reload以便--permanent配置生效&lt;/h2&gt;\n&lt;pre&gt;&lt;code&gt;sudo firewall-cmd --reload\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h1 id=\&#34;ubuntu\&#34;&gt;Ubuntu&lt;/h1&gt;\n&lt;p&gt;核心指令&lt;code&gt;ufw&lt;/code&gt;&lt;/p&gt;\n&lt;h2 id=\&#34;启用ufw\&#34;&gt;启用ufw&lt;/h2&gt;\n&lt;pre&gt;&lt;code&gt;sudo ufw enable\nsudo ufw allow ssh\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;查看已开放端口-2\&#34;&gt;查看已开放端口&lt;/h2&gt;\n&lt;pre&gt;&lt;code&gt;sudo ufw status\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;开启端口-2\&#34;&gt;开启端口&lt;/h2&gt;\n&lt;pre&gt;&lt;code&gt;sudo ufw allow 10250/tcp\nsudo ufw allow 30000:32767/tcp\n//30000:32767是端口区间\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;关闭端口-2\&#34;&gt;关闭端口&lt;/h2&gt;\n&lt;pre&gt;&lt;code&gt;sudo ufw delete allow 10250/tcp\n&lt;/code&gt;&lt;/pre&gt;\n&lt;hr&gt;\n&lt;p&gt;参考链接：&lt;br&gt;\n&lt;a href=\&#34;https://www.cnblogs.com/Sungeek/p/8257681.html\&#34;&gt;https://www.cnblogs.com/Sungeek/p/8257681.html&lt;/a&gt;&lt;br&gt;\n&lt;a href=\&#34;https://blog.csdn.net/Sun_Hui_/article/details/103178840\&#34;&gt;https://blog.csdn.net/Sun_Hui_/article/details/103178840&lt;/a&gt;&lt;br&gt;\n&lt;a href=\&#34;https://www.itcoder.tech/posts/how-to-setup-a-firewall-with-ufw-on-ubuntu-20-04/\&#34;&gt;https://www.itcoder.tech/posts/how-to-setup-a-firewall-with-ufw-on-ubuntu-20-04/&lt;/a&gt;&lt;/p&gt;\n&#34;,&#34;fileName&#34;:&#34;ubuntu-he-centos-duan-kou-she-zhi&#34;,&#34;abstract&#34;:&#34;&lt;p&gt;记录下端口设置，用到啥记录啥。&lt;/p&gt;\n&#34;,&#34;title&#34;:&#34;Ubuntu和CentOS端口设置&#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;端口&#34;,&#34;slug&#34;:&#34;guNk0JsrG&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/guNk0JsrG/&#34;},{&#34;name&#34;:&#34;port&#34;,&#34;slug&#34;:&#34;nU_jlBkSws&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/nU_jlBkSws/&#34;},{&#34;name&#34;:&#34;ufw&#34;,&#34;slug&#34;:&#34;IBSMukFxes&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/IBSMukFxes/&#34;},{&#34;name&#34;:&#34;firewalld&#34;,&#34;slug&#34;:&#34;M75-gGzjYj&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/M75-gGzjYj/&#34;},{&#34;name&#34;:&#34;firewall-cmd&#34;,&#34;slug&#34;:&#34;3Sy8n-oU5d&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/3Sy8n-oU5d/&#34;},{&#34;name&#34;:&#34;iptables&#34;,&#34;slug&#34;:&#34;OXPcFg0jmJ&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/OXPcFg0jmJ/&#34;},{&#34;name&#34;:&#34;Linux&#34;,&#34;slug&#34;:&#34;mTyB0fhtc&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/mTyB0fhtc/&#34;},{&#34;name&#34;:&#34;Ubuntu&#34;,&#34;slug&#34;:&#34;pelgqi16au&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/pelgqi16au/&#34;},{&#34;name&#34;:&#34;CentOS&#34;,&#34;slug&#34;:&#34;qjvKbAF653&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/qjvKbAF653/&#34;}],&#34;date&#34;:&#34;2020-08-31 17:53:59&#34;,&#34;dateFormat&#34;:&#34;2020-08-31&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://tomhht.github.io/post/ubuntu-he-centos-duan-kou-she-zhi/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;2 min read&#34;,&#34;time&#34;:67000,&#34;words&#34;:236,&#34;minutes&#34;:2},&#34;description&#34;:&#34;记录下端口设置，用到啥记录啥。\n\nCentOS\n核心指令firewall-cmd\n查看已开放端口\nsudo firewall-cmd --list-ports\n\n开启端口\nsudo firewall-cmd --zone=public --...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;&lt;a href=\&#34;#centos\&#34;&gt;CentOS&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%9F%A5%E7%9C%8B%E5%B7%B2%E5%BC%80%E6%94%BE%E7%AB%AF%E5%8F%A3\&#34;&gt;查看已开放端口&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%BC%80%E5%90%AF%E7%AB%AF%E5%8F%A3\&#34;&gt;开启端口&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%85%B3%E9%97%AD%E7%AB%AF%E5%8F%A3\&#34;&gt;关闭端口&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#reload%E4%BB%A5%E4%BE%BF-permanent%E9%85%8D%E7%BD%AE%E7%94%9F%E6%95%88\&#34;&gt;reload以便--permanent配置生效&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#ubuntu\&#34;&gt;Ubuntu&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%90%AF%E7%94%A8ufw\&#34;&gt;启用ufw&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%9F%A5%E7%9C%8B%E5%B7%B2%E5%BC%80%E6%94%BE%E7%AB%AF%E5%8F%A3-2\&#34;&gt;查看已开放端口&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%BC%80%E5%90%AF%E7%AB%AF%E5%8F%A3-2\&#34;&gt;开启端口&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%85%B3%E9%97%AD%E7%AB%AF%E5%8F%A3-2\&#34;&gt;关闭端口&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;p&gt;grub的修改位置和生效方法。&lt;/p&gt;\n&lt;!-- more --&gt;\n&lt;p&gt;grub的修改位置是同样的。&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;sudo vim /etc/default/grub\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;生效方法有区别：&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;sudo grub2-mkconfig –o /etc/grub2.cfg  #CentOS\nsudo update-grub2  #Ubuntu\n&lt;/code&gt;&lt;/pre&gt;\n&lt;hr&gt;\n&lt;p&gt;参考链接：&lt;br&gt;\n&lt;a href=\&#34;https://blog.csdn.net/whatday/article/details/106123164\&#34;&gt;https://blog.csdn.net/whatday/article/details/106123164&lt;/a&gt;&lt;br&gt;\n&lt;a href=\&#34;https://www.techbrown.com/change-default-grub2-entries-timeout-centos-7/\&#34;&gt;https://www.techbrown.com/change-default-grub2-entries-timeout-centos-7/&lt;/a&gt;&lt;/p&gt;\n&#34;,&#34;fileName&#34;:&#34;ubuntu-he-centos-xiu-gai-grub&#34;,&#34;abstract&#34;:&#34;&lt;p&gt;grub的修改位置和生效方法。&lt;/p&gt;\n&#34;,&#34;title&#34;:&#34;Ubuntu和CentOS修改grub&#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;Linux&#34;,&#34;slug&#34;:&#34;mTyB0fhtc&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/mTyB0fhtc/&#34;},{&#34;name&#34;:&#34;Grub&#34;,&#34;slug&#34;:&#34;SaVkQAc9U4&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/SaVkQAc9U4/&#34;},{&#34;name&#34;:&#34;配置&#34;,&#34;slug&#34;:&#34;Bwz1BaTtzi&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/Bwz1BaTtzi/&#34;},{&#34;name&#34;:&#34;开机&#34;,&#34;slug&#34;:&#34;SziKjUrpjt&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/SziKjUrpjt/&#34;},{&#34;name&#34;:&#34;启动项&#34;,&#34;slug&#34;:&#34;rBmg59Vjxj&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/rBmg59Vjxj/&#34;},{&#34;name&#34;:&#34;启动时间&#34;,&#34;slug&#34;:&#34;cWawItHFUb&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/cWawItHFUb/&#34;},{&#34;name&#34;:&#34;Ubuntu&#34;,&#34;slug&#34;:&#34;pelgqi16au&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/pelgqi16au/&#34;},{&#34;name&#34;:&#34;CentOS&#34;,&#34;slug&#34;:&#34;qjvKbAF653&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/qjvKbAF653/&#34;}],&#34;date&#34;:&#34;2020-08-31 11:19:33&#34;,&#34;dateFormat&#34;:&#34;2020-08-31&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://tomhht.github.io/post/ubuntu-he-centos-xiu-gai-grub/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;1 min read&#34;,&#34;time&#34;:20000,&#34;words&#34;:68,&#34;minutes&#34;:1},&#34;description&#34;:&#34;grub的修改位置和生效方法。\n\ngrub的修改位置是同样的。\nsudo vim /etc/default/grub\n\n生效方法有区别：\nsudo grub2-mkconfig –o /etc/grub2.cfg  #CentOS\nsudo...&#34;,&#34;toc&#34;:&#34;&#34;},{&#34;content&#34;:&#34;&lt;p&gt;第一次拥有自己的博客，感觉兴奋，折腾了半天，主要是为了自己能有一个记录和吐槽的地方。曾经也在其他网站做过blogger，结果要么关张要么消失要么墙墙，一言难尽。&lt;/p&gt;\n&#34;,&#34;fileName&#34;:&#34;about&#34;,&#34;abstract&#34;:&#34;&#34;,&#34;title&#34;:&#34;关于&#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;关于&#34;,&#34;slug&#34;:&#34;_YTMFN_lm&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/_YTMFN_lm/&#34;},{&#34;name&#34;:&#34;about&#34;,&#34;slug&#34;:&#34;cVh0paDPKo&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/cVh0paDPKo/&#34;}],&#34;date&#34;:&#34;2020-08-28 17:32:03&#34;,&#34;dateFormat&#34;:&#34;2020-08-28&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://tomhht.github.io/post/about/&#34;,&#34;hideInList&#34;:true,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;1 min read&#34;,&#34;time&#34;:13000,&#34;words&#34;:67,&#34;minutes&#34;:1},&#34;description&#34;:&#34;第一次拥有自己的博客，感觉兴奋，折腾了半天，主要是为了自己能有一个记录和吐槽的地方。曾经也在其他网站做过blogger，结果要么关张要么消失要么墙墙，一言难尽。\n&#34;,&#34;toc&#34;:&#34;&#34;},{&#34;content&#34;:&#34;&lt;p&gt;本文主要是踩坑后想记录下避坑方法，内容涉及Kubernetes, Kubeadm, Kubectl, Kubelet, Ubuntu, CentOS, Flannel, Docker, 阿里云。&lt;/p&gt;\n&lt;!-- more --&gt;\n&lt;h1 id=\&#34;写作背景\&#34;&gt;写作背景&lt;/h1&gt;\n&lt;p&gt;初学Kubernetes，虽然网上资源很多，但没一个能彻底搞定，于是杂烩一下。&lt;/p&gt;\n&lt;h1 id=\&#34;安装前的准备工作\&#34;&gt;安装前的准备工作&lt;/h1&gt;\n&lt;blockquote&gt;\n&lt;p&gt;control node（控制节点）、worker node（工作节点） 都要做这些准备工作。&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h2 id=\&#34;检查各主机配置\&#34;&gt;检查各主机配置&lt;/h2&gt;\n&lt;h3 id=\&#34;检查cpu和内存\&#34;&gt;检查cpu和内存&lt;/h3&gt;\n&lt;p&gt;无论是虚拟机还是物理机，都要求&lt;strong&gt;cpu内核≥2，内存≥2G&lt;/strong&gt;。&lt;/p&gt;\n&lt;h3 id=\&#34;检查主机名hostname\&#34;&gt;检查主机名hostname&lt;/h3&gt;\n&lt;p&gt;hostname要求&lt;strong&gt;不能是 localhost，且不包含下划线、小数点、大写字母&lt;/strong&gt;。&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;# 检查hostname\nhostname \n# 修改 hostname\nhostnamectl set-hostname 名字\n# 查看修改结果\nhostnamectl status\n# 设置 hostname 解析\necho &amp;quot;127.0.0.1   $(hostname)&amp;quot; &amp;gt;&amp;gt; /etc/hosts\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;设置固定ip\&#34;&gt;设置固定IP&lt;/h3&gt;\n&lt;p&gt;建议使用nmcli配置，因为跨平台（Ubuntu和CentOS）。&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;nmcli\n//如果提示没有安装，先按下面步骤安装\n# 安装nmcli\nsudo yum install NetworkManager #CentOS\nsudo apt-get install network-manager #Ubuntu\n# 检查nmcli是否接管了网络管理\nnmcli g\n//正常是显示绿色的信息。如果STATE列显示disconnected，则Ubuntu要修改/etc/netplan/里的yaml文件，在version下面添加一行renderer: NetworkManager，保存退出后执行sudo systemctl daemon-reload 和 sudo systemctl restart NetworkManager\n# 查看当前默认网卡和ip信息\nip route show\nip a\n//ip route show 命令中，可以知道机器的网关DNS和默认网卡，如 default via 192.168.127.2 dev ens33，via后面的内容 192.168.127.2 就是网关和DNS，dev后面的内容 ens33 就是默认网卡\n//ip a 命令中，可显示默认网卡的 IP 地址，Kubernetes 将使用此 IP 地址与集群内的其他节点通信，如192.168.127.131\n//所有节点上 Kubernetes 所使用的 IP 地址必须可以互通（无需 NAT 映射、无安全组或防火墙隔离）\n# 设置固定IP，网卡、ip地址、网关、DNS可参考上面的信息\nsudo nmcli c mod ens33 \\\nipv4.addresses 192.168.127.131/24 \\\nipv4.method manual \\\nipv4.gateway 192.168.127.2 \\\nipv4.dns 192.168.127.2\n# 让配置立刻生效\nsudo nmcli c up ens33\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;创建k8s文件夹\&#34;&gt;创建k8s文件夹&lt;/h2&gt;\n&lt;p&gt;存放安装过程所需文件。执行下面代码：&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;mkdir ~/k8s\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;设置iptables\&#34;&gt;设置iptables&lt;/h2&gt;\n&lt;p&gt;执行下面代码：&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;cat &amp;lt;&amp;lt;EOF | sudo tee /etc/sysctl.d/k8s.conf\nnet.bridge.bridge-nf-call-ip6tables = 1\nnet.bridge.bridge-nf-call-iptables = 1\nEOF\nsudo sysctl --system\n# 如果想检查配置，可执行\nsysctl -n net.bridge.bridge-nf-call-iptables\nsysctl -n net.bridge.bridge-nf-call-ip6tables\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;打开端口\&#34;&gt;打开端口&lt;/h2&gt;\n&lt;h3 id=\&#34;ubuntu的准备工作centos跳过\&#34;&gt;Ubuntu的准备工作（CentOS跳过）&lt;/h3&gt;\n&lt;p&gt;先打开Ubuntu自带的防火墙ufw。执行下面代码：&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;sudo ufw enable\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;执行后提示可能断开连接，直接y继续，别担心，ssh连接不会断。&lt;br&gt;\n如果使用ssh连接，还需要执行下面代码，以便打开ssh连接：&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;sudo ufw allow ssh\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;打开相应端口\&#34;&gt;打开相应端口&lt;/h3&gt;\n&lt;p&gt;依据所使用的系统（Ubuntu / CentOS），执行相应代码。&lt;/p&gt;\n&lt;ol&gt;\n&lt;li&gt;控制节点 Control-plane nodes&lt;/li&gt;\n&lt;/ol&gt;\n&lt;pre&gt;&lt;code&gt;# Ubuntu\nsudo ufw allow 6443/tcp\nsudo ufw allow 2379:2380/tcp\nsudo ufw allow 10250:10252/tcp\n//上面代码中的冒号代表端口区间。\n\n#CentOS\nsudo firewall-cmd --zone=public --add-port=6443/tcp --permanent\nsudo firewall-cmd --zone=public --add-port=2379-2380/tcp --permanent\nsudo firewall-cmd --zone=public --add-port=10250-10252/tcp --permanent\nsudo firewall-cmd --reload\n&lt;/code&gt;&lt;/pre&gt;\n&lt;ol start=\&#34;2\&#34;&gt;\n&lt;li&gt;工作节点 Worker nodes&lt;/li&gt;\n&lt;/ol&gt;\n&lt;pre&gt;&lt;code&gt;# Ubuntu\nsudo ufw allow 10250/tcp\nsudo ufw allow 30000:32767/tcp\n\n# CentOS\nsudo firewall-cmd --zone=public --add-port=10250/tcp --permanent\nsudo firewall-cmd --zone=public --add-port=30000-32767/tcp --permanent\nsudo firewall-cmd --reload\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;禁用swap\&#34;&gt;禁用swap&lt;/h2&gt;\n&lt;p&gt;由于swap性能低下，Kubeadm默认要求禁止使用swap。执行如下代码：&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;sudo swapoff -a  #临时禁用swap\nsudo sed -i &#39;s/.*swap.*/#&amp;amp;/&#39; /etc/fstab  #永久禁用swap\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;可通过&lt;code&gt;free -m&lt;/code&gt;来检查禁用效果。&lt;/p&gt;\n&lt;h2 id=\&#34;安装docker\&#34;&gt;安装docker&lt;/h2&gt;\n&lt;p&gt;详见&lt;a href=\&#34;post/zai-centos-he-ubuntu-shang-an-zhuang-he-pei-zhi-docker/\&#34;&gt;docker安装和配置&lt;/a&gt;&lt;/p&gt;\n&lt;h1 id=\&#34;安装kubeadm-kubelet和kubectl\&#34;&gt;安装kubeadm, kubelet和kubectl&lt;/h1&gt;\n&lt;blockquote&gt;\n&lt;p&gt;control node（控制节点）、worker node（工作节点） 上都安装。&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;p&gt;&lt;strong&gt;Ubuntu&lt;/strong&gt;&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;sudo apt-get update &amp;amp;&amp;amp; sudo apt-get install -y apt-transport-https curl\ncurl -s https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg | sudo apt-key add -\ncat &amp;lt;&amp;lt;EOF | sudo tee /etc/apt/sources.list.d/kubernetes.list\ndeb https://mirrors.aliyun.com/kubernetes/apt kubernetes-xenial main\nEOF\nsudo apt-get update\nsudo apt-get install -y kubelet kubeadm kubectl\nsudo apt-mark hold kubelet kubeadm kubectl\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;strong&gt;CentOS&lt;/strong&gt;&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;cat &amp;lt;&amp;lt;EOF | sudo tee /etc/yum.repos.d/kubernetes.repo\n[kubernetes]\nname=Kubernetes\nbaseurl=https://mirrors.aliyun.com/yum/repos/kubernetes-el7-x86_64\nenabled=1\ngpgcheck=0\nrepo_gpgcheck=0\ngpgkey=https:/mirrors.aliyun.com/yum/doc/yum-key.gpg https://mirrors.aliyun.com/yum/doc/rpm-package-key.gpg\nexclude=kubelet kubeadm kubectl\nEOF\n\n# Set SELinux in permissive mode (effectively disabling it)\nsudo setenforce 0\nsudo sed -i &#39;s/^SELINUX=enforcing$/SELINUX=permissive/&#39; /etc/selinux/config\n\nsudo yum install -y kubelet kubeadm kubectl --disableexcludes=kubernetes\n\nsudo systemctl enable --now kubelet\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h1 id=\&#34;在control-node控制节点上用kubeadm创建集群\&#34;&gt;在control node控制节点上用kubeadm创建集群&lt;/h1&gt;\n&lt;h2 id=\&#34;初始化集群-方法一推荐能成功就很幸运\&#34;&gt;初始化集群 - 方法一（推荐，能成功就很幸运）&lt;/h2&gt;\n&lt;pre&gt;&lt;code&gt;kubeadm init --apiserver-advertise-address=你的本机IP \\\n--pod-network-cidr=10.244.0.0/16 \\\n--kubernetes-version=v1.18.8 \\\n--image-repository=registry.cn-hangzhou.aliyuncs.com/google_containers\n//--image-repository指定从阿里云拉取所需镜像\n#如果安装失败，再试几次，还不行就尝试方法二。\n#如果安装成功，则输出类似下面内容，将内容中的`kubeadm join ...`单独保存出来，这是其他节点加入主节点的信息。跳过方法二。\n...\n...\nkubeadm join 192.168.127.132:6443 --token 4pwz11.1m0u1k3ak3ibgx08 \\\n    --discovery-token-ca-cert-hash sha256:671404c4f80afe5d06d8eefcd5acc6049c4d84f1ebf1091b09bc180ea44e79b7   \n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;如果安装顺利，&lt;a href=\&#34;#%E8%B5%8B%E4%BA%88%E5%BD%93%E5%89%8D%E7%94%A8%E6%88%B7%E4%BD%BF%E7%94%A8kubectl%E7%9A%84%E6%9D%83%E9%99%90\&#34;&gt;点这里跳过方法二&lt;/a&gt;。&lt;/p&gt;\n&lt;h2 id=\&#34;初始化集群-方法二只在方法一失败的情况下使用\&#34;&gt;初始化集群 - 方法二（只在方法一失败的情况下使用）&lt;/h2&gt;\n&lt;p&gt;由于种种原因，国内无法从k8s.gcr.io下载到kubeadm部署所需的文件，以下方法将通过阿里云获取。&lt;/p&gt;\n&lt;h3 id=\&#34;准备工作\&#34;&gt;准备工作&lt;/h3&gt;\n&lt;h4 id=\&#34;查看所需镜像\&#34;&gt;查看所需镜像&lt;/h4&gt;\n&lt;pre&gt;&lt;code&gt;kubeadm config images list\n#下面是执行的结果\nk8s.gcr.io/kube-apiserver:v1.18.8\nk8s.gcr.io/kube-controller-manager:v1.18.8\nk8s.gcr.io/kube-scheduler:v1.18.8\nk8s.gcr.io/kube-proxy:v1.18.8\nk8s.gcr.io/pause:3.2\nk8s.gcr.io/etcd:3.4.3-0\nk8s.gcr.io/coredns:1.6.7\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h4 id=\&#34;在阿里云控制台找到所需镜像\&#34;&gt;在阿里云控制台找到所需镜像&lt;/h4&gt;\n&lt;ol&gt;\n&lt;li&gt;&lt;a href=\&#34;https://cr.console.aliyun.com/\&#34;&gt;https://cr.console.aliyun.com/&lt;/a&gt;  左侧点”镜像搜索“&lt;/li&gt;\n&lt;li&gt;分别搜索”kube-apiserver“等所有名称，点开搜索到的镜像，一定找到正确的版本号（如v1.18.8）（日期越新的越容易找到），复制页面中的”公网地址“&lt;/li&gt;\n&lt;/ol&gt;\n&lt;h4 id=\&#34;pull镜像-打标签-移除无用镜像\&#34;&gt;pull镜像、打标签、移除无用镜像&lt;/h4&gt;\n&lt;ol&gt;\n&lt;li&gt;pull镜像&lt;/li&gt;\n&lt;/ol&gt;\n&lt;pre&gt;&lt;code&gt;KUBE_VERSION=v1.18.8\nPAUSE_VERSION=3.2\nETCD_VERSION=3.4.3-0\nCORE_DNS_VERSION=1.6.7\ndocker pull registry.cn-hangzhou.aliyuncs.com/wyc_google_containers/kube-apiserver:$KUBE_VERSION\ndocker pull registry.cn-hangzhou.aliyuncs.com/wyc_google_containers/kube-controller-manager:$KUBE_VERSION\ndocker pull registry.cn-hangzhou.aliyuncs.com/wyc_google_containers/kube-scheduler:$KUBE_VERSION\ndocker pull registry.cn-hangzhou.aliyuncs.com/wyc_google_containers/kube-proxy:$KUBE_VERSION\ndocker pull registry.cn-hangzhou.aliyuncs.com/google_containers/pause:$PAUSE_VERSION\ndocker pull registry.cn-hangzhou.aliyuncs.com/google_containers/coredns:$CORE_DNS_VERSION\ndocker pull registry.cn-hangzhou.aliyuncs.com/google_containers/etcd:$ETCD_VERSION\n&lt;/code&gt;&lt;/pre&gt;\n&lt;ol start=\&#34;2\&#34;&gt;\n&lt;li&gt;给pull下来的镜像打标签&lt;br&gt;\n因为kubeadm部署时会找k8s.gcr.io标签的镜像，因此需要将上一步pull的镜像打上k8s.gcr.io标签。&lt;/li&gt;\n&lt;/ol&gt;\n&lt;pre&gt;&lt;code&gt;docker tag registry.cn-hangzhou.aliyuncs.com/wyc_google_containers/kube-apiserver:$KUBE_VERSION  k8s.gcr.io/kube-proxy:$KUBE_VERSION\ndocker tag registry.cn-hangzhou.aliyuncs.com/wyc_google_containers/kube-apiserver:$KUBE_VERSION k8s.gcr.io/kube-controller-manager:$KUBE_VERSION\ndocker tag registry.cn-hangzhou.aliyuncs.com/wyc_google_containers/kube-apiserver:$KUBE_VERSION k8s.gcr.io/kube-apiserver:$KUBE_VERSION\ndocker tag registry.cn-hangzhou.aliyuncs.com/wyc_google_containers/kube-apiserver:$KUBE_VERSION k8s.gcr.io/kube-scheduler:$KUBE_VERSION\ndocker tag registry.cn-hangzhou.aliyuncs.com/google_containers/pause:$PAUSE_VERSION k8s.gcr.io/pause:$PAUSE_VERSION\ndocker tag registry.cn-hangzhou.aliyuncs.com/google_containers/coredns:$CORE_DNS_VERSION k8s.gcr.io/coredns:$CORE_DNS_VERSION\ndocker tag registry.cn-hangzhou.aliyuncs.com/google_containers/etcd:$ETCD_VERSION k8s.gcr.io/etcd:$ETCD_VERSION\n&lt;/code&gt;&lt;/pre&gt;\n&lt;ol start=\&#34;3\&#34;&gt;\n&lt;li&gt;移除从阿里云pull下来的镜像&lt;/li&gt;\n&lt;/ol&gt;\n&lt;pre&gt;&lt;code&gt;docker rmi registry.cn-hangzhou.aliyuncs.com/wyc_google_containers/kube-apiserver:$KUBE_VERSION\ndocker rmi registry.cn-hangzhou.aliyuncs.com/wyc_google_containers/kube-controller-manager:$KUBE_VERSION\ndocker rmi registry.cn-hangzhou.aliyuncs.com/wyc_google_containers/kube-scheduler:$KUBE_VERSION\ndocker rmi registry.cn-hangzhou.aliyuncs.com/wyc_google_containers/kube-proxy:$KUBE_VERSION\ndocker rmi registry.cn-hangzhou.aliyuncs.com/google_containers/pause:$PAUSE_VERSION\ndocker rmi registry.cn-hangzhou.aliyuncs.com/google_containers/coredns:$CORE_DNS_VERSION\ndocker rmi registry.cn-hangzhou.aliyuncs.com/google_containers/etcd:$ETCD_VERSION\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;部署\&#34;&gt;部署&lt;/h3&gt;\n&lt;pre&gt;&lt;code&gt;kubeadm init --apiserver-advertise-address=你的本机IP --pod-network-cidr=10.244.0.0/16  --kubernetes-version=v1.18.8\n#执行后的输出\n...\n...\nkubeadm join 192.168.127.132:6443 --token 4pwz11.1m0u1k3ak3ibgx08 \\\n    --discovery-token-ca-cert-hash sha256:671404c4f80afe5d06d8eefcd5acc6049c4d84f1ebf1091b09bc180ea44e79b7\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;将输出内容中的&lt;code&gt;kubeadm join ...&lt;/code&gt;单独保存出来，这是其他节点加入主节点的信息。&lt;/p&gt;\n&lt;h2 id=\&#34;赋予当前用户使用kubectl的权限\&#34;&gt;赋予当前用户使用kubectl的权限&lt;/h2&gt;\n&lt;pre&gt;&lt;code&gt;mkdir -p $HOME/.kube\nsudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\nsudo chown $(id -u):$(id -g) $HOME/.kube/config\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;安装网络组件flannel\&#34;&gt;安装网络组件flannel&lt;/h2&gt;\n&lt;h3 id=\&#34;准备工作-2\&#34;&gt;准备工作&lt;/h3&gt;\n&lt;p&gt;由于种种原因，无法直接pull到网络组件flannel的docker镜像，因此需单独下载。&lt;br&gt;\nhttps://github.com/coreos/flannel/releases/download/v0.12.0/flanneld-v0.12.0-amd64.docker&lt;br&gt;\n下载后放进&lt;code&gt;~/k8s&lt;/code&gt;，执行命令：&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;cd ~/k8s\ndocker load &amp;lt; flanneld-v0.12.0-amd64.docker\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;开始安装\&#34;&gt;开始安装&lt;/h3&gt;\n&lt;pre&gt;&lt;code&gt;wget https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml\nkubectl apply -f kube-flannel.yml\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;检查部署情况\&#34;&gt;检查部署情况&lt;/h2&gt;\n&lt;pre&gt;&lt;code&gt;kubectl get nodes\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;img src=\&#34;https://tomhht.github.io/post-images/1598781753839.png\&#34; alt=\&#34;节点运行情况\&#34; loading=\&#34;lazy\&#34;&gt;     &lt;br /&gt;&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;kubectl get pods -A\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;img src=\&#34;https://tomhht.github.io/post-images/1598781791291.png\&#34; alt=\&#34;Pods运行情况\&#34; loading=\&#34;lazy\&#34;&gt;&lt;br&gt;\n通过&lt;code&gt;docker container ls&lt;/code&gt;也可以看到pods里的容器运行情况。&lt;/p&gt;\n&lt;h2 id=\&#34;打开kubectl的autocompletion自动完成功能\&#34;&gt;打开kubectl的autocompletion自动完成功能&lt;/h2&gt;\n&lt;pre&gt;&lt;code&gt;echo &#39;source &amp;lt;(kubectl completion bash)&#39; &amp;gt;&amp;gt;~/.bashrc\n# 执行后，退出shell（如exit）再进入，即可实现自动完成\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;以上为control node控制节点的部署全流程。&lt;/p&gt;\n&lt;hr&gt;\n&lt;h1 id=\&#34;worker-node工作节点加入集群\&#34;&gt;worker node工作节点加入集群&lt;/h1&gt;\n&lt;h2 id=\&#34;安装kubeadm-kubelet和kubectl-2\&#34;&gt;安装kubeadm, kubelet和kubectl&lt;/h2&gt;\n&lt;p&gt;在worker node上，按照上面&lt;strong&gt;安装前的准备工作&lt;/strong&gt;和&lt;strong&gt;安装kubeadm, kubelet和kubectl&lt;/strong&gt;操作。&lt;/p&gt;\n&lt;h2 id=\&#34;载入control-node上pull好的镜像\&#34;&gt;载入control  node上pull好的镜像&lt;/h2&gt;\n&lt;ol&gt;\n&lt;li&gt;在control node上，备份出全套docker镜像（含kubeadm所需镜像+网络组件flannel镜像）：&lt;/li&gt;\n&lt;/ol&gt;\n&lt;pre&gt;&lt;code&gt;cd ~/k8s\ndocker save k8s.gcr.io/kube-proxy:v1.18.8 \\\nk8s.gcr.io/kube-apiserver:v1.18.8 \\\nk8s.gcr.io/kube-controller-manager:v1.18.8 \\\nk8s.gcr.io/kube-scheduler:v1.18.8 \\\nk8s.gcr.io/pause:3.2 \\\nk8s.gcr.io/coredns:1.6.7 \\\nk8s.gcr.io/etcd:3.4.3-0 \\\nquay.io/coreos/flannel:v0.12.0-amd64 &amp;gt; k8s-imagesV1.18.8-flannelV0.12.0.tar\n&lt;/code&gt;&lt;/pre&gt;\n&lt;blockquote&gt;\n&lt;p&gt;之前踩坑，偷懒用IMAGE ID做的备份，结果载入以后name和tag全都是none，还得打name和tag上去，无比繁琐- _ -||&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;ol start=\&#34;2\&#34;&gt;\n&lt;li&gt;scp上面的备份文件到各个worker node的&lt;code&gt;~/k8s&lt;/code&gt;文件夹里&lt;/li&gt;\n&lt;li&gt;在worker node上载入备份文件：&lt;/li&gt;\n&lt;/ol&gt;\n&lt;pre&gt;&lt;code&gt;cd ~/k8s\ndocker load &amp;lt; k8s-imagesV1.18.8-flannelV0.12.0.tar\n&lt;/code&gt;&lt;/pre&gt;\n&lt;blockquote&gt;\n&lt;p&gt;worker node实际需要的只有3个镜像，分别是&lt;code&gt;kube-proxy, pause, flannel&lt;/code&gt;&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h2 id=\&#34;加入集群\&#34;&gt;加入集群&lt;/h2&gt;\n&lt;p&gt;执行之前在control node上单独保存出来的&lt;code&gt;kubeadm join...&lt;/code&gt;，类似于：&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;sudo kubeadm join 192.168.127.132:6443 --token rddtz5.mz2v4ee96177eay5     --discovery-token-ca-cert-hash sha256:671404c4f80afe5d06d8eefcd5acc6049c4d84f1ebf1091b09bc180ea44e79b7\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;如果join指令没记录下来，或者集群创建已经超过24小时了，那么需要重新生成join指令。在&lt;strong&gt;control node&lt;/strong&gt;上执行：&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;kubeadm token create --print-join-command\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;复制输出的内容并在&lt;strong&gt;worker node&lt;/strong&gt;上执行即可加入。&lt;/p&gt;\n&lt;hr&gt;\n&lt;h1 id=\&#34;检查部署结果\&#34;&gt;检查部署结果&lt;/h1&gt;\n&lt;p&gt;在control node上执行：&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;kubectl get nodes -o wide\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;img src=\&#34;https://tomhht.github.io/post-images/1599032788153.png\&#34; alt=\&#34;集群节点信息\&#34; loading=\&#34;lazy\&#34;&gt; &lt;br /&gt;&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;kubectl get pods -A -o wide\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;img src=\&#34;https://tomhht.github.io/post-images/1599032818248.png\&#34; alt=\&#34;集群pods信息\&#34; loading=\&#34;lazy\&#34;&gt;&lt;br&gt;\n如果STATUS不是Running，则排查故障点：&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;kubectl describe pods -n kube-system kube-proxy-t2zbw\n&lt;/code&gt;&lt;/pre&gt;\n&lt;hr&gt;\n&lt;p&gt;参考链接：&lt;br&gt;\n&lt;a href=\&#34;https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/\&#34;&gt;https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/&lt;/a&gt;&lt;br&gt;\n&lt;a href=\&#34;https://www.cnblogs.com/hellxz/p/use-kubeadm-init-kubernetes-cluster.html\&#34;&gt;https://www.cnblogs.com/hellxz/p/use-kubeadm-init-kubernetes-cluster.html&lt;/a&gt;&lt;br&gt;\n&lt;a href=\&#34;https://www.kuboard.cn/install/install-k8s.html\&#34;&gt;https://www.kuboard.cn/install/install-k8s.html&lt;/a&gt;&lt;br&gt;\n&lt;a href=\&#34;https://blog.csdn.net/LeonardoYasuo/article/details/101483438\&#34;&gt;https://blog.csdn.net/LeonardoYasuo/article/details/101483438&lt;/a&gt;&lt;br&gt;\n&lt;a href=\&#34;https://www.cnblogs.com/yinzhengjie/p/12258215.html\&#34;&gt;https://www.cnblogs.com/yinzhengjie/p/12258215.html&lt;/a&gt;&lt;br&gt;\n&lt;a href=\&#34;https://developer.aliyun.com/article/763983\&#34;&gt;https://developer.aliyun.com/article/763983&lt;/a&gt;&lt;/p&gt;\n&#34;,&#34;fileName&#34;:&#34;zai-ubuntu-2004-shang-shi-yong-kubeadm-bu-shu-kubernetes-ji-qun&#34;,&#34;abstract&#34;:&#34;&lt;p&gt;本文主要是踩坑后想记录下避坑方法，内容涉及Kubernetes, Kubeadm, Kubectl, Kubelet, Ubuntu, CentOS, Flannel, Docker, 阿里云。&lt;/p&gt;\n&#34;,&#34;title&#34;:&#34;在Ubuntu 20.04和CentOS 8上使用kubeadm部署Kubernetes集群&#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;Kubernetes&#34;,&#34;slug&#34;:&#34;2myAgZVX1&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/2myAgZVX1/&#34;},{&#34;name&#34;:&#34;Kubeadm&#34;,&#34;slug&#34;:&#34;o7K32AxyIA&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/o7K32AxyIA/&#34;},{&#34;name&#34;:&#34;Kubectl&#34;,&#34;slug&#34;:&#34;xGRD-5em-T&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/xGRD-5em-T/&#34;},{&#34;name&#34;:&#34;Kubelet&#34;,&#34;slug&#34;:&#34;et2DIyRaOM&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/et2DIyRaOM/&#34;},{&#34;name&#34;:&#34;Ubuntu&#34;,&#34;slug&#34;:&#34;pelgqi16au&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/pelgqi16au/&#34;},{&#34;name&#34;:&#34;CentOS&#34;,&#34;slug&#34;:&#34;qjvKbAF653&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/qjvKbAF653/&#34;},{&#34;name&#34;:&#34;Flannel&#34;,&#34;slug&#34;:&#34;2W4Ff5s-rE&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/2W4Ff5s-rE/&#34;},{&#34;name&#34;:&#34;Docker&#34;,&#34;slug&#34;:&#34;RkYw1lQ_qY&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/RkYw1lQ_qY/&#34;},{&#34;name&#34;:&#34;Aliyun&#34;,&#34;slug&#34;:&#34;LQERLoeDmq&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/LQERLoeDmq/&#34;},{&#34;name&#34;:&#34;阿里云&#34;,&#34;slug&#34;:&#34;CDrtFP3hgt&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://tomhht.github.io/tag/CDrtFP3hgt/&#34;}],&#34;date&#34;:&#34;2020-08-27 18:40:02&#34;,&#34;dateFormat&#34;:&#34;2020-08-27&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://tomhht.github.io/post/zai-ubuntu-2004-shang-shi-yong-kubeadm-bu-shu-kubernetes-ji-qun/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;13 min read&#34;,&#34;time&#34;:736000,&#34;words&#34;:2563,&#34;minutes&#34;:13},&#34;description&#34;:&#34;本文主要是踩坑后想记录下避坑方法，内容涉及Kubernetes, Kubeadm, Kubectl, Kubelet, Ubuntu, CentOS, Flannel, Docker, 阿里云。\n\n写作背景\n初学Kubernetes，虽然网...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%86%99%E4%BD%9C%E8%83%8C%E6%99%AF\&#34;&gt;写作背景&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%AE%89%E8%A3%85%E5%89%8D%E7%9A%84%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C\&#34;&gt;安装前的准备工作&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%A3%80%E6%9F%A5%E5%90%84%E4%B8%BB%E6%9C%BA%E9%85%8D%E7%BD%AE\&#34;&gt;检查各主机配置&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%A3%80%E6%9F%A5cpu%E5%92%8C%E5%86%85%E5%AD%98\&#34;&gt;检查cpu和内存&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%A3%80%E6%9F%A5%E4%B8%BB%E6%9C%BA%E5%90%8Dhostname\&#34;&gt;检查主机名hostname&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E8%AE%BE%E7%BD%AE%E5%9B%BA%E5%AE%9Aip\&#34;&gt;设置固定IP&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%88%9B%E5%BB%BAk8s%E6%96%87%E4%BB%B6%E5%A4%B9\&#34;&gt;创建k8s文件夹&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E8%AE%BE%E7%BD%AEiptables\&#34;&gt;设置iptables&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%89%93%E5%BC%80%E7%AB%AF%E5%8F%A3\&#34;&gt;打开端口&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#ubuntu%E7%9A%84%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9Ccentos%E8%B7%B3%E8%BF%87\&#34;&gt;Ubuntu的准备工作（CentOS跳过）&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%89%93%E5%BC%80%E7%9B%B8%E5%BA%94%E7%AB%AF%E5%8F%A3\&#34;&gt;打开相应端口&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E7%A6%81%E7%94%A8swap\&#34;&gt;禁用swap&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%AE%89%E8%A3%85docker\&#34;&gt;安装docker&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%AE%89%E8%A3%85kubeadm-kubelet%E5%92%8Ckubectl\&#34;&gt;安装kubeadm, kubelet和kubectl&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%9C%A8control-node%E6%8E%A7%E5%88%B6%E8%8A%82%E7%82%B9%E4%B8%8A%E7%94%A8kubeadm%E5%88%9B%E5%BB%BA%E9%9B%86%E7%BE%A4\&#34;&gt;在control node控制节点上用kubeadm创建集群&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%88%9D%E5%A7%8B%E5%8C%96%E9%9B%86%E7%BE%A4-%E6%96%B9%E6%B3%95%E4%B8%80%E6%8E%A8%E8%8D%90%E8%83%BD%E6%88%90%E5%8A%9F%E5%B0%B1%E5%BE%88%E5%B9%B8%E8%BF%90\&#34;&gt;初始化集群 - 方法一（推荐，能成功就很幸运）&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%88%9D%E5%A7%8B%E5%8C%96%E9%9B%86%E7%BE%A4-%E6%96%B9%E6%B3%95%E4%BA%8C%E5%8F%AA%E5%9C%A8%E6%96%B9%E6%B3%95%E4%B8%80%E5%A4%B1%E8%B4%A5%E7%9A%84%E6%83%85%E5%86%B5%E4%B8%8B%E4%BD%BF%E7%94%A8\&#34;&gt;初始化集群 - 方法二（只在方法一失败的情况下使用）&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C\&#34;&gt;准备工作&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%9F%A5%E7%9C%8B%E6%89%80%E9%9C%80%E9%95%9C%E5%83%8F\&#34;&gt;查看所需镜像&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%9C%A8%E9%98%BF%E9%87%8C%E4%BA%91%E6%8E%A7%E5%88%B6%E5%8F%B0%E6%89%BE%E5%88%B0%E6%89%80%E9%9C%80%E9%95%9C%E5%83%8F\&#34;&gt;在阿里云控制台找到所需镜像&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#pull%E9%95%9C%E5%83%8F-%E6%89%93%E6%A0%87%E7%AD%BE-%E7%A7%BB%E9%99%A4%E6%97%A0%E7%94%A8%E9%95%9C%E5%83%8F\&#34;&gt;pull镜像、打标签、移除无用镜像&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E9%83%A8%E7%BD%B2\&#34;&gt;部署&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E8%B5%8B%E4%BA%88%E5%BD%93%E5%89%8D%E7%94%A8%E6%88%B7%E4%BD%BF%E7%94%A8kubectl%E7%9A%84%E6%9D%83%E9%99%90\&#34;&gt;赋予当前用户使用kubectl的权限&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%AE%89%E8%A3%85%E7%BD%91%E7%BB%9C%E7%BB%84%E4%BB%B6flannel\&#34;&gt;安装网络组件flannel&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C-2\&#34;&gt;准备工作&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%BC%80%E5%A7%8B%E5%AE%89%E8%A3%85\&#34;&gt;开始安装&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%A3%80%E6%9F%A5%E9%83%A8%E7%BD%B2%E6%83%85%E5%86%B5\&#34;&gt;检查部署情况&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%89%93%E5%BC%80kubectl%E7%9A%84autocompletion%E8%87%AA%E5%8A%A8%E5%AE%8C%E6%88%90%E5%8A%9F%E8%83%BD\&#34;&gt;打开kubectl的autocompletion自动完成功能&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#worker-node%E5%B7%A5%E4%BD%9C%E8%8A%82%E7%82%B9%E5%8A%A0%E5%85%A5%E9%9B%86%E7%BE%A4\&#34;&gt;worker node工作节点加入集群&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%AE%89%E8%A3%85kubeadm-kubelet%E5%92%8Ckubectl-2\&#34;&gt;安装kubeadm, kubelet和kubectl&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E8%BD%BD%E5%85%A5control-node%E4%B8%8Apull%E5%A5%BD%E7%9A%84%E9%95%9C%E5%83%8F\&#34;&gt;载入control  node上pull好的镜像&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%8A%A0%E5%85%A5%E9%9B%86%E7%BE%A4\&#34;&gt;加入集群&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%A3%80%E6%9F%A5%E9%83%A8%E7%BD%B2%E7%BB%93%E6%9E%9C\&#34;&gt;检查部署结果&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&#34;}]";
  // var json = escape.substr(1, escape.length - 2);
  // var datas = json.split(',');
  // for (let i=0; i < datas.length; i++) {
  //   let item = datas[i];
  //   let attrs = item.split('34;:&#34')
  //   debugger
  //   console.log(datas[i])
  // }
  let escapeMap = new Map();
  escapeMap.set('&#34;', '"');
  escapeMap.set('&gt;', '>');
  escapeMap.set('&#39;', "'");
  escapeMap.set('&lt;', '<');
  escapeMap.set('&quot;', '"');
  escapeMap.set('&amp;', '&');
</script> -->



</html>