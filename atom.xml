<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://tomhht.github.io</id>
    <title>Tom</title>
    <updated>2020-08-28T06:35:22.183Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://tomhht.github.io"/>
    <link rel="self" href="https://tomhht.github.io/atom.xml"/>
    <subtitle>家</subtitle>
    <logo>https://tomhht.github.io/images/avatar.png</logo>
    <icon>https://tomhht.github.io/favicon.ico</icon>
    <rights>All rights reserved 2020, Tom</rights>
    <entry>
        <title type="html"><![CDATA[在Ubuntu 20.04上使用Kubeadm部署Kubernetes集群]]></title>
        <id>https://tomhht.github.io/post/zai-ubuntu-2004-shang-shi-yong-kubeadm-bu-shu-kubernetes-ji-qun/</id>
        <link href="https://tomhht.github.io/post/zai-ubuntu-2004-shang-shi-yong-kubeadm-bu-shu-kubernetes-ji-qun/">
        </link>
        <updated>2020-08-27T10:40:02.000Z</updated>
        <content type="html"><![CDATA[<h1 id="关键词">关键词</h1>
<p>Kubernetes, Kubeadm, Kubectl, Kubelet, Ubuntu, CentOS, Flannel, Docker, Aliyun, 阿里云</p>
<h1 id="写作背景">写作背景</h1>
<p>初学Kubernetes，虽然网上资源很多，但没一个能彻底搞定，于是杂烩一下。</p>
<h1 id="安装前的准备工作">安装前的准备工作</h1>
<h2 id="设置iptables">设置iptables</h2>
<p>执行下面代码：</p>
<pre><code>cat &lt;&lt;EOF | sudo tee /etc/sysctl.d/k8s.conf
net.bridge.bridge-nf-call-ip6tables = 1
net.bridge.bridge-nf-call-iptables = 1
EOF
sudo sysctl --system
</code></pre>
<h2 id="打开端口">打开端口</h2>
<p>先打开Ubuntu自带的防火墙ufw，因为ufw设置似乎更简单一些。执行下面代码：<br>
<code>sudo ufw enable</code><br>
执行后提示可能断开连接，直接y继续，别担心，ssh连接不会断。<br>
如果使用ssh连接，还需要执行下面代码，打开ssh连接：<br>
<code>sudo ufw allow ssh</code><br>
接下来分别设置：</p>
<ol>
<li>控制节点 Control-plane nodes</li>
</ol>
<pre><code>sudo ufw allow 6443/tcp
sudo ufw allow 2379:2380/tcp
sudo ufw allow 10250:10252/tcp
</code></pre>
<p>上面代码中的冒号代表端口区间，如10250:10252代表10250、10251、10252这3个端口一起设置。<br>
2. 工作节点 Worker nodes</p>
<pre><code>sudo ufw allow 10250/tcp
sudo ufw allow 30000:32767/tcp
</code></pre>
<h2 id="禁用swap">禁用swap</h2>
<p>由于swap性能低下，Kubeadm默认要求禁止使用swap。执行如下代码：</p>
<pre><code>sudo swapoff -a    #临时禁用
sudo sed -i 's/.*swap.*/#&amp;/' /etc/fstab    #永久禁用
</code></pre>
<p>可通过<code>free -m</code>来检查禁用效果。</p>
<hr>
<p>未完待续...</p>
]]></content>
    </entry>
</feed>